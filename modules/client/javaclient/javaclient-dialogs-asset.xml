<?xml version="1.0" encoding="UTF-8" ?>
<cmd xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:noNamespaceSchemaLocation="http://www.censhare.com/xml/3.0.0/dialogs-schema.xsd"
  xmlns:corpus="http://www.censhare.com/xml/3.0.0/corpus"
  xmlns:cs="http://www.censhare.com/xml/3.0.0/xpath-functions"
  xmlns:new-val="http://www.censhare.com/xml/3.0.0/new-val"
  xmlns:new-fct="http://www.censhare.com/xml/3.0.0/new-fct"
  xmlns:xe="http://www.censhare.com/xml/3.0.0/xmleditor">

  <xml-info title="${javaclient-dialogs-asset-title}" description="${javaclient-dialogs-asset-description}" knowledge-level="2" special-licence="false" feature-help="" localize="true">
    <property-resources>
      <base url="file:module-custom"/>
      <base url="file:module"/>
      <base url="file:../common/module"/>
      <base url="file:../../../common/global"/>
    </property-resources>
    <history>
      <entry user="Roelofsen, Roel" timestamp="2019-12-10T16:05:34.058Z" comment=""/>
      <entry user="Roelofsen, Roel" timestamp="2019-12-10T16:05:34.058Z" comment=""/>
      <entry user="Roelofsen, Roel" timestamp="2019-12-10T16:05:34.058Z" comment=""/>
    </history>
  </xml-info>
  <cmd-info name="client.javaclient.dialogs-asset" enabled="true"/>
  <admin-info dialog-id="dialog-config" dialog-url="file:config-dialog.xml" preserve-original-formatting="true"/>

  <!-- similarities webclient/javaclient ([client]-dialogs-asset.xml) -->

  <!-- asset check in dialog -->
  <xe:part id="dialog-asset-check-in" transactional="true">
    <xe:group>
      <xe:include key="asset-edit-meta-data-include"/>
    </xe:group>
  </xe:part>

  <!-- asset check in new dialog -->
  <xe:part id="dialog-asset-check-in-new" transactional="true">
    <xe:group align="down">
      <xe:include key="asset-edit-meta-data-include">
        <xe:param show_relation="true" />
      </xe:include>
    </xe:group>
  </xe:part>

  <xe:part id="dialog-asset-check-in-new-with-elements" transactional="true">
    <xe:group align="down">
      <xe:group margin-left="10" margin-top="5" margin-bottom="5">
        <xe:editfield label="${number-of-pages-elements}" label-style="label-default" width="8em" source="$temp@number-of-elements" data-type="INTEGER" autofocus="true" defaultvalue="2">
          <xe:validate min-value="1" not-empty="true" />
        </xe:editfield>
      </xe:group>
      <xe:include key="asset-edit-meta-data-include">
        <xe:param show_relation="true" />
      </xe:include>
    </xe:group>
  </xe:part>

  <!-- asset check in new with keep open flag dialog -->
  <xe:part id="dialog-asset-check-in-new-keep-open" transactional="true">
    <xe:group align="down">
      <xe:include key="asset-edit-meta-data-include">
        <xe:param show_state="true" show_relation="true"/>
      </xe:include>
    </xe:group>
  </xe:part>

  <!-- asset check out dialog -->
  <xe:part id="dialog-asset-check-out" transactional="false">
    <xe:group align="down">
      <xe:include key="asset-edit-meta-data-include">
        <xe:param readonly="true"/>
      </xe:include>
    </xe:group>
  </xe:part>

  <!-- asset edit address dialog (used for address asset application) -->
  <xe:part id="dialog-asset-edit-address" transactional="true">
    <xe:selectcase value="=true">
      <xe:case value="=:starts-with(asset/@type,'address.')">
        <xe:group align="down">
          <xe:group align="right">
            <xe:include key="dialog-asset-edit-main-picture"/>
            <xe:strut width="1em"/>
            <xe:scrollpane weight-x="1" height="20em" align="down" track-viewport-width="true">
              <xe:include key="dialog-asset-edit-company"/>
            </xe:scrollpane>
          </xe:group>
          <xe:strut height="1em"/>
          <xe:include key="dialog-asset-edit-employees"/>
          <!-- <xe:include key="dialog-asset-search-persons"/> -->
        </xe:group>
      </xe:case>
      <xe:defaultcase>
        <xe:group align="down">
          <xe:group align="right">
            <xe:include key="dialog-asset-edit-main-picture"/>
            <xe:strut width="1em"/>
            <xe:scrollpane weight-x="1" weight-y="1" align="down" track-viewport-width="true">
              <xe:include key="dialog-asset-edit-person"/>
            </xe:scrollpane>
          </xe:group>
          <xe:strut height="1em"/>
        </xe:group>
      </xe:defaultcase>
    </xe:selectcase>
  </xe:part>

  <!-- asset edit main picture dialog -->
  <xe:part id="dialog-asset-edit-main-picture" transactional="true">
    <xe:expandgroup caption="${main-picture}" id="main-picture" expanded="true" save-state="true" readonly="=$param@readonly">
      <xe:group align="right">
        <xe:label label="${main-picture}" label-style="label-default" align-y="top"/>
        <xe:assetref width="160" height="160" source="child_asset_rel[key='user.main-picture.']@child_asset" allow-drop-replace="true" css-key="asset-info" expression-id="asset-ref-preview-150x150">
          <xe:drop-filter condition="=:starts-with(asset/@type, 'picture.')"/>
        </xe:assetref>
        <xe:deletebutton align-y="top" source="child_asset_rel[key='user.main-picture.']"/>
      </xe:group>
    </xe:expandgroup>
  </xe:part>

  <!-- asset edit issue include -->
  <xe:part id="asset-edit-issue.-include" transactional="true">
    <xe:group align="down">
      <xe:editfield label="${name}" label-style="label-default" width="30em" source="@issue_name" data-type="VARCHAR(256)">
        <xe:change dest="@name" source="@issue_name"/>
      </xe:editfield>
      <xe:editfield label="${number}" label-style="label-default" width="5em" source="@issue_no" data-type="VARCHAR(16)"/>
      <xe:editfield label="${year}" label-style="label-default" width="5em" source="@issue_year" data-type="VARCHAR(16)"/>
      <xe:date label="${publication-date}" label-style="label-default" width="30em" source="asset_feature[feature='censhare:publication-date']@value_timestamp"/>
    </xe:group>
  </xe:part>

  <!-- asset edit person include -->
  <xe:part id="asset-edit-person.-include" transactional="true">
    <xe:group align="down">
      <xe:include key="dialog-asset-edit-main-picture"/>
      <xe:separator/>
      <xe:include key="dialog-asset-edit-person"/>
    </xe:group>
  </xe:part>

  <!-- asset edit company include -->
  <xe:part id="asset-edit-address.-include" transactional="true">
    <xe:group align="down">
      <xe:include key="dialog-asset-edit-main-picture"/>
      <xe:separator/>
      <xe:include key="dialog-asset-edit-company"/>
      <xe:separator/>
      <xe:include key="dialog-asset-edit-employees"/>
      <xe:separator/>
      <!-- <xe:include key="dialog-asset-search-persons"/> -->
    </xe:group>
  </xe:part>

  <!-- asset edit product include -->
  <xe:part id="asset-edit-product.-include" transactional="true">
    <xe:group align="down">
      <xe:include key="dialog-asset-edit-main-picture"/>
      <xe:separator/>
      <xe:include key="dialog-asset-edit-product"/>
    </xe:group>
  </xe:part>

  <!-- asset edit task include -->
  <xe:part id="asset-edit-task.-include" transactional="true">
    <xe:group align="down">
      <xe:group align="right">
        <xe:editdate label="${expected-date}" label-style="label-default" width="30em" source="asset_feature[feature='censhare:given-expected-time-end']@value_timestamp"/>
        <xe:deletebutton source="asset_feature[feature='censhare:given-expected-time-end']"/>
      </xe:group>
      <xe:group align="right">
        <xe:editdate label="${start-date}" label-style="label-default" width="30em" source="asset_feature[feature='censhare:given-time-start']@value_timestamp"/>
        <xe:deletebutton source="asset_feature[feature='censhare:given-time-start']"/>
      </xe:group>
      <xe:group align="right">
        <xe:editdate label="${end-date}" label-style="label-default" width="30em" source="asset_feature[feature='censhare:given-time-end']@value_timestamp"/>
        <xe:deletebutton source="asset_feature[feature='censhare:given-time-end']"/>
      </xe:group>
      <xe:group align="right">
        <xe:editfield label="${duration}" label-style="label-default" width="8em" source="asset_feature[feature='censhare:given-duration']@value_double" data-type="NUMBER"/>
        <!-- unit -->
        <xe:popupmenu width="15em" source="asset_feature[feature='censhare:given-duration']@value_unit">
          <xe:options value-key="@unit" option-label-expression="=cachelookup('unit', '@key', @unit)@name">
            <xe:generator name="filtered_cachedtables" table-name="unit_set_rel" source="@unit_set" match="=cachelookup('feature', '@key', 'censhare:given-duration')@unit_set"/>
            <xe:sort key="@sorting" data-type="integer"/>
          </xe:options>
        </xe:popupmenu>
        <xe:deletebutton source="asset_feature[feature='censhare:given-duration']"/>
      </xe:group>
      <xe:group align="right">
        <xe:editfield label="${working-time}" label-style="label-default" width="8em" source="asset_feature[feature='censhare:given-working-time']@value_double" data-type="NUMBER"/>
        <!-- unit -->
        <xe:popupmenu width="15em" source="asset_feature[feature='censhare:given-working-time']@value_unit">
          <xe:options value-key="@unit" option-label-expression="=cachelookup('unit', '@key', @unit)@name">
            <xe:generator name="filtered_cachedtables" table-name="unit_set_rel" source="@unit_set" match="=cachelookup('feature', '@key', 'censhare:given-working-time')@unit_set"/>
            <xe:sort key="@sorting" data-type="integer"/>
          </xe:options>
        </xe:popupmenu>
        <xe:deletebutton source="asset_feature[feature='censhare:given-working-time']"/>
      </xe:group>
      <xe:group align="right">
        <xe:editfield label="${complete}" label-style="label-default" width="8em" source="asset_feature[feature='censhare:task-completion-percentage']@value_double" data-type="NUMBER"/>
        <xe:label value="%"/>
        <xe:deletebutton source="asset_feature[feature='censhare:task-completion-percentage']@value_double"/>
      </xe:group>
    </xe:group>
  </xe:part>

  <!-- asset edit milestone include -->
  <xe:part id="asset-edit-task.milestone.-include" transactional="true">
    <xe:group align="down">
      <xe:group align="right">
        <xe:editdate label="${date}" label-style="label-default" width="30em" source="@deadline"/>
        <xe:deletebutton source="@deadline"/>
      </xe:group>
    </xe:group>
  </xe:part>

  <!-- asset edit layout task item include -->
  <xe:part id="asset-edit-module.layout-box-tag.-include" transactional="true">
    <xe:group align="down">
      <xe:group align="right">
        <xe:popupmenu label="${macro}" label-style="label-default" width="30em" source="asset_feature[feature='censhare:macro']@value_asset_key_ref">
          <xe:options value-key="@key" label-key="@name">
            <xe:generator name="filtered_cachedtables" table-name="resource_asset"/>
            <xe:filter condition="=:exists(resource_asset[starts-with(@type, 'module.macro.')])"/>
            <xe:sort key="@name" ascending="true"/>
          </xe:options>
          <xe:change value="censhare:resource-key" dest="asset_feature[feature='censhare:macro']@value_string2"/>
        </xe:popupmenu>
        <xe:deletebutton source="asset_feature[feature='censhare:macro']"/>
      </xe:group>
    </xe:group>
  </xe:part>

  <!-- asset edit person dialog -->
  <xe:part id="dialog-asset-edit-person" transactional="true">
    <xe:group align="down">
      <xe:expandgroup caption="${person}" id="person" expanded="true" save-state="true" readonly="=$param@readonly">
        <xe:label label="${person}" label-style="label-default" align-y="top"/>
        <xe:group width="47em" align="down">
          <!-- title, first name, middle name, last name -->
          <xe:group>
            <xe:editfield label="=:cs:cachelookup('feature', '@key', 'censhare:address.title')/@name" label-align="top" width="5em" source="asset_feature[feature='censhare:address'].asset_feature[feature='censhare:address.personal-data'].asset_feature[feature='censhare:address.title']@value_string" data-type="VARCHAR(32)">
              <xe:change dest="@name" value="=:string-join((asset/asset_feature[@feature='censhare:address']/asset_feature[@feature='censhare:address.personal-data']/asset_feature[@feature='censhare:address.title']/@value_string, asset/asset_feature[@feature='censhare:address']/asset_feature[@feature='censhare:address.personal-data']/asset_feature[@feature='censhare:address.first-name']/@value_string, asset/asset_feature[@feature='censhare:address']/asset_feature[@feature='censhare:address.personal-data']/asset_feature[@feature='censhare:address.middle-name']/@value_string, asset/asset_feature[@feature='censhare:address']/asset_feature[@feature='censhare:address.personal-data']/asset_feature[@feature='censhare:address.last-name']/@value_string), ' ')" allow-set-null="true"/>
            </xe:editfield>
            <xe:editfield label="=:cs:cachelookup('feature', '@key', 'censhare:address.first-name')/@name" label-align="top" width="12em" source="asset_feature[feature='censhare:address'].asset_feature[feature='censhare:address.personal-data'].asset_feature[feature='censhare:address.first-name']@value_string" data-type="VARCHAR(64)">
              <xe:change dest="@name" value="=:string-join((asset/asset_feature[@feature='censhare:address']/asset_feature[@feature='censhare:address.personal-data']/asset_feature[@feature='censhare:address.title']/@value_string, asset/asset_feature[@feature='censhare:address']/asset_feature[@feature='censhare:address.personal-data']/asset_feature[@feature='censhare:address.first-name']/@value_string, asset/asset_feature[@feature='censhare:address']/asset_feature[@feature='censhare:address.personal-data']/asset_feature[@feature='censhare:address.middle-name']/@value_string, asset/asset_feature[@feature='censhare:address']/asset_feature[@feature='censhare:address.personal-data']/asset_feature[@feature='censhare:address.last-name']/@value_string), ' ')" allow-set-null="true"/>
            </xe:editfield>
            <xe:editfield label="=:cs:cachelookup('feature', '@key', 'censhare:address.middle-name')/@name" label-align="top" width="9em" source="asset_feature[feature='censhare:address'].asset_feature[feature='censhare:address.personal-data'].asset_feature[feature='censhare:address.middle-name']@value_string" data-type="VARCHAR(64)">
              <xe:change dest="@name" value="=:string-join((asset/asset_feature[@feature='censhare:address']/asset_feature[@feature='censhare:address.personal-data']/asset_feature[@feature='censhare:address.title']/@value_string, asset/asset_feature[@feature='censhare:address']/asset_feature[@feature='censhare:address.personal-data']/asset_feature[@feature='censhare:address.first-name']/@value_string, asset/asset_feature[@feature='censhare:address']/asset_feature[@feature='censhare:address.personal-data']/asset_feature[@feature='censhare:address.middle-name']/@value_string, asset/asset_feature[@feature='censhare:address']/asset_feature[@feature='censhare:address.personal-data']/asset_feature[@feature='censhare:address.last-name']/@value_string), ' ')" allow-set-null="true"/>
            </xe:editfield>
            <xe:editfield label="=:cs:cachelookup('feature', '@key', 'censhare:address.last-name')/@name" label-align="top" width="200" source="asset_feature[feature='censhare:address'].asset_feature[feature='censhare:address.personal-data'].asset_feature[feature='censhare:address.last-name']@value_string" data-type="VARCHAR(128)">
              <xe:validate not-empty="true"/>
              <xe:change dest="@name" value="=:string-join((asset/asset_feature[@feature='censhare:address']/asset_feature[@feature='censhare:address.personal-data']/asset_feature[@feature='censhare:address.title']/@value_string, asset/asset_feature[@feature='censhare:address']/asset_feature[@feature='censhare:address.personal-data']/asset_feature[@feature='censhare:address.first-name']/@value_string, asset/asset_feature[@feature='censhare:address']/asset_feature[@feature='censhare:address.personal-data']/asset_feature[@feature='censhare:address.middle-name']/@value_string, asset/asset_feature[@feature='censhare:address']/asset_feature[@feature='censhare:address.personal-data']/asset_feature[@feature='censhare:address.last-name']/@value_string), ' ')" allow-set-null="true"/>
            </xe:editfield>
          </xe:group>
          <!-- gender, salutation, birthday -->
          <xe:group margin-top="1em">
            <xe:popupmenu label="=:cs:cachelookup('feature', '@key', 'censhare:address.gender')/@name" label-align="top" width="8em" source="asset_feature[feature='censhare:address'].asset_feature[feature='censhare:address.personal-data'].asset_feature[feature='censhare:address.gender']@value_key">
              <xe:options label-key="@name" value-key="@value_key">
                <xe:generator name="cachedtables" table-name="feature_value" source="@feature" match="censhare:address.gender"/>
              </xe:options>
            </xe:popupmenu>
            <xe:editfield label="=:cs:cachelookup('feature', '@key', 'censhare:address.salutation')/@name" label-align="top" width="23em" source="asset_feature[feature='censhare:address'].asset_feature[feature='censhare:address.personal-data'].asset_feature[feature='censhare:address.salutation']@value_string"  data-type="VARCHAR(32)"/>
            <xe:date label="=:cs:cachelookup('feature', '@key', 'censhare:address.birthday')/@name" label-align="top" width="15em" source="asset_feature[feature='censhare:address'].asset_feature[feature='censhare:address.personal-data'].asset_feature[feature='censhare:address.birthday']@value_timestamp"  widget-type="editfield" type="date"/>
          </xe:group>
          <!-- birthplace -->
          <xe:group margin-top="1em">
            <xe:editfield label="=:cs:cachelookup('feature', '@key', 'censhare:address.birthplace')/@name" label-align="top" width="47em" source="asset_feature[feature='censhare:address'].asset_feature[feature='censhare:address.personal-data'].asset_feature[feature='censhare:address.birthplace']@value_string"  data-type="VARCHAR(4000)"/>
          </xe:group>
          <xe:group margin-top="1em">
            <!-- function, department, company -->
            <xe:editfield label="=:cs:cachelookup('feature', '@key', 'censhare:address.function')/@name" label-align="top" width="13em" source="asset_feature[feature='censhare:address'].asset_feature[feature='censhare:address.personal-data'].asset_feature[feature='censhare:address.function']@value_string"  data-type="VARCHAR(64)"/>
            <xe:editfield label="=:cs:cachelookup('feature', '@key', 'censhare:address.department')/@name" label-align="top" width="13em" source="asset_feature[feature='censhare:address'].asset_feature[feature='censhare:address.personal-data'].asset_feature[feature='censhare:address.department']@value_string"  data-type="VARCHAR(64)"/>
            <xe:editfield label="=:cs:cachelookup('feature', '@key', 'censhare:address.company')/@name" label-align="top" width="20em" source="asset_feature[feature='censhare:address'].asset_feature[feature='censhare:address.personal-data'].asset_feature[feature='censhare:address.company']@value_string"  data-type="VARCHAR(64)"/>
          </xe:group>
        </xe:group>
      </xe:expandgroup>
      <xe:separator/>
      <xe:include key="dialog-asset-edit-communication"/>
      <xe:separator/>
      <xe:include key="dialog-asset-edit-postal-address"/>
      <xe:separator/>
      <xe:include key="dialog-asset-edit-unavailable"/>
    </xe:group>
  </xe:part>

  <!-- asset edit company dialog -->
  <xe:part id="dialog-asset-edit-company" transactional="true">
    <xe:group align="down" align-y="top">
      <xe:expandgroup caption="${company}" id="company" expanded="true" save-state="true" readonly="=$param@readonly">
        <xe:group width="47em" align="down">
          <xe:editfield label="${name}" label-style="label-default" width="30em" source="asset_feature[feature='censhare:address.company']@value_string" data-type="VARCHAR(128)">
            <xe:change dest="@name" value="=:(asset/asset_feature[@feature='censhare:address.company']/@value_string)" allow-set-null="true"/>
            <xe:validate not-empty="true"/>
          </xe:editfield>
        </xe:group>
      </xe:expandgroup>
      <xe:separator/>
      <xe:include key="dialog-asset-edit-communication"/>
      <xe:separator/>
      <xe:include key="dialog-asset-edit-postal-address"/>
    </xe:group>
  </xe:part>

  <!--  asset edit communication dialog  -->
  <xe:part id="dialog-asset-edit-communication" transactional="true">
    <xe:expandgroup caption="${communication}" id="communication" expanded="true" save-state="true" readonly="=$param@readonly">
      <xe:group align="down">
        <!-- telephone numbers -->
        <xe:group align="right" width="47em">
          <xe:label label="=:cs:cachelookup('feature', '@key', 'censhare:address.com-tel-type')/@name" label-style="label-default" align-y="top"/>
          <xe:foreach source="asset_feature[feature='censhare:address'].asset_feature" align="down">
            <xe:inititems>
              <xe:inititem dest="@feature" value="censhare:address.com-tel-type"/>
            </xe:inititems>
            <xe:row-filters>
              <xe:filter source="@feature" operator="=" match="censhare:address.com-tel-type"/>
            </xe:row-filters>
            <xe:group>
              <xe:popupmenu width="10em" source="@value_key" margin-right="1em" defaultvalue="work">
                <xe:options value-key="@value_key" label-key="@name">
                  <xe:generator name="filtered_cachedtables" table-name="feature_value" source="@feature" match-source="$current@feature"/>
                  <xe:sort key="@sorting" data-type="integer"/>
                </xe:options>
                <xe:validate not-null="true"/>
              </xe:popupmenu>
              <xe:editfield source="asset_feature[feature='censhare:address.uri-tel']@value_string" weight-x="1" data-type="VARCHAR(32)">
                <xe:validate regex="^([\+\(\)\-\/\d ]*)$" not-empty="true"/>
              </xe:editfield>
              <xe:deletebutton/>
            </xe:group>
          </xe:foreach>
        </xe:group>
        <!-- email addresses -->
        <xe:group align="right" margin-top="1em" width="47em">
          <xe:label label="=:cs:cachelookup('feature', '@key', 'censhare:address.com-email-type')/@name" label-style="label-default" align-y="top"/>
          <xe:foreach source="asset_feature[feature='censhare:address'].asset_feature" align="down">
            <xe:inititems>
              <xe:inititem dest="@feature" value="censhare:address.com-email-type"/>
            </xe:inititems>
            <xe:row-filters>
              <xe:filter source="@feature" operator="=" match="censhare:address.com-email-type"/>
            </xe:row-filters>
            <xe:group>
              <xe:popupmenu width="10em" source="@value_key" margin-right="1em" defaultvalue="work">
                <xe:options value-key="@value_key" label-key="@name">
                  <xe:generator name="filtered_cachedtables" table-name="feature_value" source="@feature" match-source="$current@feature"/>
                  <xe:sort key="@sorting" data-type="integer"/>
                </xe:options>
                <xe:validate not-null="true"/>
              </xe:popupmenu>
              <xe:editfield source="asset_feature[feature='censhare:address.uri-mailto']@value_string" weight-x="1" data-type="VARCHAR(64)">
                <xe:validate regex="^([0-9a-zA-Z]([-.\w]*[0-9a-zA-Z])*@([0-9a-zA-Z][-\w]*[0-9a-zA-Z]\.)+[a-zA-Z]{2,9})$" not-empty="true"/>
              </xe:editfield>
              <xe:deletebutton/>
            </xe:group>
          </xe:foreach>
        </xe:group>
        <!-- other comunication -->
        <xe:group align="right" margin-top="1em" width="47em">
          <xe:label label="=:cs:cachelookup('feature', '@key', 'censhare:address.com-other-type')/@name" label-style="label-default" align-y="top"/>
          <xe:foreach source="asset_feature[feature='censhare:address'].asset_feature" align="down">
            <xe:inititems>
              <xe:inititem dest="@feature" value="censhare:address.com-other-type"/>
            </xe:inititems>
            <xe:row-filters>
              <xe:filter source="@feature" operator="=" match="censhare:address.com-other-type"/>
            </xe:row-filters>
            <xe:group>
              <xe:popupmenu width="10em" source="@value_key" margin-right="1em" defaultvalue="website">
                <xe:options value-key="@value_key" label-key="@name">
                  <xe:generator name="filtered_cachedtables" table-name="feature_value" source="@feature" match-source="$current@feature"/>
                  <xe:sort key="@sorting" data-type="integer"/>
                </xe:options>
                <xe:validate not-null="true"/>
              </xe:popupmenu>
              <xe:editfield source="asset_feature[feature='censhare:address.uri-generic']@value_string" weight-x="1">
                <xe:validate not-null="true"/>
              </xe:editfield>
              <xe:deletebutton/>
            </xe:group>
          </xe:foreach>
        </xe:group>
        <!-- user information -->
        <xe:group align="right" margin-top="1em" width="65em">
          <xe:label label="=:cs:cachelookup('feature', '@key', 'censhare:address.user-type')/@name" label-style="label-default" align-y="top"/>
          <xe:foreach source="asset_feature[feature='censhare:address'].asset_feature" align="down">
            <xe:inititems>
              <xe:inititem dest="@feature" value="censhare:address.user-type"/>
            </xe:inititems>
            <xe:row-filters>
              <xe:filter source="@feature" operator="=" match="censhare:address.user-type"/>
            </xe:row-filters>
            <xe:group>
              <xe:popupmenu width="10em" source="@value_key" margin-right="1em" align-y="top" defaultvalue="website">
                <xe:options value-key="@value_key" label-key="@name">
                  <xe:generator name="filtered_cachedtables" table-name="feature_value" source="@feature" match-source="$current@feature"/>
                  <xe:sort key="@sorting" data-type="integer"/>
                </xe:options>
                <xe:validate not-null="true"/>
              </xe:popupmenu>
              <xe:group align="down">
                <xe:group>
                  <xe:editfield cuetext="=:cs:cachelookup('feature', '@key', 'censhare:address.user-login')/@name" source="asset_feature[feature='censhare:address.user-login']@value_string" weight-x="1"/>
                  <xe:password cuetext="=:cs:cachelookup('feature', '@key', 'censhare:address.user-password')/@name" source="asset_feature[feature='censhare:address.user-password']@value_string" weight-x="1"/>
                </xe:group>
              <xe:popupmenu defaultvalue="de_DE" source="asset_feature[feature='censhare:address.user-locale']@value_string" weight-x="1" >
                <xe:options label-key="@name" value-key="@locale" filter-duplicates="true">
                  <xe:generator name="cachedtables" table-name="java_locale"/>
                  <xe:filter source="@locale" operator="not-empty"/>
                  <xe:sort key="@name" ascending="true"/>
                </xe:options>
              </xe:popupmenu>
              </xe:group>
              <xe:deletebutton align-y="top"/>
            </xe:group>
          </xe:foreach>
        </xe:group>
      </xe:group>
    </xe:expandgroup>
  </xe:part>

  <xe:part id="dialog-asset-edit-postal-address-no-expand" transactional="true">
        <xe:group align="down" width="65em">
        <xe:foreach source="asset_feature[feature='censhare:address'].asset_feature" align="down" >
          <xe:listen-to source="asset_feature[feature='censhare:address'].asset_feature@feature"/>
          <xe:inititems>
            <xe:inititem dest="@feature" value="censhare:address.type"/>
          </xe:inititems>
          <xe:row-filters>
            <xe:filter source="@feature" operator="=" match="censhare:address.type"/>
          </xe:row-filters>
          <xe:group align="right">
            <xe:popupmenu width="15em" source="@value_key" margin-right="1em" align-y="top" defaultvalue="work">
              <xe:options value-key="@value_key" label-key="@name">
                <xe:generator name="filtered_cachedtables" table-name="feature_value" source="@feature" match-source="$current@feature"/>
                <xe:sort key="@sorting" data-type="integer"/>
              </xe:options>
              <xe:validate not-null="true"/>
            </xe:popupmenu>
            <xe:group align="down" align-y="top">
              <!-- action buttons -->
              <xe:group visible="=$param@show_action_buttons">
                <xe:button icon="down" tooltip="${map-address-to-meta-data-address}">
                  <xe:change dest="asset_feature[feature='censhare:address.street']@value_string" source="^.^.tmp_map_address@route"/>
                  <xe:change dest="asset_feature[feature='censhare:address.street-number']@value_string" source="^.^.tmp_map_address@street_number"/>
                  <xe:change dest="asset_feature[feature='censhare:address.zip-code']@value_string" source="^.^.tmp_map_address@zip"/>
                  <xe:change dest="asset_feature[feature='censhare:address.city']@value_string" source="^.^.tmp_map_address@city"/>
                  <xe:change dest="asset_feature[feature='censhare:address.region']@value_string" source="^.^.tmp_map_address@administrative_area_level_1"/>
                  <xe:change dest="asset_feature[feature='censhare:address.country']@value_string" source="^.^.tmp_map_address@country"/>
                  <xe:change dest="asset_feature[feature='censhare:address.country-code']@value_key" source="^.^.tmp_map_address@country_code"/>
                </xe:button>
                <xe:label label="${map-address-to-meta-data-address}"/>
                <xe:button icon="up" enabled="true" tooltip="${meta-data-address-to-map-address}">
                  <xe:change dest="^.^.tmp_map_address@route" source="asset_feature[feature='censhare:address.street']@value_string"/>
                  <xe:change dest="^.^.tmp_map_address@street_number" source="asset_feature[feature='censhare:address.street']@value_string"/>
                  <xe:change dest="^.^.tmp_map_address@zip" source="asset_feature[feature='censhare:address.zip-code']@value_string"/>
                  <xe:change dest="^.^.tmp_map_address@city" source="asset_feature[feature='censhare:address.city']@value_string"/>
                  <xe:change dest="^.^.tmp_map_address@country" source="asset_feature[feature='censhare:address.country']@value_string"/>
                  <xe:change dest="^.^.tmp_map_address@country-code" source="asset_feature[feature='censhare:address.country-code']@value_key"/>
                  <xe:change dest="^.^.tmp2_map_address@in" value="=:string-join((asset_feature/asset_feature[@feature='censhare:address.street']/@value_string, asset_feature/asset_feature[@feature='censhare:address.street-number']/@value_string, asset_feature/asset_feature[@feature='censhare:address.zip-code']/@value_string, asset_feature/asset_feature[@feature='censhare:address.city']/@value_string, asset_feature/asset_feature[@feature='censhare:address.country-code']/@value_key, asset_feature/asset_feature[@feature='censhare:address.country']/@value_string), ' ')"/>
                </xe:button>
              </xe:group>
              <xe:group align="right">
                <xe:editfield cuetext="=:cs:cachelookup('feature', '@key', 'censhare:address.street')/@name" label-align="top" source="asset_feature[feature='censhare:address.street']@value_string" weight-x="1" data-type="VARCHAR(128)"/>
                <xe:editfield cuetext="=:cs:cachelookup('feature', '@key', 'censhare:address.street-number')/@name" label-align="top" source="asset_feature[feature='censhare:address.street-number']@value_string" width="6em" data-type="VARCHAR(16)"/>
              </xe:group>
              <xe:editfield cuetext="=:cs:cachelookup('feature', '@key', 'censhare:address.additional')/@name" label-align="top" source="asset_feature[feature='censhare:address.additional']@value_string" weight-x="1" data-type="VARCHAR(128)"/>
              <xe:editfield cuetext="=:cs:cachelookup('feature', '@key', 'censhare:address.po-box')/@name" label-align="top" source="asset_feature[feature='censhare:address.po-box']@value_string" weight-x="1" data-type="VARCHAR(64)"/>
              <xe:group align="right">
                <xe:editfield cuetext="=:cs:cachelookup('feature', '@key', 'censhare:address.zip-code')/@name" source="asset_feature[feature='censhare:address.zip-code']@value_string" width="5em" data-type="VARCHAR(16)"/>
                <xe:editfield cuetext="=:cs:cachelookup('feature', '@key', 'censhare:address.city')/@name" source="asset_feature[feature='censhare:address.city']@value_string" weight-x="1" data-type="VARCHAR(64)"/>
              </xe:group>
              <xe:editfield cuetext="=:cs:cachelookup('feature', '@key', 'censhare:address.region')/@name" label-align="top" source="asset_feature[feature='censhare:address.region']@value_string" weight-x="1" data-type="VARCHAR(64)"/>
              <xe:popupmenu defaultvalue="DE" source="asset_feature[feature='censhare:address.country-code']@value_key" weight-x="1" sort="ascending">
                <xe:options label-key="@name" value-key="@value_key">
                  <xe:generator name="cachedtables" table-name="feature_value"/>
                  <xe:filter source="@feature" match="censhare:address.country-code"/>
                </xe:options>
              </xe:popupmenu>
              <xe:strut height="1em"/>
            </xe:group>
            <xe:deletebutton align-y="top"/>
          </xe:group>
        </xe:foreach>
      </xe:group>
  </xe:part>
  
  <!-- asset edit postal addresses -->
  <xe:part id="dialog-asset-edit-postal-address" transactional="true">
    <xe:param show_action_buttons="false"/>
    <xe:expandgroup caption="${addresses}" id="addresses" expanded="true" save-state="true" readonly="=$param@readonly">
         <xe:include key="dialog-asset-edit-postal-address-no-expand" />
    </xe:expandgroup>
  </xe:part>
  
    <!-- asset edit postal addresses -->
  <xe:part id="dialog-asset-edit-postal-address-with-scrollpane" transactional="true">
    <xe:param show_action_buttons="false"/>
    <xe:expandgroup caption="${addresses}" id="addresses" expanded="=:count(asset/asset_feature[@feature='censhare:address']/asset_feature) gt 0" save-state="false" readonly="=$param@readonly">
     <xe:scrollpane weight-x="1.0" height="24em" align="down" track-viewport-width="true">
         <xe:include key="dialog-asset-edit-postal-address-no-expand" />
      </xe:scrollpane>
    </xe:expandgroup>
  </xe:part>

  <!-- asset edit unavailable -->
  <xe:part id="dialog-asset-edit-unavailable" transactional="true">
    <xe:param show_action_buttons="false"/>
    <xe:expandgroup caption="${unavailable}" id="unavailable" expanded="true" save-state="true" readonly="=$param@readonly">
      <xe:group align="right">
        <xe:label label="" label-style="label-default" align-y="top"/>
        <xe:group align="down">
          <xe:foreach source="asset_feature" align="down" >
            <xe:inititems>
              <xe:inititem dest="@feature" value="censhare:unavailable"/>
            </xe:inititems>
            <xe:row-filters>
              <xe:filter source="@feature" operator="=" match="censhare:unavailable"/>
            </xe:row-filters>
            <xe:group align="right">
              <xe:date label="${start}" source="@value_timestamp" type="date">
                <xe:validate not-null="true"/>
              </xe:date>
              <xe:strut width="1em"/>
              <xe:date label="${end}" source="@value_timestamp2" type="date">
                <xe:validate not-null="true"/>
              </xe:date>
              <xe:deletebutton align-y="top"/>
            </xe:group>
          </xe:foreach>
        </xe:group>
      </xe:group>
    </xe:expandgroup>
  </xe:part>

  <!-- asset edit product dialog -->
  <xe:part id="dialog-asset-edit-product" transactional="true">
    <xe:group align="down" align-y="top">
      <xe:expandgroup caption="${manufacturer}" id="manufacturer" expanded="true" save-state="true" readonly="=$param@readonly">
        <xe:popupmenu label="${manufacturer}" label-style="label-default" width="30em" source="parent_asset_rel[key='user.manufacturer.']@parent_asset">
          <xe:options label-key="@name" value-key="@id" filter-duplicates="true">
            <xe:generator expression="=:cs:asset()[@censhare:asset.type='address.*']"/>
            <xe:sort key="@name" ascending="true"/>
          </xe:options>
        </xe:popupmenu>
        <xe:deletebutton source="parent_asset_rel[key='user.manufacturer.']"/>
      </xe:expandgroup>
    </xe:group>
  </xe:part>

  <!-- asset edit group dialog -->
  <xe:part id="dialog-asset-edit-group" transactional="true">
    <xe:group align="down" align-y="top">
      <xe:groupbox caption="${group}" label-style="label-default" align="down" label-font-weight="bold">
        <xe:group>
         <xe:foreach show-empty-row="true" source="child_asset_rel" align="down">
           <xe:identify-children-by key="@child_asset"/>
           <xe:inititems>
             <xe:inititem dest="@key" value="user."/>
             <xe:inititem dest="@sorting" value="=:xs:integer(if ($content/asset/child_asset_rel[@key='user.']/@sorting) then max($content/asset/child_asset_rel[@key='user.']/@sorting) else 0) + 1"/>
           </xe:inititems>
           <xe:row-filters>
             <xe:filter source="@key" operator="=" match="user."/>
           </xe:row-filters>
           <xe:sort key="@sorting" data-type="integer" ascending="true"/>
           <xe:group align="down">
             <xe:group align="right">
               <xe:drag-handle align-y="top" tooltip="${change-order}"/>
               <xe:strut width="1em"/>
               <!--xe:assetref width="46em" height="40" source="@child_asset" css-key="asset-info" expression-id="asset-ref-list"/-->
               <xe:auto-completion-field source="@child_asset" search-value-source="$temp@search_group" width="46em" internal-search="false" popup-row-height="40" popup-row-width="46em" css-key="asset-info" expression-id="asset-ref-list" max-items="100">
                 <xe:options label-key="@name" value-key="@id" lookup-expression="=:cs:get-asset(child_asset_rel/@child_asset)">
                   <xe:generator expression="=:if ($temp/temp/@search_group and string-length($temp/temp/@search_group) > 2) then cs:asset()[@censhare:text.name = string($temp/temp/@search_group)] else ()"/>
                   <xe:option label="${new-asset}">
                     <cs:command name="create-new-asset">
                       <cs:param name="asset">
                         <asset type="picture.logo." name="=:$temp/*/@search_group"/>
                       </cs:param>
                       <cs:param name="dialog-key" value="dialog-asset-check-in-new"/>
                     </cs:command>
                   </xe:option>
                 </xe:options>
               </xe:auto-completion-field>
               <xe:uiaction action="asset-editattributes" asset-selection-expression="=@child_asset" align-y="top"/>
               <xe:uiaction action="asset-checkout" asset-selection-expression="=@child_asset" align-y="top"/>
               <xe:uiaction action="server-action" key="basket.add-to-basket" asset-selection-expression="=@child_asset" align-y="top"/>
               <xe:editfield width="3em" source="@sorting" align-y="top"/>
               <xe:strut width="1em"/>
               <xe:move-prev align-y="top" tooltip="${move-forward}"/>
               <xe:move-next align-y="top" tooltip="${move-backward}"/>
               <xe:deletebutton icon="remove" align-y="top" tooltip="${detach}"/>
             </xe:group>
             <xe:separator/>
           </xe:group>
          </xe:foreach>
        </xe:group>
      </xe:groupbox>
    </xe:group>
  </xe:part>

  <!-- asset search assets dialog -->
  <xe:part id="dialog-asset-search-assets" transactional="true">
    <xe:expandgroup caption="${asset-search}" id="asset-search-persons" expanded="true" save-state="true">
      <xe:group align="down">
        <xe:queryfield label="${search}" label-style="label-default" width="30em" source="$temp@search"/>
        <xe:group>
          <xe:label label="${result}" label-style="label-default" align-y="top"/>
          <xe:scrollpane weight-x="1.0" height="20em" align="down" track-viewport-width="true">
            <xe:foreach source="child_asset_rel" max-occurs="50" align="down">
              <xe:listen-to source="$temp@search"/>
              <xe:generator expression="=:if ($temp/*/@search and string-length($temp/*/@search) > 2) then cs:asset()[@censhare:text.meta=string($temp/*/@search)] else ()"/>
              <xe:sort key="@name" data-type="string"/>
              <xe:group align="down">
                <xe:assetref weight-x="1.0" height="40" source="@id" css-key="asset-info" expression-id="asset-ref-list"/>
                <xe:separator/>
              </xe:group>
            </xe:foreach>
          </xe:scrollpane>
        </xe:group>
      </xe:group>
    </xe:expandgroup>
  </xe:part>

  <!-- asset edit employees dialog -->
  <xe:part id="dialog-asset-edit-employees" transactional="true">
    <xe:expandgroup caption="${employees}" id="asset-edit-employees" expanded="true" save-state="true" align="down">
      <xe:group>
        <xe:label font-weight="bold" width="200" value="${name}"/>
        <xe:strut width="1em"/>
        <xe:label font-weight="bold" width="150" value="=:cs:master-data('feature')[@key='censhare:address.function']/@name"/>
        <xe:label font-weight="bold" width="150" value="=:cs:master-data('feature')[@key='censhare:address.department']/@name"/>
        <xe:label font-weight="bold" width="200" value="=:cs:master-data('feature')[@key='censhare:address.uri-mailto']/@name"/>
      </xe:group>
      <xe:separator margin-bottom="10"/>
      <xe:group align="right">
        <xe:foreach source="child_asset_rel" align="down">
          <xe:identify-children-by key="@child_asset"/>
          <xe:inititems>
            <xe:inititem dest="@key" value="user.employee."/>
          </xe:inititems>
          <xe:row-filters>
            <xe:filter source="@key" operator="=" match="user.employee."/>
          </xe:row-filters>
          <xe:sort expression="=:string(cs:get-asset(child_asset_rel/@child_asset)/@name)"/>
          <xe:auto-completion-field search-value-source="$temp@search_group" width="200" internal-search="false" popup-row-height="40" popup-row-width="46em" css-key="asset-info" expression-id="asset-ref-list" max-items="100" source="@child_asset" cuetext="${enter-search-term}">
            <xe:options label-key="@name" option-label-expression="asset-ref-list" lookup-expression="=:cs:get-asset(child_asset_rel/@child_asset)" value-key="@id">
              <xe:generator expression="=:if ($temp/temp/@search_group and string-length($temp/temp/@search_group) &gt; 2) then cs:asset('limit=50')[@censhare:asset.type='person.*' and @censhare:text.name = string($temp/temp/@search_group)] else ()"/>
              <xe:option label="${new-asset}">
                <cs:command name="create-new-asset">
                  <cs:param name="asset">
                    <asset name="=:$temp/*/@search_group" type="person."/>
                  </cs:param>
                  <cs:param name="dialog-key" value="dialog-asset-check-in-new"/>
                </cs:command>
              </xe:option>
            </xe:options>
          </xe:auto-completion-field>
          <xe:strut width="1em"/>
          <xe:label value="=:cs:get-asset(child_asset_rel/@child_asset)/asset_feature[@feature='censhare:address']/asset_feature[@feature='censhare:address.personal-data']/asset_feature[@feature='censhare:address.function']/@value_string" width="150">
            <xe:listen-to source="@child_asset"/>
          </xe:label>
          <xe:label value="=:cs:get-asset(child_asset_rel/@child_asset)/asset_feature[@feature='censhare:address']/asset_feature[@feature='censhare:address.personal-data']/asset_feature[@feature='censhare:address.department']/@value_string" width="150">
            <xe:listen-to source="@child_asset"/>
          </xe:label>
           <xe:html label-wordwrap="true" css-key="asset-info-link" width="200">
            <xe:html-value>
              <![CDATA[
                =:concat('<html><a class="asset-info-link"; href="mailto:',cs:get-asset(child_asset_rel/@child_asset)/asset_feature[@feature='censhare:address']/asset_feature[@feature='censhare:address.com-email-type' and @value_key='work']/asset_feature[@feature='censhare:address.uri-mailto']/@value_string, '">', cs:get-asset(child_asset_rel/@child_asset)/asset_feature[@feature='censhare:address']/asset_feature[@feature='censhare:address.com-email-type' and @value_key='work']/asset_feature[@feature='censhare:address.uri-mailto']/@value_string , '<a/></html>')
              ]]>
            </xe:html-value>
            <xe:listen-to source="@child_asset"/>
          </xe:html>
          <xe:uiaction action="asset-editattributes" align-y="center" asset-selection-expression="=@child_asset">
            <xe:listen-to source="@child_asset"/>
          </xe:uiaction>
          <xe:deletebutton align-y="center" icon="remove" tooltip="${detach}">
            <xe:listen-to source="@child_asset"/>
          </xe:deletebutton>
        </xe:foreach>
      </xe:group>
    </xe:expandgroup>
  </xe:part>

  <!-- asset search persons dialog -->
  <xe:part id="dialog-asset-search-persons" transactional="true">
    <xe:expandgroup caption="${search-for-employees}" id="asset-search-persons" expanded="true" save-state="true">
      <xe:group align="down">
        <xe:queryfield label="${search}" label-style="label-default" width="30em" source="$temp@search"/>
        <xe:group>
          <xe:label label="${result}" label-style="label-default" align-y="top"/>
          <xe:scrollpane weight-x="1.0" height="20em" align="down" track-viewport-width="true">
            <xe:foreach source="child_asset_rel" max-occurs="50" align="down">
              <xe:listen-to source="$temp@search"/>
              <xe:generator expression="=:if ($temp/*/@search and string-length($temp/*/@search) > 2) then cs:asset()[@censhare:text.meta=string($temp/*/@search) and @censhare:asset.type='person.*'] else ()"/>
              <xe:sort key="@name" data-type="string"/>
              <xe:group align="down">
                <xe:assetref weight-x="1.0" height="40" source="@id" css-key="asset-info" expression-id="asset-ref-list">
                  <xe:drop-filter condition="=:starts-with(asset/@type, 'person.')"/>
                </xe:assetref>
                <xe:separator/>
              </xe:group>
            </xe:foreach>
          </xe:scrollpane>
        </xe:group>
      </xe:group>
    </xe:expandgroup>
  </xe:part>

  <!-- asset edit picture dialog -->
  <xe:part id="dialog-asset-edit-picture" transactional="true">
    <xe:group align="down" align-y="top">
      <xe:groupbox caption="${image-caption}" align="down" align-y="top" maxwidth="800" weight-x="1">
        <xe:group align="down">
          <xe:group align="down">
            <xe:foreach source="asset_feature" align="down">
              <xe:inititems>
                <xe:inititem dest="@feature" value="censhare:image-caption"/>
              </xe:inititems>
              <xe:row-filters>
                <xe:filter source="@feature" operator="=" match="censhare:image-caption"/>
              </xe:row-filters>
              <xe:group>
                <xe:editfield weight-x="1" maxwidth="600" source="@value_string">
                  <xe:validate not-empty="true"/>
                </xe:editfield>
                <xe:strut width="1em"/>
                <xe:popupmenu label="${language}" source="@language" sort="ascending">
                  <xe:options label-key="@name" value-key="@id" null-entry="true">
                    <xe:generator name="filtered_cachedtables" table-name="language_def"/>
                  </xe:options>
                </xe:popupmenu>
                <xe:deletebutton/>
              </xe:group>
            </xe:foreach>
          </xe:group>
        </xe:group>
      </xe:groupbox>
    </xe:group>
  </xe:part>

  <!-- asset edit picture iptc dialog -->
  <xe:part id="dialog-asset-edit-picture-iptc" transactional="true">
    <xe:group align="down" readonly="=$param@readonly">
      <!--  iptc core group contact  -->
      <xe:expandgroup caption="=:cs:cachelookup('feature', '@key', 'censhare:iptc.contact')/@name" id="iptc-contact" expanded="true" save-state="true" align="down">
        <xe:editfield label="=:cs:cachelookup('feature', '@key', 'censhare:iptc.creator')/@name" label-style="label-default" source="asset_feature[feature='censhare:iptc'].asset_feature[feature='censhare:iptc.contact'].asset_feature[feature='censhare:iptc.creator']@value_string" maxwidth="600" weight-x="1"/>
        <xe:editfield label="=:cs:cachelookup('feature', '@key', 'censhare:address.function')/@name" label-style="label-default" source="asset_feature[feature='censhare:iptc'].asset_feature[feature='censhare:iptc.contact'].asset_feature[feature='censhare:address.function']@value_string" maxwidth="600" weight-x="1"/>
        <xe:edittext label="=:cs:cachelookup('feature', '@key', 'censhare:address.street')/@name" label-style="label-default" source="asset_feature[feature='censhare:iptc'].asset_feature[feature='censhare:iptc.contact'].asset_feature[feature='censhare:address.street']@value_string" maxwidth="600" weight-x="1" scrollpane="false" rows="1" weight-y="1"/>
        <xe:editfield label="=:cs:cachelookup('feature', '@key', 'censhare:address.city')/@name" label-style="label-default" source="asset_feature[feature='censhare:iptc'].asset_feature[feature='censhare:iptc.contact'].asset_feature[feature='censhare:address.city']@value_string" maxwidth="600" weight-x="1"/>
        <xe:editfield label="=:cs:cachelookup('feature', '@key', 'censhare:address.region')/@name" label-style="label-default" source="asset_feature[feature='censhare:iptc'].asset_feature[feature='censhare:iptc.contact'].asset_feature[feature='censhare:address.region']@value_string" maxwidth="600" weight-x="1"/>
        <xe:editfield label="=:cs:cachelookup('feature', '@key', 'censhare:address.zip-code')/@name" label-style="label-default" source="asset_feature[feature='censhare:iptc'].asset_feature[feature='censhare:iptc.contact'].asset_feature[feature='censhare:address.zip-code']@value_string" width="200" weight-x="1"/>
        <xe:editfield label="=:cs:cachelookup('feature', '@key', 'censhare:address.country')/@name" label-style="label-default" source="asset_feature[feature='censhare:iptc'].asset_feature[feature='censhare:iptc.contact'].asset_feature[feature='censhare:address.country']@value_string" width="200" weight-x="1"/>
        <xe:edittext label="=:cs:cachelookup('feature', '@key', 'censhare:address.uri-tel')/@name" label-style="label-default" source="asset_feature[feature='censhare:iptc'].asset_feature[feature='censhare:iptc.contact'].asset_feature[feature='censhare:address.uri-tel']@value_string" maxwidth="600" weight-x="1" scrollpane="false" rows="1" weight-y="1"/>
        <xe:edittext label="=:cs:cachelookup('feature', '@key', 'censhare:address.uri-mailto')/@name" label-style="label-default" source="asset_feature[feature='censhare:iptc'].asset_feature[feature='censhare:iptc.contact'].asset_feature[feature='censhare:address.uri-mailto']@value_string" maxwidth="600" weight-x="1" scrollpane="false" rows="1" weight-y="1"/>
        <xe:edittext label="=:cs:cachelookup('feature', '@key', 'censhare:address.uri-generic')/@name" label-style="label-default" source="asset_feature[feature='censhare:iptc'].asset_feature[feature='censhare:iptc.contact'].asset_feature[feature='censhare:address.uri-generic']@value_string" maxwidth="600" weight-x="1" scrollpane="false" rows="1" weight-y="1"/>
      </xe:expandgroup>
      <xe:separator/>
      <!--  iptc core group image  -->
      <xe:expandgroup caption="=:cs:cachelookup('feature', '@key', 'censhare:iptc.image')/@name" id="iptc-image" expanded="true" save-state="true" align="down">
        <xe:group align="right">
          <xe:date label="=:cs:cachelookup('feature', '@key', 'censhare:iptc.date-created')/@name" label-style="label-default" source="asset_feature[feature='censhare:iptc'].asset_feature[feature='censhare:iptc.image'].asset_feature[feature='censhare:iptc.date-created']@value_timestamp"    width="200" widget-type="editfield" type="date"/>
          <xe:deletebutton source="asset_feature[feature='censhare:iptc'].asset_feature[feature='censhare:iptc.image'].asset_feature[feature='censhare:iptc.date-created']@value_timestamp"/>
        </xe:group>
        <xe:editfield label="=:cs:cachelookup('feature', '@key', 'censhare:iptc.genre')/@name" label-style="label-default" source="asset_feature[feature='censhare:iptc'].asset_feature[feature='censhare:iptc.image'].asset_feature[feature='censhare:iptc.genre']@value_string" maxwidth="600" weight-x="1"/>
        <xe:edittext label="=:cs:cachelookup('feature', '@key', 'censhare:iptc.scene-code')/@name" label-style="label-default" source="asset_feature[feature='censhare:iptc'].asset_feature[feature='censhare:iptc.image'].asset_feature[feature='censhare:iptc.scene-code']@value_string" maxwidth="600" weight-x="1" scrollpane="false" rows="1" weight-y="1"/>
        <xe:editfield label="=:cs:cachelookup('feature', '@key', 'censhare:address.additional')/@name" label-style="label-default" source="asset_feature[feature='censhare:iptc'].asset_feature[feature='censhare:iptc.image'].asset_feature[feature='censhare:address.additional']@value_string" maxwidth="600" weight-x="1"/>
        <xe:editfield label="=:cs:cachelookup('feature', '@key', 'censhare:address.city')/@name" label-style="label-default" source="asset_feature[feature='censhare:iptc'].asset_feature[feature='censhare:iptc.image'].asset_feature[feature='censhare:address.city']@value_string" maxwidth="600" weight-x="1"/>
        <xe:editfield label="=:cs:cachelookup('feature', '@key', 'censhare:address.region')/@name" label-style="label-default" source="asset_feature[feature='censhare:iptc'].asset_feature[feature='censhare:iptc.image'].asset_feature[feature='censhare:address.region']@value_string" maxwidth="600" weight-x="1"/>
        <xe:editfield label="=:cs:cachelookup('feature', '@key', 'censhare:address.country')/@name" label-style="label-default" source="asset_feature[feature='censhare:iptc'].asset_feature[feature='censhare:iptc.image'].asset_feature[feature='censhare:address.country']@value_string" maxwidth="600" weight-x="1"/>
        <xe:group align="right">
          <xe:popupmenu label="=:cs:cachelookup('feature', '@key', 'censhare:address.country-code')/@name" label-style="label-default" source="asset_feature[feature='censhare:iptc'].asset_feature[feature='censhare:iptc.image'].asset_feature[feature='censhare:address.country-code']@value_key" width="30em"  weight-x="1" sort="ascending">
            <xe:options value-key="@value_key" label-key="@name">
              <xe:generator name="cachedtables" table-name="feature_value" source="@feature" match="censhare:address.country-code"/>
            </xe:options>
          </xe:popupmenu>
          <xe:deletebutton source="asset_feature[feature='censhare:iptc'].asset_feature[feature='censhare:iptc.image'].asset_feature[feature='censhare:address.country-code']"/>
        </xe:group>
      </xe:expandgroup>
      <xe:separator/>
      <!--  iptc core group content  -->
      <xe:expandgroup caption="=:cs:cachelookup('feature', '@key', 'censhare:iptc.content')/@name" id="iptc-content" expanded="true" save-state="true" align="down">
        <xe:edittext label="=:cs:cachelookup('feature', '@key', 'censhare:iptc.headline')/@name" label-style="label-default" source="asset_feature[feature='censhare:iptc'].asset_feature[feature='censhare:iptc.content'].asset_feature[feature='censhare:iptc.headline']@value_string" maxwidth="600" weight-x="1" scrollpane="false" rows="1" weight-y="1"/>
        <xe:edittext label="=:cs:cachelookup('feature', '@key', 'censhare:iptc.description')/@name" label-style="label-default" source="asset_feature[feature='censhare:iptc'].asset_feature[feature='censhare:iptc.content'].asset_feature[feature='censhare:iptc.description']@value_string" maxwidth="600" weight-x="1" scrollpane="false" rows="1" weight-y="1"/>
        <xe:edittext label="=:cs:cachelookup('feature', '@key', 'censhare:iptc.keywords')/@name" label-style="label-default" source="asset_feature[feature='censhare:iptc'].asset_feature[feature='censhare:iptc.content'].asset_feature[feature='censhare:iptc.keywords']@value_string" maxwidth="600" weight-x="1" scrollpane="false" rows="1" weight-y="1"/>
        <xe:edittext label="=:cs:cachelookup('feature', '@key', 'censhare:iptc.subject-code')/@name" label-style="label-default" source="asset_feature[feature='censhare:iptc'].asset_feature[feature='censhare:iptc.content'].asset_feature[feature='censhare:iptc.subject-code']@value_string" maxwidth="600" weight-x="1" scrollpane="false" rows="1" weight-y="1"/>
        <xe:editfield label="=:cs:cachelookup('feature', '@key', 'censhare:iptc.writer-editor')/@name" label-style="label-default" source="asset_feature[feature='censhare:iptc'].asset_feature[feature='censhare:iptc.content'].asset_feature[feature='censhare:iptc.writer-editor']@value_string" maxwidth="600" weight-x="1"/>
      </xe:expandgroup>
      <xe:separator/>
      <!--  iptc core group status  -->
      <xe:expandgroup caption="=:cs:cachelookup('feature', '@key', 'censhare:iptc.status')/@name" id="iptc-status" expanded="true" save-state="true" align="down">
        <xe:editfield label="=:cs:cachelookup('feature', '@key', 'censhare:iptc.title')/@name" label-style="label-default" source="asset_feature[feature='censhare:iptc'].asset_feature[feature='censhare:iptc.status'].asset_feature[feature='censhare:iptc.title']@value_string" maxwidth="600" weight-x="1"/>
        <xe:editfield label="=:cs:cachelookup('feature', '@key', 'censhare:iptc.job-id')/@name" label-style="label-default" source="asset_feature[feature='censhare:iptc'].asset_feature[feature='censhare:iptc.status'].asset_feature[feature='censhare:iptc.job-id']@value_string" maxwidth="600" weight-x="1"/>
        <xe:edittext label="=:cs:cachelookup('feature', '@key', 'censhare:iptc.instructions')/@name" label-style="label-default" source="asset_feature[feature='censhare:iptc'].asset_feature[feature='censhare:iptc.status'].asset_feature[feature='censhare:iptc.instructions']@value_string" maxwidth="600" weight-x="1" scrollpane="false" rows="1" weight-y="1"/>
        <xe:editfield label="=:cs:cachelookup('feature', '@key', 'censhare:iptc.credit')/@name" label-style="label-default" source="asset_feature[feature='censhare:iptc'].asset_feature[feature='censhare:iptc.status'].asset_feature[feature='censhare:iptc.credit']@value_string" maxwidth="600" weight-x="1"/>
        <xe:editfield label="=:cs:cachelookup('feature', '@key', 'censhare:iptc.source')/@name" label-style="label-default" source="asset_feature[feature='censhare:iptc'].asset_feature[feature='censhare:iptc.status'].asset_feature[feature='censhare:iptc.source']@value_string" maxwidth="600" weight-x="1"/>
        <xe:edittext label="=:cs:cachelookup('feature', '@key', 'censhare:iptc.copyright-notice')/@name" label-style="label-default" source="asset_feature[feature='censhare:iptc'].asset_feature[feature='censhare:iptc.status'].asset_feature[feature='censhare:iptc.copyright-notice']@value_string" maxwidth="600" weight-x="1" scrollpane="false" rows="1" weight-y="1"/>
        <xe:edittext label="=:cs:cachelookup('feature', '@key', 'censhare:iptc.usage-terms')/@name" label-style="label-default" source="asset_feature[feature='censhare:iptc'].asset_feature[feature='censhare:iptc.status'].asset_feature[feature='censhare:iptc.usage-terms']@value_string" maxwidth="600" weight-x="1" scrollpane="false" rows="1" weight-y="1"/>
      </xe:expandgroup>
      <xe:separator/>
      <!--  XMP group -->
      <xe:expandgroup caption="=:cs:cachelookup('feature', '@key', 'censhare:xmp')/@name" id="xmp" expanded="true" save-state="true" align="down">
        <xe:editfield label="=:cs:cachelookup('feature', '@key', 'censhare:xmp.creator-tool')/@name" label-style="label-default" source="asset_feature[feature='censhare:xmp'].asset_feature[feature='censhare:xmp.creator-tool']@value_string" maxwidth="600" weight-x="1" readonly="true"/>
        <xe:editfield label="=:cs:cachelookup('feature', '@key', 'censhare:xmp.icc-profile')/@name" label-style="label-default" source="asset_feature[feature='censhare:xmp'].asset_feature[feature='censhare:xmp.icc-profile']@value_string" maxwidth="600" weight-x="1" readonly="true"/>
        <xe:editfield label="=:cs:cachelookup('feature', '@key', 'censhare:xmp.color-mode')/@name" label-style="label-default" value="=:cs:cachelookup('feature_value', '@feature', 'censhare:xmp.color-mode', '@value_key', asset/asset_feature[@feature='censhare:xmp']/asset_feature[@feature='censhare:xmp.color-mode']/@value_key)/@name" maxwidth="600" weight-x="1" readonly="true"/>
        <xe:date label="=:cs:cachelookup('feature', '@key', 'censhare:xmp.modify-date')/@name" label-style="label-default" source="asset_feature[feature='censhare:xmp'].asset_feature[feature='censhare:xmp.modify-date']@value_timestamp" maxwidth="600" weight-x="1" readonly="true" type="date-time"/>
        <xe:group align="right">
          <xe:popupmenu label="=:cs:cachelookup('feature', '@key', 'censhare:xmp.copyright-flag')/@name" label-style="label-default" source="asset_feature[feature='censhare:xmp'].asset_feature[feature='censhare:xmp.copyright-flag']@value_long" width="30em"  weight-x="1" sort="ascending">
            <xe:options value-key="@value" label-key="@label">
              <xe:option label="${protected-by-copyright}" value="1"/>
              <xe:option label="${not-protected}" value="0"/>
            </xe:options>
          </xe:popupmenu>
          <xe:deletebutton source="asset_feature[feature='censhare:xmp'].asset_feature[feature='censhare:xmp.copyright-flag']@value_long"/>
        </xe:group>
        <xe:label label="${rating}" width="200"  label-style="label-default" value="=:if (asset/asset_feature[@feature='censhare:xmp']/asset_feature[@feature='censhare:xmp.rating']/@value_double >= 4.5) then '${5-star}' else if (asset/asset_feature[@feature='censhare:xmp']/asset_feature[@feature='censhare:xmp.rating']/@value_double >= 3.5) then '${4-star}' else if (asset/asset_feature[@feature='censhare:xmp']/asset_feature[@feature='censhare:xmp.rating']/@value_double >= 2.5) then '${3-star}' else if (asset/asset_feature[@feature='censhare:xmp']/asset_feature[@feature='censhare:xmp.rating']/@value_double >= 1.5) then '${2-star}' else if (asset/asset_feature[@feature='censhare:xmp']/asset_feature[@feature='censhare:xmp.rating']/@value_double >= 0.1) then '${1-star}' else '${0-star}'"/>
      </xe:expandgroup>
    </xe:group>
  </xe:part>

  <!-- asset edit feature dialog -->
  <xe:part id="dialog-asset-edit-features" transactional="true">
    <xe:group align="down">

      <!-- category features -->
      <xe:expandgroup caption="${category-features}" id="category-features" expanded="true" save-state="true" align="down" readonly="=$param@readonly">
        <!-- categories -->
        <xe:treeselector label="${categories}" label-style="label-default" label-align="left-top" source="asset_feature" valuesource="@value_key" rows="4" maxwidth="800" weight-x="1">
          <xe:row-filters>
            <xe:filter source="@feature" match="censhare:category"/>
          </xe:row-filters>
          <xe:inititems>
            <xe:inititem dest="@feature" value="censhare:category"/>
          </xe:inititems>
          <xe:treeoptions label-key="@name" value-key="@value_key">
            <xe:generator name="filtered_cachedtables" table-name="feature_value" source="@feature" match="censhare:category"/>
            <xe:sort key="@name" ascending="true"/>
          </xe:treeoptions>
        </xe:treeselector>
        <!-- optional: use list of hierarchical popups
          <xe:strut weight-x="1"/>
          <xe:foreach new-caption="${new-category}" source="asset_feature" align="down">
          <xe:identify-children-by key="@value_key"/>
          <xe:inititems>
          <xe:inititem dest="@feature" value="censhare:category"/>
          <xe:inititem dest="@value_key" value="root."/>
          </xe:inititems>
          <xe:row-filters>
          <xe:filter source="@feature" match="censhare:category"/>
          </xe:row-filters>
          <xe:label value="${category}" width="15em" source="@value_key"/>
          <xe:deletebutton/>
          <xe:popupmenutree source="@value_key" hide-root-popup="false">
          <xe:treeoptions label-key="@name" value-key="@value_key">
          <xe:generator name="filtered_cachedtables" table-name="feature_value" source="@feature" match-source="$current@feature"/>
          </xe:treeoptions>
          </xe:popupmenutree>
          </xe:foreach>
        -->
        <!-- features of categories -->
        <xe:include key="dialog-asset-features-of-category-include"/>
      </xe:expandgroup>
      <xe:separator/>

      <!-- features -->
      <xe:expandgroup caption="${features}" id="features" expanded="true" save-state="true" align="down" readonly="=$param@readonly">
        <xe:include key="dialog-asset-features-of-groups-include">
          <xe:param feature_group="censhare:asset-feature" feature_element_name="asset_feature"/>
        </xe:include>
      </xe:expandgroup>

      <!-- internal features (only visible at admin mode) -->
      <xe:group enabled="=:$system/system/@is-admin-mode='true'" visible="=:$system/system/@is-admin-mode='true'" align="down">
        <xe:separator/>
        <xe:expandgroup caption="${features} (internal)" id="features-internal" expanded="true" save-state="true" align="down" readonly="=$param@readonly">
          <xe:include key="dialog-asset-features-of-groups-include">
            <xe:param feature_group="censhare:intern" feature_element_name="asset_feature"/>
          </xe:include>
        </xe:expandgroup>
      </xe:group>

    </xe:group>
  </xe:part>

  <!-- asset edit flags dialog -->
  <xe:part id="dialog-asset-edit-flags" transactional="true">
    <xe:group align="down">

      <!-- Production flags -->
      <xe:expandgroup caption="${production-flags}" id="production-flags" expanded="true" save-state="true" align="down" readonly="=$param@readonly">
        <xe:group align="right">
          <xe:label label="${production-flags}" label-style="label-default" align-y="top"/>
          <xe:group align="down">
            <xe:foreach source="asset_feature" align="down">
              <xe:identify-children-by key="@feature"/>
              <xe:identify-children-by key="@value_key"/>
              <xe:inititems>
                <xe:inititem dest="@feature" value="censhare:asset-flag"/>
              </xe:inititems>
              <xe:row-filters>
                <xe:filter source="@feature" operator="=" match="censhare:asset-flag"/>
              </xe:row-filters>
              <xe:group>
                <xe:popupmenu width="30em" source="@value_key" sort="ascending">
                  <xe:options value-key="@value_key" label-key="@name">
                    <xe:generator name="filtered_cachedtables" table-name="feature_value" source="@feature" match-source="$current@feature"/>
                  </xe:options>
                  <xe:validate not-null="true"/>
                  <xe:change dest="$temp@production_flag_modified" value="=int($temp@production_flag_modified) + 1"/>
                </xe:popupmenu>
              </xe:group>
              <xe:deletebutton/>
            </xe:foreach>
          </xe:group>
        </xe:group>
        <xe:group align="right" visible="=lookup('asset_feature', '@feature', 'censhare:asset-flag', '@value_key', 'is-output-template') != null">
          <xe:listen-to source="$temp@production_flag_modified"/>
          <xe:label label="${asset-type-allocations}" label-style="label-default" align-y="top"/>
          <xe:group align="down">
            <xe:foreach source="asset_feature" align="down">
              <xe:identify-children-by key="@feature"/>
              <xe:identify-children-by key="@value_string"/>
              <xe:identify-children-by key="@value_string2"/>
              <xe:sort expression="=cachelookup('asset_typedef','@asset_type','@value_string')@name"/>
              <xe:inititems>
                <xe:inititem dest="@feature" value="censhare:asset-type-allocation"/>
              </xe:inititems>
              <xe:row-filters>
                <xe:filter source="@feature" operator="=" match="censhare:asset-type-allocation"/>
              </xe:row-filters>
              <xe:group>
                <xe:popupmenutree source="@value_string" hide-root-popup="false" sort="ascending">
                  <xe:treeoptions label-key="@name" value-key="@asset_type" add-joker="true">
                    <xe:generator name="cachedtables" table-name="asset_typedef"/>
                    <xe:sort key="@name" ascending="true"/>
                  </xe:treeoptions>
                  <xe:validate not-null="true"/>
                </xe:popupmenutree>
              </xe:group>
              <xe:deletebutton/>
            </xe:foreach>
          </xe:group>
        </xe:group>
      </xe:expandgroup>

      <!-- Template hierarchy -->
      <xe:group visible="=lookup('asset_feature', '@feature', 'censhare:asset-flag', '@value_key', 'is-template') != null || lookup('asset_feature', '@feature', 'censhare:asset-flag', '@value_key', 'is-output-template') != null" align="down">
        <xe:listen-to source="$temp@production_flag_modified"/>
        <xe:separator/>
        <xe:expandgroup caption="${template-hierarchy}" id="template-hierarchy" expanded="true" save-state="true" align="down" readonly="=$param@readonly">
          <!-- xe:listen-to source="$temp@production_flag_modified"/-->
          <xe:group align="right">
            <xe:label label="${template-hierarchy}" label-style="label-default" align-y="top"/>
            <xe:group align="down">
              <xe:foreach source="asset_feature" align="down">
                <xe:identify-children-by key="@feature"/>
                <xe:identify-children-by key="@value_key"/>
                <xe:inititems>
                  <xe:inititem dest="@feature" value="censhare:template-hierarchy"/>
                  <xe:inititem dest="@value_key" value="root."/>
                </xe:inititems>
                <xe:row-filters>
                  <xe:filter source="@feature" operator="=" match="censhare:template-hierarchy"/>
                </xe:row-filters>
                <xe:popupmenutree source="@value_key" hide-root-popup="true">
                  <xe:treeoptions label-key="@name" value-key="@value_key">
                    <xe:generator name="filtered_cachedtables" table-name="feature_value" source="@feature" match-source="$current@feature"/>
                    <xe:sort key="@name" ascending="true"/>
                  </xe:treeoptions>
                </xe:popupmenutree>
                <xe:deletebutton/>
              </xe:foreach>
            </xe:group>
          </xe:group>
        </xe:expandgroup>
      </xe:group>

      <!-- Placement categories -->
      <xe:separator/>
      <xe:expandgroup caption="${placement-categories}" id="placement-categories" expanded="true" save-state="true" align="down" readonly="=$param@readonly">
        <xe:group align="right">
          <xe:label label="${placement-categories}" label-style="label-default" align-y="top"/>
          <xe:group align="down">
            <xe:foreach source="asset_feature" align="down">
              <xe:identify-children-by key="@feature"/>
              <xe:identify-children-by key="@value_key"/>
              <xe:sort expression="=cachelookup('feature_value','@feature','@feature','@value_key','@value_key')@name"/>
              <xe:inititems>
                <xe:inititem dest="@feature" value="censhare:placement-category"/>
              </xe:inititems>
              <xe:row-filters>
                <xe:filter source="@feature" operator="=" match="censhare:placement-category"/>
              </xe:row-filters>
              <xe:popupmenu width="30em" source="@value_key" sort="ascending">
                <xe:options value-key="@value_key" label-key="@name">
                  <xe:generator name="filtered_cachedtables" table-name="feature_value" source="@feature" match-source="$current@feature"/>
                  <xe:sort key="@name" ascending="true"/>
                </xe:options>
                <xe:validate not-null="true"/>
              </xe:popupmenu>
              <xe:deletebutton/>
            </xe:foreach>
          </xe:group>
        </xe:group>
      </xe:expandgroup>

      <!-- Ressource asset -->
      <xe:group visible="=:cs:equal-values(asset/@type)" align="down">
        <xe:separator/>
        <xe:expandgroup caption="${resource}" id="resource" expanded="true" save-state="true" align="down" readonly="=$param@readonly">
          <xe:foreach source="asset_feature" align="down" max-occurs="1">
            <xe:identify-children-by key="@feature"/>
            <xe:inititems>
              <xe:inititem dest="@feature" value="censhare:resource-key"/>
              <xe:inititem dest="$content.asset_feature[feature='censhare:resource-meta']@feature" value="censhare:resource-meta"/>
            </xe:inititems>
            <xe:row-filters>
              <xe:filter source="@feature" operator="=" match="censhare:resource-key"/>
            </xe:row-filters>
            <xe:group align="down">
              <xe:deletebutton>
                <xe:delete dest="$content.asset_feature[feature='censhare:resource-key']"/>
                <xe:delete dest="$content.asset_feature[feature='censhare:resource-meta']"/>
                <xe:delete dest="$content.asset_feature[feature='censhare:resource-usage']"/>
                <xe:delete dest="$content.asset_feature[feature='censhare:resource-role']"/>
                <xe:delete dest="$content.asset_feature[feature='censhare:resource-enabled']"/>
                <xe:delete dest="$content.asset_feature[feature='censhare:resource-in-cached-tables']"/>
              </xe:deletebutton>
              <xe:checkbox label="${enabled}" label-style="label-default" source="$content.asset_feature[feature='censhare:resource-enabled']@value_long" unchecked-value="0" checked-value="1" defaultvalue="1" readonly="=:boolean(starts-with($content/asset/@type,'module.feature.'))"/>
              <xe:checkbox label="${cached-tables}" label-style="label-default" caption="${add}" source="$content.asset_feature[feature='censhare:resource-in-cached-tables']@value_long" unchecked-value="0" checked-value="1" defaultvalue="1"/>
              <xe:edittext label="${key}" label-align="left-top" label-style="label-default" width="30em" scrollpane="false" rows="1" source="@value_string" readonly="=:boolean(starts-with($content/asset/@type,'module.feature.'))">
                <xe:listen-to source="$content.asset_feature[feature='censhare:resource-enabled']@value_long"/>
                <xe:validate not-empty="=:$content/asset/asset_feature[@feature='censhare:resource-enabled']/@value_long='1'"/>
              </xe:edittext>
              <xe:editfield label="${priority}" label-align="left-top" label-style="label-default" width="30em" source="$content.asset_feature[feature='censhare:resource-priority']@value_long"/>
              <xe:select source="$content.asset_feature[feature='censhare:resource-meta']" align="down">
                <xe:edittext label="${target-element-name}" label-align="left-top" label-style="label-default" width="30em" scrollpane="false" flush-on-keystroke="true" rows="1" source="xmldata@target-element-name" visible="=:cs:equal-values($content/asset/@type) and starts-with($content/asset[1]/@type,'module.transformation.')"/>
                <xe:edittext label="${source-asset-filter}" label-align="left-top" label-style="label-default" width="30em" scrollpane="false" flush-on-keystroke="true" rows="1" source="xmldata@source-asset-filter"/>
                <xe:edittext label="${target-asset-filter}" label-align="left-top" label-style="label-default" width="30em" scrollpane="false" flush-on-keystroke="true" rows="1" source="xmldata@target-asset-filter"/>
                <!-- usages -->
                <xe:group align="right">
                  <xe:label label="${usages}" label-style="label-default" align-y="top"/>
                  <xe:group align="down">
                    <xe:foreach source="$content.asset_feature" align="down">
                      <xe:inititems>
                        <xe:inititem dest="@feature" value="censhare:resource-usage"/>
                      </xe:inititems>
                      <xe:row-filters>
                        <xe:filter source="@feature" operator="=" match="censhare:resource-usage"/>
                      </xe:row-filters>
                      <xe:popupmenu width="30em" source="@value_key" sort="ascending">
                        <xe:options label-key="@name" value-key="@value_key">
                          <xe:generator name="filtered_cachedtables" table-name="feature_value"/>
                          <xe:filter source="@feature" match="censhare:resource-usage"/>
                        </xe:options>
                      </xe:popupmenu>
                      <xe:deletebutton align-y="bottom"/>
                    </xe:foreach>
                  </xe:group>
                </xe:group>
                <!-- roles for usage workspace template -->
                <xe:group align="right" visible="=:count($content/asset) = 1 and exists($content/asset[1]/asset_feature[@feature='censhare:resource-usage' and @value_key=('censhare:workspace-template', 'censhare:preferences-template')])">
                  <xe:listen-to source="$content.asset_feature[feature='censhare:resource-usage']@value_key"/>
                  <xe:label label="${roles}" label-style="label-default" align-y="top"/>
                  <xe:group align="down">
                    <xe:foreach source="$content.asset_feature" align="down">
                      <xe:inititems>
                        <xe:inititem dest="@feature" value="censhare:resource-role"/>
                      </xe:inititems>
                      <xe:row-filters>
                        <xe:filter source="@feature" operator="=" match="censhare:resource-role"/>
                      </xe:row-filters>
                      <xe:popupmenu width="30em" source="@value_string" sort="ascending">
                        <xe:options label-key="@name" value-key="@role">
                          <xe:generator name="filtered_cachedtables" table-name="role"/>
                        </xe:options>
                      </xe:popupmenu>
                      <xe:deletebutton align-y="bottom"/>
                    </xe:foreach>
                  </xe:group>
                </xe:group>
                <!-- target formats -->
                <xe:group align="right">
                  <xe:label label="${target-formats}" label-style="label-default" align-y="top"/>
                  <xe:group align="down">
                    <xe:foreach source="xmldata.target-formats.format" align="down">
                      <xe:group align="right">
                        <xe:editfield label="${key}" width="10em" source="@key"/>
                        <xe:strut width="1em"/>
                        <xe:popupmenu label="${mimetype}" source="@mimetype" sort="ascending">
                          <xe:options label-key="@name" value-key="@mimetype">
                            <xe:generator name="cachedtables" table-name="mimetype"/>
                          </xe:options>
                        </xe:popupmenu>
                      </xe:group>
                      <xe:deletebutton align-y="bottom"/>
                    </xe:foreach>
                  </xe:group>
                </xe:group>
                <!-- events for scripts -->
                <xe:group align="down" visible="=:cs:equal-values($content/asset/@type) and starts-with($content/asset[1]/@type,'module.script.indesign.')">
                  <xe:checkbox label="${box-selection}" label-style="label-default" caption="${necessary}" source="xmldata.selection@needed" defaultvalue="false"/>
                  <xe:group align="right" visible="=:xs:boolean(asset_feature/xmldata/selection/@needed)">
                    <xe:listen-to source="xmldata.selection@needed"/>
                    <xe:label label="" label-style="label-default" value="${fixed-number-of-boxes}"/>
                    <xe:editfield width="4em" source="xmldata.selection@count" data-type="INTEGER">
                      <xe:validate condition="=:string(asset_feature/xmldata/selection/@needed) ne 'true' or not(fn:exists(asset_feature/xmldata/selection/@count)) or xs:integer(asset_feature/xmldata/selection/@count) > 0"/>
                    </xe:editfield>
                  </xe:group>
                  <xe:group align="right">
                    <xe:label label="${events}" label-style="label-default" align-y="top"/>
                    <xe:group align="down">
                      <xe:foreach source="xmldata.events.event" align="down">
                        <xe:popupmenu source="@key">
                          <xe:options>
                            <xe:option label="${after-opening}" value="open-done"/>
                            <xe:option label="${before-save}" value="save"/>
                            <xe:option label="${after-placing}" value="placement-done"/>
                            <xe:option label="${after-updating-content}" value="update-content-done"/>
                            <xe:option label="${before-update-of-layout-geometry-variant}" value="layout-geometry-variant-update-before"/>
                            <xe:option label="${after-update-of-layout-geometry-variant}" value="layout-geometry-variant-update-done"/>
                            <xe:option label="${before-geometry-update}" value="update-geometry-before"/>
                            <xe:option label="${after-geometry-update}" value="update-geometry-done"/>
                            <xe:option label="${preview-layout-editor}" value="layout-editor-preview"/>
                            <xe:option label="${box-modified-layout-editor}" value="box-modified"/>
                            <xe:option label="${before-pdf-generation-renderer}" value="before-pdf-renderer"/>
                          </xe:options>
                          <xe:validate not-null="true"/>
                        </xe:popupmenu>
                        <xe:strut width="1em"/>
                        <xe:editfield label="${target-asset-filter}:" weight-x="1" maxwidth="600" source="@target-asset-filter"/>
                        <xe:deletebutton/>
                      </xe:foreach>
                    </xe:group>
                  </xe:group>
                </xe:group>
              </xe:select>
            </xe:group>
          </xe:foreach>
        </xe:expandgroup>
      </xe:group>

      <!-- Temporary download -->
      <xe:separator/>
      <xe:expandgroup caption="${temporary-download}" id="temporary-download" expanded="true" save-state="true" align="down" readonly="=$param@readonly">
        <xe:foreach source="asset_feature" align="down" max-occurs="1">
          <xe:inititems>
            <xe:inititem dest="@feature" value="censhare:download-hash"/>
            <xe:inititem dest="@value_string" value="=:cs:hash(concat(/asset/@id, current-dateTime()) , 'SHA-1')"/>
          </xe:inititems>
          <xe:row-filters>
            <xe:filter source="@feature" operator="=" match="censhare:download-hash"/>
          </xe:row-filters>
          <xe:group align="down">
            <xe:deletebutton>
              <xe:delete dest="$content.asset_feature[feature='censhare:download-hash']"/>
              <xe:delete dest="$content.asset_feature[feature='censhare:expiry-date']"/>
            </xe:deletebutton>
            <xe:editfield label="${hash-code}" label-style="label-default" width="30em" source="@value_string" readonly="true"/>
            <xe:editdate label="${until}" label-style="label-default" width="30em" source="$content.asset_feature[feature='censhare:expiry-date']@value_timestamp"/>
            <xe:label label="${url}" label-style="label-default" value="='/tempDownload/' + @value_string"/>
          </xe:group>
        </xe:foreach>
      </xe:expandgroup>

      <!-- Youtube -->
      <xe:group visible="=:boolean(asset/asset_feature[@feature='censhare:youtube.oauth-token'] or asset/asset_feature[@feature='censhare:youtube.id'])" align="down">
        <xe:separator/>
        <xe:expandgroup caption="YouTube" id="youtube" expanded="true" save-state="true" align="down" readonly="=$param@readonly">
          <xe:group align="right" visible="=:boolean(asset/asset_feature[@feature='censhare:youtube.oauth-token'])">
            <xe:label label="${authentication}" label-style="label-default" value="=:concat('${created}: ', cs:format-date(asset/asset_feature[@feature='censhare:youtube.oauth-token']/@timestamp, 'relative-short', 'short'))" width="30em"/>
            <xe:deletebutton source="asset_feature[feature='censhare:youtube.oauth-token']"/>
          </xe:group>
          <xe:group align="right" visible="=:boolean(asset/asset_feature[@feature='censhare:youtube.id'])">
            <xe:label label="${publication}" label-style="label-default" value="=:concat('${created}: ', cs:format-date(asset/asset_feature[@feature='censhare:youtube.id']/@timestamp, 'relative-short', 'short'))" width="30em"/>
            <xe:deletebutton>
              <xe:delete dest="$content.asset_feature[feature='censhare:youtube.id']"/>
              <xe:delete dest="$content.asset_feature[feature='censhare:youtube.title']"/>
              <xe:delete dest="$content.asset_feature[feature='censhare:youtube.description']"/>
              <xe:delete dest="$content.asset_feature[feature='censhare:youtube.category']"/>
            </xe:deletebutton>
          </xe:group>
          <xe:label label="" label-style="label-default" value="=:asset/asset_feature[@feature='censhare:youtube.title']/@value_string" visible="=:boolean(asset/asset_feature[@feature='censhare:youtube.title'])"/>
          <xe:label label="" label-style="label-default" value="=:asset/asset_feature[@feature='censhare:youtube.description']/@value_string" visible="=:boolean(asset/asset_feature[@feature='censhare:youtube.description'])"/>
        </xe:expandgroup>
      </xe:group>

      <!-- Facebook -->
      <xe:group visible="=:boolean(asset/asset_feature[@feature='censhare:facebook.oauth-token'] or asset/asset_feature[@feature='censhare:facebook.id'])" align="down">
        <xe:separator/>
        <xe:expandgroup caption="Facebook" id="facebook" expanded="true" save-state="true" align="down" readonly="=$param@readonly">
          <xe:group align="right" visible="=:boolean(asset/asset_feature[@feature='censhare:facebook.oauth-token'])">
            <xe:label label="${authentication}" label-style="label-default" value="=:concat('${created}: ', cs:format-date(asset/asset_feature[@feature='censhare:facebook.oauth-token']/@timestamp, 'relative-short', 'short'))" width="30em"/>
            <xe:deletebutton source="asset_feature[feature='censhare:facebook.oauth-token']"/>
          </xe:group>
          <xe:group align="right" visible="=:boolean(asset/asset_feature[@feature='censhare:facebook.id'])">
            <xe:label label="${publication}" label-style="label-default" value="=:concat('${created}: ', cs:format-date(asset/asset_feature[@feature='censhare:facebook.id']/@timestamp, 'relative-short', 'short'))" width="30em"/>
            <xe:deletebutton>
              <xe:delete dest="$content.asset_feature[feature='censhare:facebook.id']"/>
              <xe:delete dest="$content.asset_feature[feature='censhare:facebook.message']"/>
            </xe:deletebutton>
          </xe:group>
          <xe:label label="" label-style="label-default" value="=:asset/asset_feature[@feature='censhare:facebook.message']/@value_string" visible="=:boolean(asset/asset_feature[@feature='censhare:facebook.message'])"/>
        </xe:expandgroup>
      </xe:group>

      <!-- Twitter -->
      <xe:group visible="=:boolean(asset/asset_feature[@feature='censhare:twitter.oauth-token'] or asset/asset_feature[@feature='censhare:twitter.id'])" align="down">
        <xe:separator/>
        <xe:expandgroup caption="Twitter" id="twitter" expanded="true" save-state="true" align="down" readonly="=$param@readonly">
          <xe:group align="right" visible="=:boolean(asset/asset_feature[@feature='censhare:twitter.oauth-token'])">
            <xe:label label="${authentication}" label-style="label-default" value="=:concat('${created}: ', cs:format-date(asset/asset_feature[@feature='censhare:twitter.oauth-token']/@timestamp, 'relative-short', 'short'))" width="30em"/>
            <xe:deletebutton source="asset_feature[feature='censhare:twitter.oauth-token']"/>
          </xe:group>
          <xe:group align="right" visible="=:boolean(asset/asset_feature[@feature='censhare:twitter.id'])">
            <xe:label label="${publication}" label-style="label-default" value="=:concat('${created}: ', cs:format-date(asset/asset_feature[@feature='censhare:twitter.id']/@timestamp, 'relative-short', 'short'))" width="30em"/>
            <xe:deletebutton>
              <xe:delete dest="$content.asset_feature[feature='censhare:twitter.id']"/>
              <xe:delete dest="$content.asset_feature[feature='censhare:twitter.message']"/>
            </xe:deletebutton>
          </xe:group>
          <xe:label label="" label-style="label-default" value="=:asset/asset_feature[@feature='censhare:twitter.message']/@value_string" visible="=:boolean(asset/asset_feature[@feature='censhare:twitter.message'])"/>
        </xe:expandgroup>
      </xe:group>

    </xe:group>
  </xe:part>

  <!-- asset edit meta data include -->
  <xe:part id="dialog-asset-edit-include" transactional="true">
    <xe:param readonly="false" show_preview="false" show_deadline_calculated="false" show_search_buttons="false"/>
    <xe:group align="down" readonly="=$param@readonly">
      <!-- asset type specific infos -->
      <xe:selectcase value="=true">
        <!-- asset type address -->
        <xe:case value="=:cs:equal-values(asset/@type) and starts-with(asset[1]/@type,'address.')">
          <xe:group align="down">
            <xe:group align="right">
              <xe:include key="dialog-asset-edit-main-picture"/>
              <xe:strut width="1em"/>
              <xe:include key="dialog-asset-edit-company"/>
            </xe:group>
            <xe:strut height="1em"/>
            <xe:include key="dialog-asset-edit-employees"/>
            <!-- <xe:include key="dialog-asset-search-persons"/> -->
          </xe:group>
        </xe:case>
        <!-- asset type person -->
        <xe:case value="=:cs:equal-values(asset/@type) and starts-with(asset[1]/@type,'person.')">
          <xe:group align="down">
            <xe:group align="right">
              <xe:include key="dialog-asset-edit-main-picture"/>
              <xe:strut width="1em"/>
              <xe:include key="dialog-asset-edit-person"/>
            </xe:group>
            <xe:strut height="1em"/>
          </xe:group>
        </xe:case>
        <!-- asset type product -->
        <xe:case value="=:cs:equal-values(asset/@type) and starts-with(asset[1]/@type,'product.')">
          <xe:group align="down">
            <xe:group align="right">
              <xe:include key="dialog-asset-edit-main-picture"/>
              <xe:strut width="1em"/>
              <xe:include key="dialog-asset-edit-product"/>
            </xe:group>
            <xe:strut height="1em"/>
          </xe:group>
        </xe:case>
        <!--xe:case value="=:cs:equal-values(asset/@type) and starts-with(asset[1]/@type,'group.')">
          <xe:group align="down">
            <xe:include key="dialog-asset-edit-group"/>
            <xe:include key="dialog-asset-search-assets"/>
            <xe:strut height="1em"/>
          </xe:group>
        </xe:case-->
        <xe:case value="=:cs:equal-values(asset/@type) and starts-with(asset[1]/@type,'picture.') and asset/storage_item[@key='preview' or @key='text-preview']">
          <xe:selectcase value="=true">
            <xe:case value="=$param@show_preview">
              <xe:group align="down">
                <xe:group align="right" enabled="=$param@show_preview">
                  <xe:assetpreview height="20em" width="30em" storagekey="thumbnail"/>
                  <xe:strut width="1em"/>
                  <xe:scrollpane weight-x="1" height="20em" align="down" track-viewport-width="true">
                    <xe:include key="dialog-asset-edit-picture"/>
                  </xe:scrollpane>
                </xe:group>
                <xe:strut height="1em"/>
              </xe:group>
            </xe:case>
            <xe:defaultcase>
              <xe:group align="down" enabled="=:$param/param/@show_preview='true' and count(asset)=1 and asset/storage_item[@key='preview' or @key='text-preview']">
                <xe:include key="dialog-asset-edit-picture"/>
                <xe:strut height="1em"/>
              </xe:group>
            </xe:defaultcase>
          </xe:selectcase>
        </xe:case>
        <xe:defaultcase>
          <xe:assetpreview height="30em" weight-x="1" storagekey="thumbnail" visible="=:$param/param/@show_preview='true' and asset/storage_item[@key='preview' or @key='text-preview']"/>
        </xe:defaultcase>
      </xe:selectcase>
      <!-- meta data -->
      <xe:expandgroup caption="${asset-meta-data}" id="asset-meta-data" expanded="true" save-state="true" align="down">
        <!-- name -->
        <xe:editfield label="${name}" label-style="label-default" weight-x="1" source="@name" data-type="VARCHAR(256)">
          <xe:validate not-empty="true"/>
          <!-- example for a unique name -->
          <!--xe:validate condition="=:not(boolean(cs:asset()[@censhare:asset.name=string(*/@name) and @censhare:asset.id!=string(*/@id)]))"/-->
        </xe:editfield>
        <xe:selectcase value="=true">
          <xe:case value="=:cs:equal-values(asset/@type) and starts-with(asset[1]/@type,'module.') or (count(asset) = 1 and exists(asset[1]/asset_feature[@feature='censhare:resource-key']))">
            <xe:group align="right">
              <xe:label label="" label-style="label-default"/>
              <xe:group align="down">
                <xe:foreach source="asset_feature" align="down">
                  <xe:inititems>
                    <xe:inititem dest="@feature" value="censhare:name"/>
                  </xe:inititems>
                  <xe:row-filters>
                    <xe:filter source="@feature" operator="=" match="censhare:name"/>
                  </xe:row-filters>
                  <xe:group>
                    <xe:editfield weight-x="1" maxwidth="600" source="@value_string">
                      <xe:validate not-empty="true"/>
                    </xe:editfield>
                    <xe:popupmenu label="${language}" source="@language" sort="ascending">
                      <xe:options label-key="@name" value-key="@id" null-entry="true">
                        <xe:generator name="filtered_cachedtables" table-name="language_def"/>
                      </xe:options>
                      <xe:validate not-empty="true"/>
                    </xe:popupmenu>
                    <xe:deletebutton/>
                  </xe:group>
                </xe:foreach>
              </xe:group>
            </xe:group>
          </xe:case>
        </xe:selectcase>
        <!-- type -->
        <xe:popupmenutree label="${type}" label-style="label-default" source="@type" hide-root-popup="false" sort="ascending">
          <xe:treeoptions label-key="@name" value-key="@asset_type">
            <xe:generator name="filtered_cachedtables" table-name="asset_typedef"/>
          </xe:treeoptions>
          <xe:validate condition="=:empty(for $asset in asset return if (starts-with($asset/@domain, cs:cachelookup('asset_typedef', '@asset_type', $asset/@type)/@domain) and starts-with($asset/@domain2, cs:cachelookup('asset_typedef', '@asset_type', $asset/@type)/@domain2)) then () else '1')"/>
        </xe:popupmenutree>
        <!-- workflow -->
        <xe:group>
          <xe:popupmenu label="${workflow}" label-style="label-default" source="@wf_id" width="30em" sort="ascending">
            <xe:options label-key="@name" value-key="@id">
              <xe:generator name="filtered_cachedtables" table-name="workflow"/>
            </xe:options>
          </xe:popupmenu>
          <xe:deletebutton source="@wf_id"/>
        </xe:group>
        <xe:group>
          <xe:popupmenu label="${workflow-step}" label-style="label-default" source="@wf_step" width="30em" visible="=@wf_id != null">
            <xe:options label-key="@name" value-key="@wf_step">
              <xe:generator name="filtered_cachedtables" table-name="workflow_step" source="@wf_id" match-source="$current@wf_id"/>
              <xe:sort key="@sorting" data-type="integer"/>
            </xe:options>
            <xe:listen-to source="@wf_id" is-key-part="true">
              <xe:change dest="@wf_step" value="=cachelookup('workflow', '@id', '@wf_id')@def_step"/>
            </xe:listen-to>
          </xe:popupmenu>
          <xe:colorpicker value="=cachelookup('workflow_step', '@wf_id', '@wf_id', '@wf_step', '@wf_step')@color" readonly="true" visible="=@wf_id != null">
            <xe:listen-to source="@wf_id"/>
            <xe:listen-to source="@wf_step"/>
          </xe:colorpicker>
        </xe:group>
        <xe:group>
          <xe:auto-completion-field label="${workflow-target}" label-style="label-default" cuetext="${enter-search-term}" width="30em" source="@wf_target" sort="ascending">
            <xe:options label-key="@display_name" value-key="@id">
              <xe:generator name="filtered_cachedtables" table-name="party" source="@isvisible" match="1"/>
              <xe:sort key="@display_name"/>
            </xe:options>
            <xe:listen-to source="@wf_id">
              <xe:listen-to source="@wf_step">
                <xe:change dest="@wf_target" value="=cachelookup('workflow_step', '@wf_id', '@wf_id', '@wf_step', '@wf_step')@def_party" allow-set-null="true"/>
              </xe:listen-to>
            </xe:listen-to>
          </xe:auto-completion-field>
          <!--xe:popupmenu label="${workflow-target}" label-style="label-default" width="30em" source="@wf_target" sort="ascending">
            <xe:options label-key="@display_name" value-key="@id">
              <xe:generator name="filtered_cachedtables" table-name="party" source="@isvisible" match="1"/>
            </xe:options>
            <xe:listen-to source="@wf_id">
              <xe:listen-to source="@wf_step">
                <xe:change dest="@wf_target" value="=cachelookup('workflow_step', '@wf_id', '@wf_id', '@wf_step', '@wf_step')@def_party" allow-set-null="true"/>
              </xe:listen-to>
            </xe:listen-to>
          </xe:popupmenu-->
          <xe:deletebutton source="@wf_target"/>
          <xe:button icon="user" tooltip="${use-me-as-workflow-target}">
            <xe:change dest="@wf_target" value="=:$system/system/party/@id"/>
          </xe:button>
        </xe:group>
        <!-- deadline -->
        <xe:group>
          <xe:group>
            <xe:editdate label="${deadline-manual}" label-style="label-default" width="30em" source="@deadline"/>
            <xe:deletebutton source="@deadline"/>
          </xe:group>
          <xe:editdate label="${calculated}" source="@deadline_calc" readonly="true" enabled="=$param@show_deadline_calculated"/>
        </xe:group>
        <!-- domains -->
        <xe:popupmenutree label="${domain}" label-style="label-default" source="@domain" hide-root-popup="false" defaultvalue="root.">
          <xe:treeoptions label-key="@name" value-key="@pathid">
            <xe:generator name="filtered_cachedtables" table-name="domain"/>
            <xe:sort key="@sorting" data-type="integer"/>
          </xe:treeoptions>
        </xe:popupmenutree>
        <xe:popupmenutree label="${domain2}" label-style="label-default" source="@domain2" hide-root-popup="false" defaultvalue="root." visible="=:count(cs:master-data('domain2')) gt 1">
          <xe:treeoptions label-key="@name" value-key="@pathid">
            <xe:generator name="filtered_cachedtables" table-name="domain2"/>
            <xe:sort key="@sorting" data-type="integer"/>
          </xe:treeoptions>
        </xe:popupmenutree>
        <!-- language -->
        <xe:group>
          <xe:popupmenu label="${language}" label-style="label-default" width="30em" source="@language" sort="ascending">
            <xe:options label-key="@name" value-key="@id">
              <xe:generator name="filtered_cachedtables" table-name="language_def"/>
            </xe:options>
          </xe:popupmenu>
          <xe:deletebutton source="@language"/>
        </xe:group>
        <!-- author -->
        <xe:editfield label="${author}" label-style="label-default" width="30em" source="@author" data-type="VARCHAR(128)"/>
        <!-- flags -->
        <xe:group align="right">
          <xe:checkbox label="Flags" label-style="label-default" caption="${cancellation}" source="@iscancellation" unchecked-value="0" checked-value="1"/>
          <xe:checkbox caption="${snapshot}" source="@snapshot_name" unchecked-value="0" checked-value="1"/>
        </xe:group>
        <!-- color -->
        <xe:group>
          <xe:colorpicker label="${colour}" label-style="label-default" width="16" height="16" source="@color"/>
          <xe:deletebutton source="@color"/>
        </xe:group>
        <!-- rating -->
        <xe:group align="right">
          <xe:label label="${rating}" label-style="label-default"/>
          <xe:foreach source="asset_feature" max-occurs="1">
           <xe:inititems>
             <xe:inititem dest="@feature" value="censhare:rating"/>
             <xe:inititem dest="@party" value="=:$system/system/party/@id"/>        
           </xe:inititems>
           <xe:row-filters>
             <xe:filter source="@feature" match="censhare:rating" />
             <xe:filter source="@party" match="=:$system/system/party/@id" />                  
           </xe:row-filters>
           <xe:popupmenu width="30em" source="@value_double">
              <xe:options>
                <xe:option label="${1-star}" value="1.0"/>
                <xe:option label="${2-star}" value="2.0"/>
                <xe:option label="${3-star}" value="3.0"/>
                <xe:option label="${4-star}" value="4.0"/>
                <xe:option label="${5-star}" value="5.0"/>
              </xe:options>
            </xe:popupmenu>
            <xe:deletebutton/>
          </xe:foreach>
        </xe:group>
        <!-- planning mode -->
        <xe:group align="right">
          <xe:popupmenu label="=:cs:cachelookup('feature','@key', 'censhare:planning-mode')/@name" label-style="label-default" width="30em" source="asset_feature[feature='censhare:planning-mode']@value_key">
            <xe:options label-key="@name" value-key="@value_key">
              <xe:generator name="cachedtables" table-name="feature_value" source="@feature" match="censhare:planning-mode"/>
            </xe:options>
          </xe:popupmenu>
          <xe:deletebutton source="asset_feature[feature='censhare:planning-mode']"/>
        </xe:group>
        <!-- application -->
        <xe:popupmenu label="${application}" label-style="label-default" width="30em" source="@application" sort="ascending">
          <xe:options label-key="@name" value-key="@id">
            <xe:generator name="cachedtables" table-name="asset_application"/>
          </xe:options>
        </xe:popupmenu>
        <!-- channels -->
        <xe:treeselector label="${channels}" label-style="label-default" label-align="left-top" source="asset_feature" valuesource="@value_key" rows="4" maxwidth="600" weight-x="1">
          <xe:row-filters>
            <xe:filter source="@feature" match="censhare:output-channel"/>
          </xe:row-filters>
          <xe:inititems>
            <xe:inititem dest="@feature" value="censhare:output-channel"/>
          </xe:inititems>
          <xe:treeoptions label-key="@name" value-key="@value_key">
            <xe:generator name="filtered_cachedtables" table-name="feature_value" source="@feature" match="censhare:output-channel"/>
            <xe:sort key="@sorting" data-type="integer" ascending="true"/>
          </xe:treeoptions>
        </xe:treeselector>
      </xe:expandgroup>
      <!-- keywords -->
      <xe:separator/>
      <xe:expandgroup caption="${keywords}" id="keywords" save-state="true" align="down">
        <!-- keyword tree -->
        <xe:treeselector label="${keyword-tree}" label-style="label-default" label-align="left-top" source="asset_feature" valuesource="@value_key" rows="4" maxwidth="600" weight-x="1">
          <xe:row-filters>
            <xe:filter source="@feature" match="censhare:keyword"/>
          </xe:row-filters>
          <xe:inititems>
            <xe:inititem dest="@feature" value="censhare:keyword"/>
          </xe:inititems>
          <xe:treeoptions label-key="@name" value-key="@value_key">
            <xe:generator name="filtered_cachedtables" table-name="feature_value" source="@feature" match="censhare:keyword"/>
            <xe:sort key="@sorting" data-type="integer" ascending="true"/>
          </xe:treeoptions>
        </xe:treeselector>
        <!-- optional: use list of hierarchical popups
          <xe:groupbox caption="${keywords}" minwidth="250" align="down">
          <xe:strut weight-x="1"/>
          <xe:foreach new-caption="${new-keyword}" source="asset_feature" align="down">
          <xe:identify-children-by key="@feature"/>
          <xe:identify-children-by key="@value_key"/>
          <xe:sort expression="=cachelookup('feature_value','@feature',@feature,'@value_key','@value_key')@name${localized-attr-suffix}"/>
          <xe:row-filters>
          <xe:filter source="@feature" match="censhare:keyword"/>
          </xe:row-filters>
          <xe:inititems>
          <xe:inititem dest="@feature" value="censhare:keyword"/>
          <xe:inititem dest="@value_key" value="root."/>
          </xe:inititems>
          <xe:deletebutton/>
          <xe:popupmenutree source="@value_key" hide-root-popup="true">
          <xe:treeoptions label-key="@name" value-key="@value_key">
          <xe:generator name="filtered_cachedtables" table-name="feature_value" source="@feature" match="censhare:keyword"/>
          <xe:sort key="@sorting" data-type="integer" ascending="true"/>
          </xe:treeoptions>
          </xe:popupmenutree>
          </xe:foreach>
          </xe:groupbox>
        -->
        <!-- keywords -->
        <xe:edittext label="${keywords}" label-style="label-default" weight-x="1" maxwidth="600" rows="2" source="@keywords" data-type="VARCHAR(3500)"/>
      </xe:expandgroup>
      <!-- annotation and description -->
      <xe:separator/>
      <xe:expandgroup caption="${annotation-and-description}" id="annotation-and-description" save-state="true" align="down">
        <!-- annotation-->
        <xe:edittext label="${annotation}" label-align="left-top" label-style="label-default" prefwidth="30em" maxwidth="600" weight-x="1" scrollpane="false" rows="1" weight-y="1" source="@annotation" data-type="VARCHAR(3500)"/>
        <!-- description -->
        <xe:edittext label="${description}" label-align="left-top" label-style="label-default" prefwidth="30em" maxwidth="600" weight-x="1" scrollpane="false" rows="1" weight-y="1" source="@description" data-type="VARCHAR(3500)"/>
        <xe:group align="right">
          <xe:label label="" label-style="label-default"/>
          <xe:group align="down">
            <xe:foreach source="asset_feature" align="down">
              <xe:inititems>
                <xe:inititem dest="@feature" value="censhare:description"/>
              </xe:inititems>
              <xe:row-filters>
                <xe:filter source="@feature" operator="=" match="censhare:description"/>
              </xe:row-filters>
              <xe:group>
                <xe:edittext weight-x="1" maxwidth="600" scrollpane="false" rows="1" weight-y="1" source="@value_string">
                  <xe:validate not-empty="true"/>
                </xe:edittext>
                <xe:popupmenu label="${language}" source="@language" sort="ascending">
                  <xe:options label-key="@name" value-key="@id" null-entry="true">
                    <xe:generator name="filtered_cachedtables" table-name="language_def"/>
                  </xe:options>
                  <xe:validate not-empty="true"/>
                </xe:popupmenu>
                <xe:deletebutton/>
              </xe:group>
            </xe:foreach>
          </xe:group>
        </xe:group>
      </xe:expandgroup>
      <!-- edit file meta data-->
      <xe:group align="down" visible="=:exists(asset/storage_item[@key='master'])">
        <xe:separator/>
        <xe:expandgroup caption="${file-meta-data}" id="edit-file-meta-data" save-state="true" align="down">
          <xe:group>
            <xe:include key="dialog-asset-edit-picture-iptc"/>
          </xe:group>
        </xe:expandgroup>
      </xe:group>
      <!-- permissions -->
      <xe:separator/>
      <xe:include key="asset-permissions-include"/>
      <!-- search -->
      <xe:separator/>
      <xe:expandgroup caption="${search}" id="search" save-state="true" align="down">
        <!-- search asset -->
        <xe:group align="right">
          <xe:edit-query label="${search}" label-style="label-default" label-align="left-top" width="30em" dialog-type="dialog-asset-search-asset" source="search_xml.query" expression-id="edit-query">
            <xe:listen-to source="search_xml"/>
          </xe:edit-query>
          <xe:deletebutton align-y="top" source="search_xml"/>
        </xe:group>
      </xe:expandgroup>
    </xe:group>
  </xe:part>

  <!-- asset edit costs dialog -->
  <xe:part id="dialog-asset-edit-costs-include" transactional="true">
    <xe:param cost-type="censhare:costs-actual"/>
    <xe:group align="down">
      <xe:variable name="costType" value="=:$param/param/@cost-type"/>
      <xe:variable name="costName" value="=:cs:cachelookup('feature_value','@feature', 'censhare:resource-cost-type', '@value_key', $costType)/@name"/>
      <xe:variable name="partyAssetID" value="=:cs:cachelookup('party','@id', $system/system/party/@id)/@party_asset_id"/>
      <xe:variable name="resourceAssets" value="=:cs:asset()[@censhare:resource-cost-type=$costType]"/>
      <xe:group align="right">
        <xe:label label="=:$costName" label-style="label-default"/>
        <xe:label value="${date}" width="12em"/>
        <xe:label value="${resource}" width="15em"/>
        <xe:label value="${unit}" width="9em"/>
        <xe:label value="${count}" width="10em"/>
        <xe:label value="${currency}" width="7em"/>
        <xe:label value="${category}" width="15em"/>
      </xe:group>
      <xe:group align="right">
        <xe:label label="" label-style="label-default"/>
        <xe:foreach source="asset_feature" align="down">
          <xe:inititems>
            <xe:inititem dest="@feature" value="censhare:costs-type"/>
            <xe:inititem dest="@value_key" value="=:$costType"/>
            <xe:inititem dest="asset_feature[feature='censhare:costs-date']@value_timestamp" value="=:current-date()"/>
            <xe:inititem dest="asset_feature[feature='censhare:costs-resource']@value_asset_id" value="=:if ($resourceAssets/@id=$partyAssetID) then $partyAssetID else ()"/>
            <xe:inititem dest="asset_feature[feature='censhare:costs-resource']@value_long2" value="0"/>
          </xe:inititems>
          <xe:row-filters>
            <xe:filter source="@feature" operator="=" match="censhare:costs-type"/>
            <xe:filter source="@value_key" operator="=" match="=:$costType"/>
          </xe:row-filters>
          <!-- date -->
          <xe:date source="asset_feature[feature='censhare:costs-date']@value_timestamp" type="date" width="12em">
            <xe:validate not-null="true"/>
          </xe:date>
          <!-- ressource -->
          <xe:popupmenu source="asset_feature[feature='censhare:costs-resource']@value_asset_id" sort="ascending" width="15em">
            <xe:options label-key="@name" value-key="@id">
              <xe:generator expression="=:$resourceAssets"/>
            </xe:options>
            <xe:validate not-null="true"/>
            <xe:change value="0" dest="asset_feature[feature='censhare:costs-resource']@value_long2"/>
            <xe:change condition="=:not(asset_feature/asset_feature[@feature='censhare:costs-unit-key']/@value_string = (cs:get-asset($current/asset_feature/asset_feature[@feature='censhare:costs-resource']/@value_asset_id)/asset_feature[@feature='censhare:resource-cost-unit']/@value_key, 'amount'))" value="amount" dest="asset_feature[feature='censhare:costs-unit-key']@value_string"/>
          </xe:popupmenu>
          <!-- unit -->
          <xe:popupmenu source="asset_feature[feature='censhare:costs-unit-key']@value_string" sort="ascending" select-first="true" width="9em">
            <xe:options label-key="@name" value-key="@value_key">
              <xe:generator name="cachedtables" table-name="feature_value" source="@feature" match="censhare:resource-cost-unit"/>
              <xe:filter condition="=:feature_value/@value_key = cs:get-asset($current/asset_feature/asset_feature[@feature='censhare:costs-resource']/@value_asset_id)/asset_feature[@feature='censhare:resource-cost-unit']/@value_key"/>
              <xe:option label="${amount}" value="amount"/>
            </xe:options>
            <xe:listen-to source="asset_feature[feature='censhare:costs-resource']@value_asset_id"/>
            <xe:validate not-null="true"/>
          </xe:popupmenu>
          <!-- count of units or amount -->
          <xe:selectcase source="asset_feature[feature='censhare:costs-unit-key']@value_string">
            <xe:case value="amount">
              <!-- amount -->
              <xe:editfield width="10em" source="asset_feature[feature='censhare:costs-amount']@value_double" data-type="NUMBER">
                <xe:validate not-null="true"/>
              </xe:editfield>
              <!-- currency -->
              <xe:popupmenu width="7em" source="asset_feature[feature='censhare:costs-amount']@value_unit" select-first="true">
                <xe:options value-key="@unit" label-key="@unit">
                  <xe:generator name="filtered_cachedtables" table-name="unit_set_rel" source="@unit_set" match="=cachelookup('feature', '@key', 'censhare:costs-amount')@unit_set"/>
                  <xe:sort key="@sorting" data-type="integer"/>
                </xe:options>
              </xe:popupmenu>
            </xe:case>
            <xe:defaultcase>
              <!-- count of units -->
              <xe:editfield width="10em" source="asset_feature[feature='censhare:costs-unit-count']@value_double" data-type="NUMBER">
                <xe:validate not-null="true"/>
              </xe:editfield>
              <xe:label width="7em"/>
            </xe:defaultcase>
          </xe:selectcase>
          <!-- category -->
          <xe:popupmenutree source="asset_feature[feature='censhare:costs-category']@value_key" hide-root-popup="true">
            <xe:treeoptions label-key="@name" value-key="@value_key">
              <xe:generator name="filtered_cachedtables" table-name="feature_value" source="@feature" match="censhare:costs-category"/>
              <xe:sort key="@sorting" data-type="integer" ascending="true"/>
            </xe:treeoptions>
          </xe:popupmenutree>
          <!-- amount of money -->
          <xe:group>
            <xe:listen-to source="asset_feature[feature='censhare:costs-resource']@value_asset_id"/>
            <xe:listen-to source="asset_feature[feature='censhare:costs-unit-key']@value_string"/>
            <xe:listen-to source="asset_feature[feature='censhare:costs-amount']@value_double"/>
            <xe:listen-to source="asset_feature[feature='censhare:costs-unit-count']@value_double"/>
            <xe:variable name="unitKey" value="=:asset_feature/asset_feature[@feature='censhare:costs-unit-key']/@value_string"/>
            <xe:variable name="costsFeature" value="=:cs:get-asset(asset_feature/asset_feature[@feature='censhare:costs-resource']/@value_asset_id)/asset_feature[@feature='censhare:resource-cost-unit']/asset_feature[@feature='censhare:resource-costs']"/>
            <xe:variable name="unitCount" value="=:asset_feature/asset_feature[@feature='censhare:costs-unit-count']/@value_double"/>
            <xe:variable name="amountFeature" value="=:asset_feature/asset_feature[@feature='censhare:costs-amount']"/>
            <xe:label value="=:if ($amountFeature or ($unitCount and $costsFeature)) then if ($amountFeature) then concat('= ', $amountFeature/@value_unit, ' ', cs:format-number($amountFeature/@value_double, '#,##0.00')) else concat('= ', $costsFeature/@value_unit, ' ', cs:format-number($unitCount * $costsFeature/@value_double, '#,##0.00')) else ''"/>
          </xe:group>
          <xe:deletebutton>
            <xe:delete dest=""/>
            <xe:delete dest="asset_feature[feature='censhare:costs-date']"/>
            <xe:delete dest="asset_feature[feature='censhare:costs-resource']"/>
            <xe:delete dest="asset_feature[feature='censhare:costs-unit-key']"/>
            <xe:delete dest="asset_feature[feature='censhare:costs-amount']"/>
            <xe:delete dest="asset_feature[feature='censhare:costs-unit-count']"/>
            <xe:delete dest="asset_feature[feature='censhare:costs-category']"/>
          </xe:deletebutton>
        </xe:foreach>
      </xe:group>
    </xe:group>
  </xe:part>

  <!-- asset edit meta data dialog -->
  <xe:part id="dialog-asset-edit-meta-data" transactional="true" scrollpane="false">
    <xe:group align="down">
      <xe:include key="asset-edit-meta-data-include">
        <xe:param show_preview="true" show_deadline_calculated="true" show_search_buttons="true"/>
      </xe:include>
    </xe:group>
  </xe:part>

  <!-- asset edit meta data with preview dialog -->
  <xe:part id="dialog-asset-edit-preview" transactional="true">
    <xe:group align="down">
      <xe:include key="dialog-asset-edit-include">
        <xe:param show_preview="true" show_deadline_calculated="true" show_search_buttons="true"/>
      </xe:include>
    </xe:group>
  </xe:part>

  <!-- asset edit meta data include -->
  <xe:part id="asset-edit-meta-data-include" transactional="true" scrollpane="false">
    <xe:param readonly="false" show_preview="false" show_relation="false" show_state="false"/>
    <xe:group align="down" readonly="=$param@readonly" margin="6">
      <xe:group align="right" margin-bottom="10">
        <xe:include key="asset-header-include"/>
      </xe:group>
      <!-- search for related dialog -->
      <xe:variable name="relatedDialogAssets" value="=:if (count(asset)=1 and asset/child_asset_rel[@key='user.']) then asset/cs:child-rel()[@key='user.']/cs:asset()[@censhare:asset.type='module.dialog.'] else ()"/>
      <xe:variable name="relatedDialogXml" value="=:if ($relatedDialogAssets) then doc(concat('censhare:///service/assets/asset/id/', $relatedDialogAssets[1]/@id, '/transform;key=localize'))/xe:parts/xe:part[@id='edit-own-attributes'] else ()"/>
      <!-- search for custom dialog -->
      <xe:variable name="assetTypeDialogID" value="=:if (cs:equal-values(asset/@type)) then concat('asset-edit-', asset[1]/@type, '-include') else ()"/>
      <xe:variable name="assetTypeDialogExists" value="=:exists($editordef/cmd/xe:part[@id=$assetTypeDialogID])"/>
      <xe:tabs weight-x="1.0" weight-y="1.0" source="$temp@main-tab">
        <!-- asset type specific tab -->
        <!-- - shown if dialog with part id="edit-own-attributes" as child assignment related asset of type dialog exists -->
        <!-- - shown if dialog with key 'asset-edit-' + asset type + '-include' exists) -->
        <xe:tab id="asset-type-specific" title="=:cs:master-data('asset_typedef')[@asset_type=$current/asset[1]/@type]/@name" visible="=:$assetTypeDialogExists or exists($relatedDialogXml)">
          <xe:scrollpane align="down">
            <xe:selectcase value="=true">
              <xe:case value="=:exists($relatedDialogXml)">
                <xe:include expression="=:$relatedDialogXml"/>
              </xe:case>
              <xe:case value="=:$assetTypeDialogExists">
                <xe:include key="=:$assetTypeDialogID"/>
              </xe:case>
            </xe:selectcase>
          </xe:scrollpane>
        </xe:tab>
        <!-- general -->
        <xe:tab id="general" title="${general}">
          <xe:scrollpane align="down">
            <!-- preview -->
            <xe:group align="down" visible="=:count(asset)=1 and (asset/storage_item[@key='preview' or @key='text-preview'])">
              <xe:include key="asset-preview-include"/>
              <xe:separator/>
            </xe:group>
            <!-- general -->
            <xe:include key="asset-general-include">
              <xe:param show_preview="true" show_deadline_calculated="true" show_search_buttons="true"/>
            </xe:include>
            <xe:separator/>
            <!-- workflow -->
            <xe:include key="asset-workflow-include">
              <xe:param show_preview="true" show_deadline_calculated="true" show_search_buttons="true"/>
            </xe:include>
            <!-- state -->
            <xe:group visible="=:$param/param/@show_state='true' or ($param/param/@show_relation='true' and exists($parent-asset) and count(asset)=1 and exists(asset[1]/parent_asset_rel[@parent_asset=$parent-asset/asset/@id]))" align="down">
              <xe:separator/>
              <xe:expandgroup caption="${flags}" id="flags" expanded="true" save-state="true" align="down">
                <xe:checkbox label="${state}" label-style="label-default" caption="${keep-open}" source="@corpus:keep-open" visible="=:$param/param/@show_state='true'"/>
                <!-- select parent relation -->
                <xe:group visible="=:$param/param/@show_relation='true'">
                  <xe:include key="dialog-asset-select-relation-include"/>
                </xe:group>
              </xe:expandgroup>
            </xe:group>
          </xe:scrollpane>
        </xe:tab>
        <!-- transformation variant (only shown if one asset and it's a transformation variant) -->
        <xe:tab id="variant" title="${variant}" visible="=:count(asset) = 1 and exists(asset/parent_asset_rel[@key='variant.transformation.'])">
          <xe:scrollpane align="down">
            <xe:select source="parent_asset_rel[key='variant.transformation.']" align="down">
              <xe:include key="dialog-asset-edit-variant-relation-include"/>
            </xe:select>
          </xe:scrollpane>
        </xe:tab>
        <!-- region variant -->
        <xe:tab id="variant" title="${variant}" visible="=:exists(asset/parent_asset_rel[@key='variant.region.'])">
          <xe:scrollpane align="down">
            <xe:select source="parent_asset_rel[key='variant.region.']" align="down">
              <xe:include key="dialog-asset-edit-variant-region-include"/>
            </xe:select>
          </xe:scrollpane>
        </xe:tab>
        <!-- description -->
        <xe:tab id="description" title="${description}">
          <xe:scrollpane align="down">
            <xe:include key="asset-description-include"/>
          </xe:scrollpane>
        </xe:tab>
        <!-- file meta data -->
        <xe:tab id="file" title="${file}" visible="=:exists(asset/storage_item[@key='master'])">
          <xe:scrollpane align="down">
            <xe:include key="dialog-asset-edit-picture-iptc"/>
          </xe:scrollpane>
        </xe:tab>
        <!-- features -->
        <xe:tab id="features" title="${features}">
          <xe:scrollpane align="down">
            <xe:include key="dialog-asset-edit-features"/>
          </xe:scrollpane>
        </xe:tab>
        <!-- map -->
        <xe:tab id="map" title="${map}">
          <xe:scrollpane align="down">
            <xe:include key="dialog-asset-edit-map"/>
          </xe:scrollpane>
        </xe:tab>
        <!-- advanced -->
        <xe:tab id="advanced" title="${advanced}">
          <xe:scrollpane align="down">
            <xe:include key="asset-advanced-include"/>
            <xe:separator/>
            <xe:include key="asset-permissions-include"/>
            <xe:separator/>
            <xe:include key="asset-search-include"/>
            <xe:separator/>
            <xe:include key="dialog-asset-edit-flags"/>
          </xe:scrollpane>
        </xe:tab>
        <!-- slice tool -->
        <!-- xe:tab id="slice-tool" title="${slice-tool}" visible="=:exists(asset/storage_item[@key='preview'])">
          <xe:scrollpane align="down">
            <xe:include key="dialog-asset-edit-slice-tool"/>
          </xe:scrollpane>
        </xe:tab -->
        <!-- budget and costs -->
        <xe:tab id="costs" title="${budget-and-costs}">
          <xe:scrollpane align="down">
            <xe:include key="dialog-asset-edit-budget-and-costs"/>
          </xe:scrollpane>
        </xe:tab>
      </xe:tabs>
    </xe:group>
  </xe:part>

  <!-- asset header include (show icon, name and infos of selected assets) -->
  <xe:part id="asset-header-include" transactional="false">
    <xe:selectcase value="=true">
      <!-- no asset selected -->
      <xe:case value="=:empty(asset)">
        <xe:label style="label-info" value="${no-asset-selected}"/>
      </xe:case>
      <!-- one asset selected -->
      <xe:case value="=:count(asset) = 1">
        <xe:group>
          <xe:listen-to source="@name"/>
          <xe:listen-to source="@type"/>
          <xe:image width="32" height="32" url="=:concat('censhare:///service/', if (contains(asset/@corpus:dto_flags, 'n') or contains(asset/@corpus:dto_flags, 'm')) then concat('resources/icon/assettype-', asset/@type, '') else concat('assets/asset/id/', asset/@id, '/version/', asset/@version, '/icon'), '/background/', system-property('censhare:laf-background'), '/minsize/32/file', if (contains(asset/@corpus:dto_flags, 'n') or contains(asset/@corpus:dto_flags, 'm')) then '' else concat('/ccn', asset/@ccn))"/>
          <xe:html label-wordwrap="true" css-key="asset-info" margin-left="6" minwidth="10">
            <xe:html-value>
              <![CDATA[
                =:concat('<html><div class="asset-info-title">', asset/@name, '</div><div>', string-join(for $x in (1 to xs:long(count(tokenize(asset/@type, '\.')))) return cs:cachelookup('asset_typedef', '@asset_type', concat(string-join(subsequence(tokenize(asset/@type, '\.'), 1, $x), '.'), '.'))/@name, '/'), '</div></html>')
              ]]>
            </xe:html-value>
          </xe:html>
        </xe:group>
      </xe:case>
      <!-- many assets selected -->
      <xe:defaultcase>
        <xe:label style="label-header" value="=:replace('${n-assets-selected}', '\{0}', string(count(asset)))"/>
      </xe:defaultcase>
    </xe:selectcase>
  </xe:part>

  <!-- asset preview include -->
  <xe:part id="asset-preview-include" transactional="true">
    <xe:expandgroup caption="${preview}" align="down" id="preview" expanded="true" save-state="true">
      <xe:assetpreview height="200" weight-x="1.0" storagekey="thumbnail"/>
    </xe:expandgroup>
  </xe:part>

  <!-- asset general include -->
  <xe:part id="asset-general-include" transactional="true">
    <xe:expandgroup caption="${general}" id="general" expanded="true" save-state="true" align="down">
      <!-- name -->
      <xe:editfield label="${name}" label-style="label-default" width="30em" source="@name" data-type="VARCHAR(256)" autofocus="true"  readonly="=:boolean(starts-with(asset[1]/@type,'module.feature.'))">
        <xe:validate not-empty="true"/>
        <!-- example for a unique name -->
        <!--xe:validate condition="=:not(boolean(cs:asset()[@censhare:asset.name=string(*/@name) and @censhare:asset.id!=string(*/@id)]))"/-->
      </xe:editfield>
      <xe:selectcase value="=true">
        <xe:case value="=:cs:equal-values(asset/@type) and starts-with(asset[1]/@type,'module.') or (count(asset) = 1 and exists(asset[1]/asset_feature[@feature='censhare:resource-key']))">
          <xe:group align="down">
            <xe:group align="right">
              <xe:label label="" label-style="label-default"/>
              <xe:group align="down">
                <xe:foreach source="asset_feature" align="down">
                  <xe:inititems>
                    <xe:inititem dest="@feature" value="censhare:name"/>
                  </xe:inititems>
                  <xe:row-filters>
                    <xe:filter source="@feature" operator="=" match="censhare:name"/>
                  </xe:row-filters>
                  <xe:group>
                    <xe:editfield width="30em" source="@value_string">
                      <xe:validate not-empty="true"/>
                    </xe:editfield>
                    <xe:popupmenu label="${language}" source="@language" sort="ascending">
                    <xe:options label-key="@name" value-key="@id" null-entry="true">
                      <xe:generator name="filtered_cachedtables" table-name="language_def"/>
                    </xe:options>
                    <xe:validate not-empty="true"/>
                    </xe:popupmenu>
                    <xe:deletebutton/>
                  </xe:group>
                </xe:foreach>
              </xe:group>
            </xe:group>
            <xe:group align="right">
              <xe:label label="${name.localization-key}" label-style="label-default"/>
              <xe:group align="down">
                <xe:foreach source="asset_feature" max-occurs="1" min-occurs="0" align="down">
                  <xe:inititems>
                    <xe:inititem dest="@feature" value="censhare:name.localization-key.web"/>
                  </xe:inititems>
                  <xe:row-filters>
                    <xe:filter source="@feature" operator="=" match="censhare:name.localization-key.web"/>
                  </xe:row-filters>
                  <xe:group>
                    <xe:editfield width="30em" source="@value_string">
                      <xe:validate not-empty="true"/>
                    </xe:editfield>
                    <xe:deletebutton/>
                  </xe:group>
                </xe:foreach>
              </xe:group>
            </xe:group>
          </xe:group>
        </xe:case>
      </xe:selectcase>
      <!-- type -->
      <xe:popupmenutree label="${type}" label-style="label-default" source="@type" hide-root-popup="false" sort="ascending">
        <xe:treeoptions label-key="@name" value-key="@asset_type">
          <xe:generator name="filtered_cachedtables" table-name="asset_typedef"/>
        </xe:treeoptions>
        <xe:validate condition="=:empty(for $asset in asset return if (starts-with($asset/@domain, cs:cachelookup('asset_typedef', '@asset_type', $asset/@type)/@domain) and starts-with($asset/@domain2, cs:cachelookup('asset_typedef', '@asset_type', $asset/@type)/@domain2)) then () else '1')"/>
      </xe:popupmenutree>
      <!-- category -->
      <xe:group>
        <xe:variable name="valueListResourceKey" value="=:cs:master-data('feature')[@key='censhare:asset.category']/@value_list_resource_key"/>
        <xe:variable name="options" value="=:doc(concat('censhare:///service/assets/asset/id/', asset/@id, '/transform;key=', $valueListResourceKey))/options/option"/>
        <xe:label label="${categories}" label-style="label-default" align-y="top"/>
        <xe:foreach source="asset_feature" align="down">
          <xe:identify-children-by key="@feature"/>
          <xe:identify-children-by key="@value_asset_key_ref"/>
          <xe:sort expression="=:$options[@value=@value_asset_key_ref]/@display_value"/>
          <xe:sort key="@value_asset_key_ref" ascending="true"/>
          <xe:inititems>
            <xe:inititem dest="@feature" value="censhare:asset.category"/>
          </xe:inititems>
          <xe:row-filters>
            <xe:filter source="@feature" operator="=" match="censhare:asset.category"/>
          </xe:row-filters>
          <xe:popupmenu width="30em" source="@value_asset_key_ref" sort="ascending">
            <xe:options value-key="@value" label-key="@display_value">
              <xe:generator expression="=:$options"/>
            </xe:options>
            <xe:validate not-null="true"/>
          </xe:popupmenu>
          <xe:deletebutton/>
        </xe:foreach>
      </xe:group>
      <!-- domains -->
      <xe:popupmenutree label="${domain}" label-style="label-default" source="@domain" hide-root-popup="false" defaultvalue="root."  readonly="=:boolean(starts-with(asset[1]/@type,'module.feature.'))">
        <xe:treeoptions label-key="@name" value-key="@pathid">
          <xe:generator name="filtered_cachedtables" table-name="domain"/>
          <xe:sort key="@sorting" data-type="integer"/>
        </xe:treeoptions>
      </xe:popupmenutree>
       <xe:popupmenutree label="${domain2}" label-style="label-default" source="@domain2" hide-root-popup="false" defaultvalue="root." visible="=:count(cs:master-data('domain2')) gt 1"  readonly="=:boolean(starts-with(asset[1]/@type,'module.feature.'))">
        <xe:treeoptions label-key="@name" value-key="@pathid">
          <xe:generator name="filtered_cachedtables" table-name="domain2"/>
          <xe:sort key="@sorting" data-type="integer"/>
        </xe:treeoptions>
      </xe:popupmenutree>
      <!-- channels -->
      <xe:treeselector label="${channels}" label-style="label-default" label-align="left-top" source="asset_feature" valuesource="@value_key" rows="4" width="30em">
        <xe:row-filters>
          <xe:filter source="@feature" match="censhare:output-channel"/>
        </xe:row-filters>
        <xe:inititems>
          <xe:inititem dest="@feature" value="censhare:output-channel"/>
        </xe:inititems>
        <xe:treeoptions label-key="@name" value-key="@value_key">
          <xe:generator name="filtered_cachedtables" table-name="feature_value" source="@feature" match="censhare:output-channel"/>
          <xe:sort key="@sorting" data-type="integer" ascending="true"/>
        </xe:treeoptions>
      </xe:treeselector>
      <!-- language -->
      <xe:group>
        <xe:popupmenu label="${language}" label-style="label-default" width="30em" source="@language" sort="ascending">
          <xe:options label-key="@name" value-key="@id">
            <xe:generator name="filtered_cachedtables" table-name="language_def"/>
          </xe:options>
        </xe:popupmenu>
        <xe:deletebutton source="@language"/>
      </xe:group>
      <!-- author -->
      <xe:editfield label="${author}" label-style="label-default" width="30em" source="@author" data-type="VARCHAR(128)"/>
    </xe:expandgroup>
  </xe:part>

  <!-- asset workflow include -->
  <xe:part id="asset-workflow-include" transactional="true">
    <xe:expandgroup caption="${workflow}" id="workflow" expanded="true" save-state="true" align="down">
      <!-- name -->
      <xe:group>
        <xe:popupmenu label="${workflow}" label-style="label-default" source="@wf_id" width="30em" sort="ascending">
          <xe:options label-key="@name" value-key="@id">
            <xe:generator name="filtered_cachedtables" table-name="workflow"/>
          </xe:options>
        </xe:popupmenu>
        <xe:deletebutton source="@wf_id"/>
      </xe:group>
      <xe:group>
        <xe:popupmenu label="${step}" label-style="label-default" source="@wf_step" width="30em" visible="=@wf_id != null">
          <xe:options label-key="@name" value-key="@wf_step">
            <xe:generator name="filtered_cachedtables" table-name="workflow_step" source="@wf_id" match-source="$current@wf_id"/>
            <xe:sort key="@sorting" data-type="integer"/>
          </xe:options>
          <xe:listen-to source="@wf_id" is-key-part="true">
            <xe:change dest="@wf_step" value="=cachelookup('workflow', '@id', '@wf_id')@def_step"/>
          </xe:listen-to>
        </xe:popupmenu>
        <xe:colorpicker value="=cachelookup('workflow_step', '@wf_id', '@wf_id', '@wf_step', '@wf_step')@color" readonly="true" visible="=@wf_id != null">
          <xe:listen-to source="@wf_id"/>
          <xe:listen-to source="@wf_step"/>
        </xe:colorpicker>
      </xe:group>
      <xe:group>
        <xe:auto-completion-field label="${assigned-to}" label-style="label-default" cuetext="${enter-search-term}" width="30em" source="@wf_target" sort="ascending">
          <xe:options label-key="@display_name" value-key="@id">
            <xe:generator name="filtered_cachedtables" table-name="party" source="@isvisible" match="1"/>
            <xe:sort key="@display_name"/>
          </xe:options>
          <xe:listen-to source="@wf_id">
            <xe:listen-to source="@wf_step">
              <xe:change dest="@wf_target" value="=cachelookup('workflow_step', '@wf_id', '@wf_id', '@wf_step', '@wf_step')@def_party" allow-set-null="true"/>
            </xe:listen-to>
          </xe:listen-to>
        </xe:auto-completion-field>
        <!--xe:popupmenu label="${workflow-target}" label-style="label-default" width="30em" source="@wf_target" sort="ascending">
          <xe:options label-key="@display_name" value-key="@id">
            <xe:generator name="filtered_cachedtables" table-name="party" source="@isvisible" match="1"/>
          </xe:options>
          <xe:listen-to source="@wf_id">
            <xe:listen-to source="@wf_step">
              <xe:change dest="@wf_target" value="=cachelookup('workflow_step', '@wf_id', '@wf_id', '@wf_step', '@wf_step')@def_party" allow-set-null="true"/>
            </xe:listen-to>
          </xe:listen-to>
        </xe:popupmenu-->
        <xe:deletebutton source="@wf_target"/>
        <xe:button icon="user" tooltip="${use-me-as-workflow-target}">
          <xe:change dest="@wf_target" value="=:$system/system/party/@id"/>
        </xe:button>
      </xe:group>
      <!-- workflow target unavailable -->
      <xe:group>
        <xe:listen-to source="@wf_target"/>
        <xe:variable name="wfTargetID" value="=:if (exists(asset/@wf_target) and cs:equal-values(asset/@wf_target)) then asset[1]/@wf_target else ()"/>
        <xe:variable name="userAssetID" value="=:if (exists($wfTargetID)) then cs:master-data('party')[@id=$wfTargetID]/@party_asset_id else ()"/>
        <xe:variable name="userAsset" value="=:if (exists($userAssetID)) then cs:get-asset($userAssetID) else ()"/>
        <xe:variable name="unavailableItems" value="=:if (exists($userAsset)) then $userAsset/asset_feature[@feature='censhare:unavailable' and xs:dateTime(@value_timestamp) le current-dateTime() and xs:dateTime(@value_timestamp2) + xs:dayTimeDuration('P1D') ge current-dateTime()] else ()"/>
        <xe:label label="" label-style="label-default" value="=:concat('ⓘ ', replace(replace('${not-available-between-x-and-y}', '\{0}', cs:format-date(xs:dateTime($unavailableItems[1]/@value_timestamp), 'short', 'none')), '\{1}', cs:format-date(xs:dateTime($unavailableItems[1]/@value_timestamp2), 'short', 'none')))" enabled="=:exists($unavailableItems)"/>
      </xe:group>
      <!-- deadline -->
      <xe:group>
        <xe:group>
          <xe:editdate label="${deadline-manual}" label-style="label-default" width="30em" source="@deadline"/>
          <xe:deletebutton source="@deadline"/>
        </xe:group>
        <xe:group visible="=:$param/param/@show_deadline_calculated and count(asset)=1 and asset/@deadline_calc">
          <xe:label value="=:cs:format-date(asset/@deadline_calc, 'relative-short', 'short')"/>
          <xe:label label="${deadline-of-schedule}"/>
        </xe:group>
        <!--xe:editdate label="${calculated}" source="@deadline_calc" readonly="true" enabled="=$param@show_deadline_calculated"/-->
      </xe:group>
      <!-- annotation-->
      <xe:edittext label="${annotation}" label-align="left-top" label-style="label-default" width="30em" scrollpane="false" rows="1" weight-y="1" source="@annotation" data-type="VARCHAR(3500)"/>
    </xe:expandgroup>
  </xe:part>

  <!-- asset description include -->
  <xe:part id="asset-description-include" transactional="true">
    <xe:group align="down">
      <xe:expandgroup caption="${description}" id="workflow" expanded="true" save-state="true" align="down">
        <!-- description -->
        <xe:edittext label="${description}" label-align="left-top" label-style="label-default" prefwidth="30em" maxwidth="600" weight-x="1" scrollpane="false" rows="1" weight-y="1" source="@description" data-type="VARCHAR(3500)"/>
        <xe:group align="right">
          <xe:label label="" label-style="label-default"/>
          <xe:group align="down">
            <xe:foreach source="asset_feature" align="down">
              <xe:inititems>
                <xe:inititem dest="@feature" value="censhare:description"/>
              </xe:inititems>
              <xe:row-filters>
                <xe:filter source="@feature" operator="=" match="censhare:description"/>
              </xe:row-filters>
              <xe:group>
                <xe:edittext weight-x="1" maxwidth="600" scrollpane="false" rows="1" weight-y="1" source="@value_string">
                  <xe:validate not-empty="true"/>
                </xe:edittext>
                <xe:popupmenu label="${language}" source="@language" sort="ascending" align-y="top">
                  <xe:options label-key="@name" value-key="@id" null-entry="true">
                    <xe:generator name="filtered_cachedtables" table-name="language_def"/>
                  </xe:options>
                  <xe:validate not-empty="true"/>
                </xe:popupmenu>
                <xe:deletebutton align-y="top"/>
              </xe:group>
            </xe:foreach>
          </xe:group>
        </xe:group>
        <!-- rating -->
        <xe:group align="right">
          <xe:label label="${rating}" label-style="label-default"/>
          <xe:foreach source="asset_feature" max-occurs="1">
           <xe:inititems>
             <xe:inititem dest="@feature" value="censhare:rating"/>
             <xe:inititem dest="@party" value="=:$system/system/party/@id"/>        
           </xe:inititems>
           <xe:row-filters>
             <xe:filter source="@feature" match="censhare:rating" />
             <xe:filter source="@party" match="=:$system/system/party/@id" />                  
           </xe:row-filters>
           <xe:popupmenu width="30em" source="@value_double">
              <xe:options>
                <xe:option label="${1-star}" value="1.0"/>
                <xe:option label="${2-star}" value="2.0"/>
                <xe:option label="${3-star}" value="3.0"/>
                <xe:option label="${4-star}" value="4.0"/>
                <xe:option label="${5-star}" value="5.0"/>
              </xe:options>
            </xe:popupmenu>
            <xe:deletebutton/>
          </xe:foreach>
        </xe:group>
        <!-- color -->
        <xe:group>
          <xe:colorpicker label="${colour}" label-style="label-default" width="16" height="16" source="@color"/>
          <xe:deletebutton source="@color"/>
        </xe:group>
      </xe:expandgroup>
      <xe:separator/>
      <xe:expandgroup caption="${keywords}" id="keywords" save-state="true" align="down">
        <!-- keyword tree -->
        <xe:treeselector label="${keyword-tree}" label-style="label-default" label-align="left-top" source="asset_feature" valuesource="@value_key" rows="4" maxwidth="600" weight-x="1">
          <xe:row-filters>
            <xe:filter source="@feature" match="censhare:keyword"/>
          </xe:row-filters>
          <xe:inititems>
            <xe:inititem dest="@feature" value="censhare:keyword"/>
          </xe:inititems>
          <xe:treeoptions label-key="@name" value-key="@value_key">
            <xe:generator name="filtered_cachedtables" table-name="feature_value" source="@feature" match="censhare:keyword"/>
            <xe:sort key="@sorting" data-type="integer" ascending="true"/>
          </xe:treeoptions>
        </xe:treeselector>
        <!-- optional: use list of hierarchical popups
          <xe:groupbox caption="${keywords}" minwidth="250" align="down">
          <xe:strut weight-x="1"/>
          <xe:foreach new-caption="${new-keyword}" source="asset_feature" align="down">
          <xe:identify-children-by key="@feature"/>
          <xe:identify-children-by key="@value_key"/>
          <xe:sort expression="=cachelookup('feature_value','@feature',@feature,'@value_key','@value_key')@name${localized-attr-suffix}"/>
          <xe:row-filters>
          <xe:filter source="@feature" match="censhare:keyword"/>
          </xe:row-filters>
          <xe:inititems>
          <xe:inititem dest="@feature" value="censhare:keyword"/>
          <xe:inititem dest="@value_key" value="root."/>
          </xe:inititems>
          <xe:deletebutton/>
          <xe:popupmenutree source="@value_key" hide-root-popup="true">
          <xe:treeoptions label-key="@name" value-key="@value_key">
          <xe:generator name="filtered_cachedtables" table-name="feature_value" source="@feature" match="censhare:keyword"/>
          <xe:sort key="@sorting" data-type="integer" ascending="true"/>
          </xe:treeoptions>
          </xe:popupmenutree>
          </xe:foreach>
          </xe:groupbox>
        -->
        <!-- keywords -->
        <xe:edittext label="${keywords}" label-style="label-default" weight-x="1" maxwidth="600" rows="2" source="@keywords" data-type="VARCHAR(3500)"/>
        <!-- automated indexing -->
        <xe:group align="right">
          <xe:label label="${thesaurus}" label-style="label-default" align-y="top"/>
          <xe:group align="down">
            <xe:foreach source="asset_feature[feature='censhare:keyword.external'].asset_feature" align="down">
              <xe:inititems>
                <xe:inititem dest="@feature" value="censhare:keyword.external.ref"/>
                <xe:inititem dest="@value_long2" value="0"/>
              </xe:inititems>
              <xe:row-filters>
                <xe:filter source="@feature" operator="=" match="censhare:keyword.external.ref"/>
              </xe:row-filters>
              <xe:auto-completion-field cuetext="${enter-search-term}" search-value-source="$temp@search_group" internal-search="false" max-items="500" source="@value_asset_id" width="30em">
                <xe:options label-key="@name" value-key="@id" lookup-expression="=:cs:get-asset(asset_feature/@value_asset_id)">
                  <xe:generator expression="=:if ($temp/temp/@search_group and string-length($temp/temp/@search_group) > 2) then cs:asset('limit=100')[@censhare:asset.type='module.keyword.' and @censhare:text.name = string($temp/temp/@search_group)]/cs:order-by()[@censhare:asset.name] else ()"/>
                  <!--xe:option label="${new-asset}">
                    <cs:command name="create-new-asset">
                      <cs:param name="asset">
                        <asset type="module.keyword." name="=:$temp/*/@search_group"/>
                      </cs:param>
                      <cs:param name="dialog-key" value="dialog-asset-check-in-new"/>
                    </cs:command>
                  </xe:option-->
                </xe:options>
              </xe:auto-completion-field>
              <xe:editfield label="${relevance}" width="4em" source="@relevance_percentage" data-type="NUMBER" defaultvalue="100"/>
              <xe:label value="%"/>
              <xe:deletebutton/>
            </xe:foreach>
          </xe:group>
        </xe:group>
      </xe:expandgroup>
    </xe:group>
  </xe:part>

  <!-- asset advanced include -->
  <xe:part id="asset-advanced-include" transactional="true">
    <xe:expandgroup caption="${advanced}" id="permissions" expanded="true" save-state="true" align="down">
      <!-- flags -->
      <xe:group align="right">
        <xe:checkbox label="Flags" label-style="label-default" caption="${cancellation}" source="@iscancellation" unchecked-value="0" checked-value="1"/>
        <xe:checkbox caption="${snapshot}" source="@snapshot_name" unchecked-value="0" checked-value="1"/>
      </xe:group>
      <!-- planning mode -->
      <xe:group align="right">
        <xe:popupmenu label="=:cs:cachelookup('feature','@key', 'censhare:planning-mode')/@name" label-style="label-default" width="30em" source="asset_feature[feature='censhare:planning-mode']@value_key">
          <xe:options label-key="@name" value-key="@value_key">
            <xe:generator name="cachedtables" table-name="feature_value" source="@feature" match="censhare:planning-mode"/>
          </xe:options>
        </xe:popupmenu>
        <xe:deletebutton source="asset_feature[feature='censhare:planning-mode']"/>
      </xe:group>
      <!-- application -->
      <xe:popupmenu label="${application}" label-style="label-default" width="30em" source="@application" sort="ascending">
        <xe:options label-key="@name" value-key="@id">
          <xe:generator name="cachedtables" table-name="asset_application"/>
        </xe:options>
      </xe:popupmenu>
    </xe:expandgroup>
  </xe:part>

  <!-- asset search include -->
  <xe:part id="asset-search-include" transactional="true">
    <xe:expandgroup caption="${search}" id="search" expanded="true" save-state="true" align="down">
      <!-- search asset -->
      <xe:group align="right">
        <xe:edit-query label="${search}" label-style="label-default" label-align="left-top" width="30em" dialog-type="dialog-asset-search-asset" source="search_xml.query" expression-id="edit-query">
          <xe:listen-to source="search_xml"/>
        </xe:edit-query>
        <xe:deletebutton align-y="top" source="search_xml"/>
      </xe:group>
    </xe:expandgroup>
  </xe:part>

  <!-- asset permissions include -->
  <xe:part id="asset-permissions-include" transactional="true">
    <xe:expandgroup caption="${permissions}" id="permissions" expanded="true" save-state="true" align="down">
      <!-- owner -->
      <xe:group align="down">
        <!--xe:group>
          <xe:popupmenu label="${owners}" label-style="label-default" width="30em" source="@owner" sort="ascending">
            <xe:options label-key="@display_name" value-key="@id">
              <xe:generator name="filtered_cachedtables" table-name="party" source="@isvisible" match="1"/>
              <xe:sort key="@display_name" ascending="true"/>
            </xe:options>
          </xe:popupmenu>
          <xe:deletebutton source="@owner"/>
        </xe:group-->
        <xe:group>
          <xe:label label="${owners}" label-style="label-default" align-y="top"/>
          <xe:foreach source="asset_feature" align="down">
            <xe:identify-children-by key="@feature"/>
            <xe:identify-children-by key="@value_long"/>
            <xe:sort expression="=cachelookup('party','@id','@value_long')@display_name"/>
            <xe:inititems>
              <xe:inititem dest="@feature" value="censhare:owner"/>
            </xe:inititems>
            <xe:row-filters>
              <xe:filter source="@feature" operator="=" match="censhare:owner"/>
            </xe:row-filters>
            <xe:popupmenu width="30em" source="@value_long" sort="ascending" label-style="label-default">
              <xe:options label-key="@display_name" value-key="@id">
                <xe:generator name="filtered_cachedtables" table-name="party" source="@isvisible" match="1"/>
                <xe:sort key="@display_name" ascending="true"/>
              </xe:options>
              <xe:validate not-null="true"/>
            </xe:popupmenu>
            <xe:deletebutton/>
          </xe:foreach>
        </xe:group>
      </xe:group>
      <xe:popupmenu label="${non-owner}" label-style="label-default" width="30em" source="@non_owner_access" defaultvalue="0">
        <xe:options>
          <xe:option label="${unrestricted-access}" value="0"/>
          <xe:option label="${read-only-access}" value="1"/>
          <xe:option label="${no-access}" value="2"/>
        </xe:options>
        <xe:validate condition="=:asset/@non_owner_access=0 or asset/asset_feature[@feature='censhare:owner' and not(contains(@corpus:dto_flags, 'd'))]"/>
      </xe:popupmenu>
      <!-- usage -->
      <xe:group>
        <xe:editfield label="${usage}" label-style="label-default" width="5em" source="@max_actual_parent_rels" data-type="INTEGER"/>
        <xe:label value="${max-actual-parent-rels}"/>
      </xe:group>
      <!-- permission keys -->
      <xe:group>
        <xe:label label="${permission-keys}" label-style="label-default" align-y="top"/>
        <xe:foreach source="asset_feature" align="down">
          <xe:identify-children-by key="@feature"/>
          <xe:identify-children-by key="@value_key"/>
          <xe:sort expression="=cachelookup('permission_keydef','@key','@value_string')@name"/>
          <xe:inititems>
            <xe:inititem dest="@feature" value="censhare:asset.edit-permission-key"/>
          </xe:inititems>
          <xe:row-filters>
            <xe:filter source="@feature" operator="=" match="censhare:asset.edit-permission-key"/>
          </xe:row-filters>
          <xe:popupmenu width="30em" source="@value_string" sort="ascending">
            <xe:options value-key="@key" label-key="@name">
              <xe:generator name="cachedtables" table-name="permission_keydef"/>
              <xe:sort key="@name" ascending="true"/>
            </xe:options>
            <xe:validate not-null="true"/>
          </xe:popupmenu>
          <xe:deletebutton/>
        </xe:foreach>
      </xe:group>
    </xe:expandgroup>
  </xe:part>

  <!-- asset edit relation dialog -->
  <xe:part id="dialog-asset-edit-relation" transactional="true">
    <xe:group align="down">
    <!-- meta data -->
      <xe:expandgroup caption="${asset-relation-meta-data}" align="down" id="meta-data" expanded="true" save-state="true">
        <xe:label label="${parent-asset-id}" label-style="label-default" weight-x="1" source="@parent_asset"/>
        <xe:label label="${child-asset-id}" label-style="label-default" weight-x="1" source="@child_asset"/>
        <xe:label label="${type}" label-style="label-default" value="=cachelookup('asset_rel_typedef', '@key', @key)@name">
          <xe:listen-to source="@key"/>
        </xe:label>
        <xe:selectcase source="@key" align="down">
          <xe:case value="target.">
            <xe:checkbox label="${delete-locked}" label-style="label-default" width="200" unchecked-value="0" checked-value="2" source="@deletion"/>
            <xe:checkbox label="${cancellation}" label-style="label-default" width="200" unchecked-value="0" checked-value="1" source="@iscancellation"/>
            <xe:popupmenutree label="${domain}" label-style="label-default" source="@domain" hide-root-popup="false">
              <xe:treeoptions label-key="@name" value-key="@pathid">
                <xe:generator name="filtered_cachedtables" table-name="domain"/>
                <xe:sort key="@sorting" data-type="integer"/>
              </xe:treeoptions>
            </xe:popupmenutree>
            <xe:popupmenutree label="${domain2}" label-style="label-default" source="@domain2" hide-root-popup="false" visible="=:count(cs:master-data('domain2')) gt 1">
              <xe:treeoptions label-key="@name" value-key="@pathid">
                <xe:generator name="filtered_cachedtables" table-name="domain2"/>
                <xe:sort key="@sorting" data-type="integer"/>
              </xe:treeoptions>
            </xe:popupmenutree>
          </xe:case>
        </xe:selectcase>
        <xe:editfield source="@sorting" label="${sorting}" label-style="label-default" data-type="INTEGER" width="5em"/>
      </xe:expandgroup>
      <xe:separator/>
      <!-- features -->
      <xe:expandgroup caption="${features}" align="down" readonly="=$param@readonly" id="features" expanded="true" save-state="true">
        <xe:include key="dialog-asset-features-of-groups-include">
          <xe:param feature_group="censhare:asset-feature" feature_element_name="asset_rel_feature"/>
        </xe:include>
      </xe:expandgroup>
      <!-- transformation variant -->
      <xe:separator/>
      <xe:include key="dialog-asset-edit-variant-relation-include"/>
    </xe:group>
  </xe:part>

  <!-- asset edit variant relation include (context must be the variant relation) -->
  <xe:part id="dialog-asset-edit-variant-relation-include" transactional="true">
    <xe:selectcase value="=true">
      <xe:case value="=:starts-with(*/@key, 'variant.transformation.')">
        <xe:variable name="parentAsset" value="=:cs:get-asset(*/@parent_asset)"/>
        <xe:group align="down">
          <xe:expandgroup caption="${transformation-variant}" align="down" readonly="=$param@readonly" id="transformation-variant" expanded="true" save-state="true">
            <!-- transformation asset -->
            <xe:group align="right">
              <xe:popupmenu label="${transformation-asset}" label-style="label-default" width="30em" source="asset_rel_feature[feature='censhare:transformation-asset-key']@value_string" select-first="false" sort="ascending">
                <xe:options value-key="@key" label-key="@name">
                  <xe:generator expression="=:cs:get-asset-resources($parentAsset)[@censhare:resource-usage='censhare:transformation-variant']"/>
                </xe:options>
                <xe:validate not-null="true"/>
              </xe:popupmenu>
              <xe:deletebutton align-y="top" source="asset_rel_feature[feature='censhare:transformation-asset-key']"/>
            </xe:group>
            <!-- include additional dialog of transformation asset -->
            <xe:group visible="=:boolean(*/asset_rel_feature[@feature='censhare:transformation-asset-key']/@value_string)" align="down">
              <xe:listen-to source="asset_rel_feature[feature='censhare:transformation-asset-key']@value_string"/>
              <xe:variable name="transformationKey" value="=:*/asset_rel_feature[@feature='censhare:transformation-asset-key']/@value_string"/>
              <xe:variable name="transformationAssetID" value="=:cs:cachelookup('resource_asset', '@key', */asset_rel_feature[@feature='censhare:transformation-asset-key']/@value_string)/@asset_id"/>
              <xe:variable name="transformationAsset" value="=:if ($transformationAssetID) then doc(concat('censhare:///service/assets/asset;censhare:resource-key=', $transformationKey)) else ()"/>
              <xe:variable name="transformationDialogAssetKey" value="=:if ($transformationAsset) then (for $x in $transformationAsset/asset/child_asset_rel/@child_asset return if (cs:cachelookup('resource_asset', '@asset_id', $x, '@type', 'module.dialog.')) then cs:cachelookup('resource_asset', '@asset_id', $x)/@key else ())[1] else ()"/>
              <xe:variable name="transformationDialogXml" value="=:if ($transformationDialogAssetKey) then doc(concat('censhare:///service/assets/asset;censhare:resource-key=', $transformationDialogAssetKey, '/transform;key=localize')) else ()"/>
              <!--xe:label label="Key" label-style="label-default" value="=:$transformationDialogAssetKey"/>
              <xe:label label="Asset-ID" label-style="label-default" value="=:$transformationAsset/asset/@id"/-->
              <xe:group enabled="=:exists($transformationDialogXml) and $transformationDialogXml/xe:parts/xe:part/@id!='edit-own-attributes'">
                <xe:include expression="=:$transformationDialogXml"/>
              </xe:group>
            </xe:group>
            <xe:strut height="10"/>
            <xe:checkbox label="" label-style="label-default" caption="${update-flag}" source="@variant_update_flag"/>
            <xe:checkbox label="" label-style="label-default" caption="${automatic}" source="@variant_automatic"/>
          </xe:expandgroup>
        </xe:group>
      </xe:case>
    </xe:selectcase>
  </xe:part>
  
  <!-- asset edit region variant relation include (context must be the variant region relation) -->
  <xe:part id="dialog-asset-edit-variant-region-include" transactional="true">
    <xe:group align="down">
      <xe:expandgroup caption="${region-variant}" align="down" readonly="=$param@readonly" id="region-variant" expanded="true" save-state="true">
        <xe:group align="right">
          <xe:popupmenutree source="asset_rel_feature[feature='censhare:print-regions']@value_key" hide-root-popup="true" defaultvalue="root.">
            <xe:treeoptions label-key="@name" value-key="@value_key">
              <xe:generator name="filtered_cachedtables" table-name="feature_value" source="@feature" match="censhare:print-regions"/>
            </xe:treeoptions>
            <xe:validate not-null="true"/>
          </xe:popupmenutree>
        </xe:group>
      </xe:expandgroup>
    </xe:group> 
  </xe:part>

  <!-- asset edit select relation include -->
  <xe:part id="dialog-asset-select-relation-include" transactional="true">
    <xe:group align="down" enabled="=:exists($parent-asset) and count(asset)=1 and exists(asset[1]/parent_asset_rel[@parent_asset=$parent-asset/asset/@id])">
      <xe:variable name="asset" value="=:asset"/>
      <xe:group align="right">
        <xe:label label="${relation}" label-style="label-default"/>
        <xe:label value="${asset}" width="5em"/>
        <xe:image url="=:concat($system/system/@censhare-url-prefix, 'assets/asset/id/', $parent-asset/asset/@id, '/icon/file')"/>
        <xe:label value="=:$parent-asset/asset/@name"/>
      </xe:group>
      <xe:group align="right">
        <xe:label label="" label-style="label-default"/>
        <xe:label value="${type}" width="5em"/>
        <xe:popupmenu source="=:concat('parent_asset_rel[parent_asset=''', $parent-asset/asset/@id, ''']@key')" sort="ascending">
          <xe:options value-key="@key" label-key="@name">
            <xe:generator name="filtered_cachedtables" table-name="asset_rel_typedef"/>
            <xe:filter condition="=:asset_rel_typedef/@is_user_editable='1' and not(starts-with(asset_rel_typedef/@key, 'variant.')) and cs:match-asset-rel-type(asset_rel_typedef/@key, $parent-asset/asset, $asset)"/>
          </xe:options>
          <xe:validate not-null="true"/>
        </xe:popupmenu>
      </xe:group>
    </xe:group>
  </xe:part>

  <!-- include: asset feature -->
  <xe:part id="dialog-asset-feature-include" transactional="true">
    <xe:group>
      <!-- feature -->
      <xe:selectcase value="=cachelookup('feature', '@key', '@feature')@value_type">
        <xe:listen-to source="@feature">
          <xe:delete dest="@value_key" condition="=cachelookup('feature', '@key', '@feature')@value_type!=1"/>
        </xe:listen-to>
        <!-- 1: hierarchical -->
        <xe:case value="1">
          <xe:selectcase source="$param@search">
            <xe:case value="true">
              <xe:selectcase value="=cachelookup('feature', '@key', '@feature')@value_list_resource_key">
                <xe:nullcase>
                  <xe:popupmenutree source="@value_key" hide-root-popup="true" defaultvalue="root." readonly="=:$readonly">
                    <xe:treeoptions label-key="@name" value-key="@value_key" add-joker="true">
                      <xe:generator name="filtered_cachedtables" table-name="feature_value" source="@feature" match-source="$current@feature"/>
                      <xe:sort key="@sorting" data-type="integer"/>
                      <xe:sort key="@name" data-type="string"/>
                    </xe:treeoptions>
                    <xe:validate not-null="true"/>
                  </xe:popupmenutree>
                </xe:nullcase>
                <xe:defaultcase>
                  <xe:popupmenutree source="@value_key" hide-root-popup="true" defaultvalue="root." readonly="=:$readonly">
                    <xe:treeoptions label-key="@display_value" value-key="@value" add-joker="true">
                      <xe:generator name="filtered_cachedtables" table-name="feature_value" source="@feature" match-source="$current@feature"/>
                      <xe:sort key="@sorting" data-type="integer"/>
                      <xe:sort key="@display_value" data-type="string"/>
                    </xe:treeoptions>
                    <xe:validate not-null="true"/>
                  </xe:popupmenutree>
                </xe:defaultcase>
              </xe:selectcase>
            </xe:case>
            <xe:defaultcase>
              <xe:selectcase value="=cachelookup('feature', '@key', '@feature')@value_list_resource_key">
                <xe:nullcase>
                  <xe:popupmenutree source="@value_key" hide-root-popup="true" defaultvalue="root." readonly="=:$readonly">
                    <xe:treeoptions label-key="@name" value-key="@value_key">
                      <xe:generator name="filtered_cachedtables" table-name="feature_value" source="@feature" match-source="$current@feature"/>
                      <xe:sort key="@sorting" data-type="integer"/>
                      <xe:sort key="@name" data-type="string"/>
                    </xe:treeoptions>
                    <xe:validate not-null="true"/>
                  </xe:popupmenutree>
                </xe:nullcase>
                <xe:defaultcase>
                  <xe:popupmenutree source="@value_key" hide-root-popup="true" defaultvalue="root." readonly="=:$readonly">
                    <xe:treeoptions label-key="@display_value" value-key="@value">
                      <xe:generator name="filtered_cachedtables" table-name="feature_value" source="@feature" match-source="$current@feature"/>
                      <xe:sort key="@sorting" data-type="integer"/>
                      <xe:sort key="@display_value" data-type="string"/>
                    </xe:treeoptions>
                    <xe:validate not-null="true"/>
                  </xe:popupmenutree>
                </xe:defaultcase>
              </xe:selectcase>
            </xe:defaultcase>
          </xe:selectcase>
        </xe:case>
        <!-- 2: enumeration -->
        <xe:case value="2">
          <xe:group align="right">
            <xe:popupmenu width="20em" source="@value_key" readonly="=:$readonly">
              <xe:options value-key="@value_key" label-key="@name">
                <xe:generator name="filtered_cachedtables" table-name="feature_value" source="@feature" match-source="$current@feature"/>
                <xe:sort key="@sorting" data-type="integer"/>
                <xe:sort key="@name" data-type="string"/>
              </xe:options>
              <xe:validate not-null="true"/>
            </xe:popupmenu>
            <xe:colorpicker value="=cachelookup('feature_value', '@feature', @feature, '@value_key', @value_key)@color" readonly="true" visible="=cachelookup('feature', '@key', @feature)@color_type > 0">
              <xe:listen-to source="@value_key"/>
              <xe:listen-to source="@feature"/>
            </xe:colorpicker>
          </xe:group>
        </xe:case>
        <!-- 3: integer -->
        <xe:case value="3">
          <xe:selectcase value="=cachelookup('feature', '@key', '@feature')@value_list_resource_key">
            <xe:listen-to source="@feature"/>
            <xe:nullcase>
              <xe:editfield width="20em" source="@value_long" data-type="VARCHAR(3500)" readonly="=:$readonly">
                <xe:validate not-empty="true"/>
              </xe:editfield>
            </xe:nullcase>
            <xe:defaultcase>
              <xe:group align="right">
                <xe:popupmenu width="20em" source="@value_long" readonly="=:$readonly">
                  <xe:options value-key="@value" label-key="@display_value">
                    <xe:generator name="filtered_cachedtables" table-name="feature_value" source="@feature" match-source="$current@feature"/>
                    <xe:sort key="@sorting" data-type="integer"/>
                    <xe:sort key="@display_value" data-type="string"/>
                  </xe:options>
                  <xe:validate not-null="true"/>
                </xe:popupmenu>
              </xe:group>
            </xe:defaultcase>
          </xe:selectcase>
        </xe:case>
        <!-- 4: string -->
        <xe:case value="4">
          <xe:selectcase value="=cachelookup('feature', '@key', '@feature')@value_list_resource_key">
            <xe:listen-to source="@feature"/>
            <xe:nullcase>
              <xe:editfield width="20em" source="@value_string" data-type="VARCHAR(3500)" readonly="=:$readonly">
                <xe:validate not-empty="true"/>
              </xe:editfield>
            </xe:nullcase>
            <xe:defaultcase>
              <xe:group align="right">
                <xe:popupmenu width="20em" source="@value_string" readonly="=:$readonly">
                  <xe:options value-key="@value" label-key="@display_value">
                    <xe:generator name="filtered_cachedtables" table-name="feature_value" source="@feature" match-source="$current@feature"/>
                    <xe:sort key="@sorting" data-type="integer"/>
                    <xe:sort key="@display_value" data-type="string"/>
                  </xe:options>
                  <xe:validate not-null="true"/>
                </xe:popupmenu>
              </xe:group>
            </xe:defaultcase>
          </xe:selectcase>
        </xe:case>
        <!-- 5: timestamp -->
        <xe:case value="5">
          <xe:editdate width="20em" mode="qbe" source="@value_timestamp" visible="=$param@search='true'" readonly="=:$readonly">
            <xe:validate not-empty="true"/>
          </xe:editdate>
          <xe:date width="20em" source="@value_timestamp" type="date-time" visible="=$param@search!='true'" readonly="=:$readonly">
            <xe:validate not-null="true"/>
          </xe:date>
        </xe:case>
        <!-- 6: boolean -->
        <xe:case value="6">
          <xe:checkbox source="@value_long" checked-value="1" unchecked-value="0" defaultvalue="1" readonly="=:$readonly">
            <xe:validate not-empty="true"/>
          </xe:checkbox>
        </xe:case>
        <!-- 7: double -->
        <xe:case value="7">
          <xe:editfield width="20em" source="@value_double" data-type="NUMBER">
            <xe:validate not-null="true"/>
          </xe:editfield>
          <xe:selectcase value="=true" align-y="top">
            <xe:case value="=cachelookup('feature', '@key', @feature)@unit_set != null">
              <xe:popupmenu width="15em" source="@value_unit" readonly="=:$readonly">
                <xe:options value-key="@unit" label-key="@unit">
                  <xe:generator name="filtered_cachedtables" table-name="unit_set_rel" source="@unit_set" match="=cachelookup('feature', '@key', @feature)@unit_set"/>
                  <xe:sort key="@sorting" data-type="integer"/>
                </xe:options>
              </xe:popupmenu>
            </xe:case>
          </xe:selectcase>
        </xe:case>
        <!-- 8: integer pair-->
        <xe:case value="8">
          <xe:group align="right">
            <xe:editfield width="10em" source="@value_long" data-type="INTEGER" readonly="=:$readonly">
              <xe:listen-to source="@value_long2"/>
              <xe:validate condition="=:exists(asset_feature/@value_long) or exists(asset_feature/@value_long2)"/>
            </xe:editfield>
            <xe:editfield width="10em" source="@value_long2" data-type="INTEGER" readonly="=:$readonly">
              <xe:listen-to source="@value_long"/>
              <xe:validate condition="=:exists(asset_feature/@value_long) or exists(asset_feature/@value_long2)"/>
            </xe:editfield>
          </xe:group>
        </xe:case>
        <!-- 9: timestamp pair-->
        <xe:case value="9">
          <xe:group align="right">
            <xe:date label="${start}" width="15em" source="@value_timestamp" type="date-time" readonly="=:$readonly">
              <xe:listen-to source="@value_timestamp"/>
              <xe:validate condition="=:exists(asset_feature/@value_timestamp) or exists(asset_feature/@value_timestamp2)"/>
            </xe:date>
            <xe:date label="${end}" width="15em" source="@value_timestamp2" type="date-time" readonly="=:$readonly">
              <xe:listen-to source="@value_timestamp2"/>
              <xe:validate condition="=:exists(asset_feature/@value_timestamp) or exists(asset_feature/@value_timestamp2)"/>
            </xe:date>
          </xe:group>
        </xe:case>
        <!-- 10: asset reference -->
        <xe:case value="10">
          <xe:selectcase value="=cachelookup('feature', '@key', '@feature')@value_list_resource_key">
            <xe:listen-to source="@feature"/>
            <xe:nullcase>
              <xe:assetref source="@value_asset_id" width="30em" height="40" css-key="asset-info" allow-drop-replace="true" expression-id="asset-ref-list" readonly="=:$readonly">
                <xe:drop-filter condition="=:true()"/>
                <xe:change dest="@value_long2" value="0"/>
              </xe:assetref>
            </xe:nullcase>
            <xe:defaultcase>
              <xe:group align="right">
                <xe:popupmenu width="20em" source="@value_asset_id" readonly="=:$readonly">
                  <xe:options value-key="@value" label-key="@display_value">
                    <xe:generator name="filtered_cachedtables" table-name="feature_value" source="@feature" match-source="$current@feature"/>
                    <xe:sort key="@sorting" data-type="integer"/>
                    <xe:sort key="@display_value" data-type="string"/>
                  </xe:options>
                  <xe:validate not-null="true"/>
                </xe:popupmenu>
              </xe:group>
            </xe:defaultcase>
          </xe:selectcase>
          <!--xe:editfield width="20em" source="@value_asset_id" data-type="VARCHAR(3500)">
            <xe:validate not-empty="true"/>
            <xe:change dest="@value_long2" value="0"/>
          </xe:editfield-->
        </xe:case>
        <!-- 11: xml -->
        <xe:case value="11">
          <xe:displayxml weight-x="1" value="=:*/xmldata"/>
        </xe:case>
        <!-- 12: double pair -->
        <xe:case value="12">
          <xe:group align="right">
            <xe:editfield width="10em" source="@value_double" data-type="NUMBER" readonly="=:$readonly">
              <xe:listen-to source="@value_double"/>
              <xe:validate condition="=:exists(asset_feature/@value_double) or exists(asset_feature/@value_double2)"/>
            </xe:editfield>
            <xe:editfield width="10em" source="@value_double2" data-type="NUMBER" readonly="=:$readonly">
              <xe:listen-to source="@value_double2"/>
              <xe:validate condition="=:exists(asset_feature/@value_double) or exists(asset_feature/@value_double2)"/>
            </xe:editfield>
            <xe:selectcase value="=true" align-y="top">
              <xe:case value="=cachelookup('feature', '@key', @feature)@unit_set != null">
                <xe:popupmenu width="15em" source="@value_unit" readonly="=:$readonly">
                  <xe:options value-key="@unit" label-key="@unit">
                    <xe:generator name="filtered_cachedtables" table-name="unit_set_rel" source="@unit_set" match="=cachelookup('feature', '@key', @feature)@unit_set"/>
                    <xe:sort key="@sorting" data-type="integer"/>
                  </xe:options>
                </xe:popupmenu>
              </xe:case>
            </xe:selectcase>
          </xe:group>
        </xe:case>
        <!-- 13: date -->
        <xe:case value="13">
          <xe:date source="@value_timestamp" type="date" readonly="=:$readonly">
            <xe:validate not-null="true"/>
          </xe:date>
        </xe:case>
        <!-- 14: date pair -->
        <xe:case value="14">
          <xe:group align="right">
            <xe:date source="@value_timestamp" type="date" readonly="=:$readonly">
              <xe:listen-to source="@value_timestamp"/>
              <xe:validate condition="=:exists(asset_feature/@value_timestamp) or exists(asset_feature/@value_timestamp2)"/>
            </xe:date>
            <xe:strut width="6"/>
            <xe:date source="@value_timestamp2" type="date" readonly="=:$readonly">
              <xe:listen-to source="@value_timestamp"/>
              <xe:validate condition="=:exists(asset_feature/@value_timestamp) or exists(asset_feature/@value_timestamp2)"/>
            </xe:date>
          </xe:group>
        </xe:case>
        <!-- 15: time -->
        <xe:case value="15">
          <xe:date source="@value_timestamp" type="time" readonly="=:$readonly">
            <xe:validate not-null="true"/>
          </xe:date>
        </xe:case>
        <!-- 16: time pair -->
        <xe:case value="16">
          <xe:group align="right">
            <xe:date source="@value_timestamp" type="time" readonly="=:$readonly">
              <xe:listen-to source="@value_timestamp"/>
              <xe:validate condition="=:exists(asset_feature/@value_timestamp) or exists(asset_feature/@value_timestamp2)"/>
            </xe:date>
            <xe:strut width="6"/>
            <xe:date source="@value_timestamp2" type="time" readonly="=:$readonly">
              <xe:listen-to source="@value_timestamp"/>
              <xe:validate condition="=:exists(asset_feature/@value_timestamp) or exists(asset_feature/@value_timestamp2)"/>
            </xe:date>
          </xe:group>
        </xe:case>
        <!-- 17: year -->
        <xe:case value="17">
          <xe:date source="@value_timestamp" type="year" readonly="=:$readonly">
            <xe:validate not-null="true"/>
          </xe:date>
        </xe:case>
        <!-- 18: year pair -->
        <xe:case value="18">
          <xe:group align="right">
            <xe:date source="@value_timestamp" type="year" readonly="=:$readonly">
              <xe:listen-to source="@value_timestamp"/>
              <xe:validate condition="=:exists(asset_feature/@value_timestamp) or exists(asset_feature/@value_timestamp2)"/>
            </xe:date>
            <xe:strut width="6"/>
            <xe:date source="@value_timestamp2" type="year" readonly="=:$readonly">
              <xe:listen-to source="@value_timestamp"/>
              <xe:validate condition="=:exists(asset_feature/@value_timestamp) or exists(asset_feature/@value_timestamp2)"/>
            </xe:date>
          </xe:group>
        </xe:case>
        <!-- 19: year/month -->
        <xe:case value="19">
          <xe:date source="@value_timestamp" type="year-month" readonly="=:$readonly">
            <xe:validate not-null="true"/>
          </xe:date>
        </xe:case>
        <!-- 20: year/month pair -->
        <xe:case value="20">
          <xe:group align="right">
            <xe:date source="@value_timestamp" type="year-month" readonly="=:$readonly">
              <xe:listen-to source="@value_timestamp"/>
              <xe:validate condition="=:exists(asset_feature/@value_timestamp) or exists(asset_feature/@value_timestamp2)"/>
            </xe:date>
            <xe:strut width="6"/>
            <xe:date source="@value_timestamp2" type="year-month" readonly="=:$readonly">
              <xe:listen-to source="@value_timestamp"/>
              <xe:validate condition="=:exists(asset_feature/@value_timestamp) or exists(asset_feature/@value_timestamp2)"/>
            </xe:date>
          </xe:group>
        </xe:case>
        <!-- 21: month -->
        <xe:case value="21">
          <xe:date source="@value_timestamp" type="month" readonly="=:$readonly">
            <xe:validate not-null="true"/>
          </xe:date>
        </xe:case>
        <!-- 22: month pair -->
        <xe:case value="22">
          <xe:group align="right">
            <xe:date source="@value_timestamp" type="month" readonly="=:$readonly">
              <xe:listen-to source="@value_timestamp"/>
              <xe:validate condition="=:exists(asset_feature/@value_timestamp) or exists(asset_feature/@value_timestamp2)"/>
            </xe:date>
            <xe:strut width="6"/>
            <xe:date source="@value_timestamp2" type="month" readonly="=:$readonly">
              <xe:listen-to source="@value_timestamp"/>
              <xe:validate condition="=:exists(asset_feature/@value_timestamp) or exists(asset_feature/@value_timestamp2)"/>
            </xe:date>
          </xe:group>
        </xe:case>
        <!-- 23: month/day -->
        <xe:case value="23">
          <xe:date source="@value_timestamp" type="month-day" readonly="=:$readonly">
            <xe:validate not-null="true"/>
          </xe:date>
        </xe:case>
        <!-- 24: month/day pair -->
        <xe:case value="24">
          <xe:group align="right">
            <xe:date source="@value_timestamp" type="month-day" readonly="=:$readonly">
              <xe:listen-to source="@value_timestamp"/>
              <xe:validate condition="=:exists(asset_feature/@value_timestamp) or exists(asset_feature/@value_timestamp2)"/>
            </xe:date>
            <xe:strut width="6"/>
            <xe:date source="@value_timestamp2" type="month-day" readonly="=:$readonly">
              <xe:listen-to source="@value_timestamp"/>
              <xe:validate condition="=:exists(asset_feature/@value_timestamp) or exists(asset_feature/@value_timestamp2)"/>
            </xe:date>
          </xe:group>
        </xe:case>
        <!-- 25: day -->
        <xe:case value="25">
          <xe:date source="@value_timestamp" type="day" readonly="=:$readonly">
            <xe:validate not-null="true"/>
          </xe:date>
        </xe:case>
        <!-- 26: day pair -->
        <xe:case value="26">
          <xe:group align="right">
            <xe:date source="@value_timestamp" type="day" readonly="=:$readonly">
              <xe:listen-to source="@value_timestamp"/>
              <xe:validate condition="=:exists(asset_feature/@value_timestamp) or exists(asset_feature/@value_timestamp2)"/>
            </xe:date>
            <xe:strut width="6"/>
            <xe:date source="@value_timestamp2" type="day" readonly="=:$readonly">
              <xe:listen-to source="@value_timestamp"/>
              <xe:validate condition="=:exists(asset_feature/@value_timestamp) or exists(asset_feature/@value_timestamp2)"/>
            </xe:date>
          </xe:group>
        </xe:case>
        <!-- 27: duration (not used) -->
        <!-- 28: asset key -->
        <xe:case value="28">
          <xe:editfield width="20em" source="@value_string" data-type="VARCHAR(256)" readonly="=:$readonly">
            <xe:validate not-empty="true"/>
          </xe:editfield>
        </xe:case>
        <!-- 29: asset key ref -->
        <xe:case value="29">
          <xe:selectcase value="=cachelookup('feature', '@key', '@feature')@value_list_resource_key">
            <xe:listen-to source="@feature"/>
            <xe:nullcase>
              <xe:editfield width="20em" source="@value_asset_key_ref" data-type="VARCHAR(256)" readonly="=:$readonly">
                <xe:validate not-empty="true"/>
                <xe:change dest="@value_string2" value="censhare:resource-key"/>
              </xe:editfield>
            </xe:nullcase>
            <xe:defaultcase>
              <xe:group align="right">
                <xe:popupmenu width="20em" source="@value_asset_key_ref" readonly="=:$readonly">
                  <xe:options value-key="@value" label-key="@display_value">
                    <xe:generator name="filtered_cachedtables" table-name="feature_value" source="@feature" match-source="$current@feature"/>
                    <xe:sort key="@sorting" data-type="integer"/>
                    <xe:sort key="@display_value" data-type="string"/>
                  </xe:options>
                  <xe:validate not-null="true"/>
                </xe:popupmenu>
              </xe:group>
            </xe:defaultcase>
          </xe:selectcase>
        </xe:case>
        <!-- no value -->
        <xe:defaultcase/>
      </xe:selectcase>
      <!-- language -->
      <xe:selectcase value="=cachelookup('feature', '@key', '@feature')@language_type">
        <xe:listen-to source="@feature"/>
        <!-- optional -->
        <xe:case value="1">
          <xe:group>
            <xe:popupmenu label="${language}" source="@language" sort="ascending" readonly="=:$readonly">
              <xe:options label-key="@name" value-key="@id" null-entry="true">
                <xe:generator name="filtered_cachedtables" table-name="language_def"/>
              </xe:options>
            </xe:popupmenu>
          </xe:group>
        </xe:case>
        <!-- mandatory -->
        <xe:case value="2">
          <xe:group>
            <xe:popupmenu label="${language}" source="@language" sort="ascending" readonly="=:$readonly">
              <xe:options label-key="@name" value-key="@id">
                <xe:generator name="filtered_cachedtables" table-name="language_def"/>
              </xe:options>
              <xe:validate not-null="true"/>
            </xe:popupmenu>
          </xe:group>
        </xe:case>
        <!-- no language -->
        <xe:defaultcase/>
      </xe:selectcase>
      <!-- relevance -->
      <xe:selectcase value="=cachelookup('feature', '@key', '@feature')@has_relevance">
        <xe:listen-to source="@feature"/>
        <xe:case value="1">
          <xe:group align-y="top">
            <xe:editfield label="${relevance}" width="4em" source="@relevance_percentage" data-type="NUMBER" defaultvalue="100" readonly="=:$readonly"/>
            <xe:label value="%"/>
          </xe:group>
        </xe:case>
        <!-- no relevances -->
        <xe:defaultcase/>
      </xe:selectcase>
    </xe:group>
  </xe:part>

  <!-- include: asset features of categories (test) -->
  <!--xe:part id="dialog-asset-features-of-category-include" transactional="true">
    <xe:group align="right">
      <xe:label label="${category-features}" label-style="label-default" align-y="top"/>
      <xe:group align="down">
        <xe:foreach new-button="false" align="down">
          <xe:generator name="cachedtables" table-name="feature"/>
          <xe:row-filters combine="and">
            <xe:filter condition="=:feature/@type='censhare:category-feature'"/>
            <xe:filter condition="=:count(cs:cachelookup('feature_category','@feature', feature/@key)>0)"/>
          </xe:row-filters>
          <xe:label label="=@name" label-style="label-default" align-y="top"/>
          <xe:include key="dialog-asset-feature-include"/>
        </xe:foreach>
      </xe:group>
    </xe:group>
  </xe:part-->

  <!-- include: asset features of categories -->
  <xe:part id="dialog-asset-features-of-category-include" transactional="true">
    <xe:group align="right">
      <xe:label label="${category-features}" label-style="label-default" align-y="top"/>
      <xe:group align="down">
        <xe:foreach source="asset_feature" align="down">
          <!-- required for multi-selection / multi-value editing -->
          <xe:identify-children-by key="@feature"/>
          <xe:identify-children-by key="@value_key"/>
          <xe:identify-children-by key="@value_string"/>
          <xe:identify-children-by key="@value_long"/>
          <xe:identify-children-by key="@value_timestamp"/>
          <xe:sort expression="=cachelookup('feature_value','@feature','@feature','@value_key','@value_key')@name${localized-attr-suffix}"/>
          <xe:row-filters combine="and">
            <!-- skip features that do not belong to any category -->
            <xe:filter condition="=cachelookup('feature_category', '@feature', '@feature') != null"/>
            <xe:filter condition="=cachelookup('feature', '@key', '@feature')@type='censhare:category-feature'"/>
          </xe:row-filters>
          <xe:popupmenu width="20em" source="@feature" sort="ascending">
            <xe:options value-key="@key" label-key="@name">
              <xe:generator name="cachedtables" table-name="feature"/>
              <xe:filters combine="and">
                <xe:filter condition="=:feature/@type='censhare:category-feature'"/>
                <!-- version for only the choosen category -->
                <!--xe:filter condition="=:boolean(for $x in ($content/asset/asset_feature[@feature='censhare:category']) return cs:cachelookup('feature_category','@category', $x/@value_key, '@feature', /feature/@key))"/-->
                <!-- version for choosen and all parent categories -->
                <xe:filter condition="=:boolean(for $x in ($content/asset/asset_feature[@feature='censhare:category']) return for $y in (1 to xs:long(count(tokenize($x/@value_key, '\.')))) return cs:cachelookup('feature_category','@category', concat(string-join(subsequence(tokenize($x/@value_key, '\.'), 1, $y), '.'), '.'), '@feature', /feature/@key))"/>
                <!-- filter multi value -->
                <xe:filter condition="=:feature/@ismultivalue='1' or $current/asset_feature/@feature=feature/@key or empty(for $x in feature/@key return $content/asset/asset_feature[@feature=$x])"/>
              </xe:filters>
            </xe:options>
            <xe:validate not-null="true"/>
            <xe:change dest="@value_key" value="=null"/>
            <xe:change dest="@value_string" value="=null"/>
            <xe:change dest="@value_long" value="=null"/>
            <xe:change dest="@value_timestamp" value="=null"/>
            <xe:change dest="@value_double" value="=null"/>
            <xe:change dest="@value_unit" value="=null"/>
          </xe:popupmenu>
          <xe:include key="dialog-asset-feature-include"/>
          <xe:deletebutton/>
        </xe:foreach>
      </xe:group>
    </xe:group>
  </xe:part>

  <!-- include: asset features of groups -->
  <xe:part id="dialog-asset-features-of-groups-include" transactional="true">
    <xe:group align="right">
      <xe:label label="${features}" label-style="label-default" align-y="top"/>
      <xe:group align="down">

        <!-- samples for direct features (no popup) -->
        <!--
          <xe:editfield label="text" source="asset_feature[feature='censhare:geo-coord']@value_double"/>
        -->

        <xe:foreach source="=$param@feature_element_name">
          <xe:identify-children-by key="@feature"/>
          <!-- xe:identify-children-by key="@value_key"/>
          <xe:identify-children-by key="@value_string"/>
          <xe:identify-children-by key="@value_long"/>
          <xe:identify-children-by key="@value_timestamp"/-->
          <xe:sort expression="=cachelookup('feature_value','@feature','@feature','@value_key','@value_key')@name${localized-attr-suffix}"/>

          <!-- filter displayed features by group -->
          <!--
            <xe:row-filters combine="or">
            <xe:filter condition="=cachelookup('feature_category', '@feature', '@feature')@feature_group == 'mygroup1'"/>
            <xe:filter condition="=cachelookup('feature_category', '@feature', '@feature')@feature_group == 'mygroup2'"/>
            </xe:row-filters>
          -->

          <!-- filter displayed features by type -->
          <!--
            <xe:row-filters combine="or">
            <xe:filter condition="=cachelookup('feature', '@key', '@feature')@type == 'mytype1'"/>
            <xe:filter condition="=cachelookup('feature', '@key', '@feature')@type == 'mytype2'"/>
            </xe:row-filters>
          -->

          <xe:row-filters combine="or">
            <xe:filter condition="=cachelookup('feature', '@key', '@feature')@type == $param@feature_group"/>
          </xe:row-filters>

          <xe:group align="down">
            <xe:variable name="is_admin" value="=:system-property('censhare:is-admin-mode')='true'"/>
            <xe:variable name="user_not_modifiable" value="=cachelookup('feature', '@key', '@feature')@user_modifiable=0"/>
            <xe:variable name="readonly" value="=:not($is_admin) and $user_not_modifiable"/>
            <xe:group align="right">
              <xe:popupmenu width="20em" source="@feature" sort="ascending" align-y="top" readonly="=:$readonly">
                <xe:options value-key="@key" label-key="@name" lazy-loading="true">
                  <xe:generator name="filtered_cachedtables" table-name="feature"/>
                  <!-- filter displayed features by group -->
                  <!--
                    <xe:filters combine="or">
                    <xe:filter condition="=cachelookup('feature_category', '@feature', '@key')@feature_group == 'mygroup1'"/>
                    <xe:filter condition="=cachelookup('feature_category', '@feature', '@key')@feature_group == 'mygroup2'"/>
                    </xe:filters>
                  -->

                  <!-- filter displayed features by type -->
                  <!--
                    <xe:filters combine="or">
                    <xe:filter source="@type" match="mytype1"/>
                    <xe:filter source="@type" match="mytype1"/>
                    </xe:filters>
                  -->

                  <xe:filters combine="and">
                    <!-- filter to given group -->
                    <xe:filter source="@type" match="=$param@feature_group"/>
                    <!-- filter multi value -->
                    <xe:filter condition="=:feature/@ismultivalue='1' or $current/asset_feature/@feature=feature/@key or empty(for $x in feature/@key return $content/asset/asset_feature[@feature=$x])"/>
                  </xe:filters>

                </xe:options>
                <xe:validate not-null="true"/>
                <!-- xe:change dest="@value_key" value="=null"/>
                <xe:change dest="@value_string" value="=null"/>
                <xe:change dest="@value_long" value="=null"/>
                <xe:change dest="@value_timestamp" value="=null"/-->
              </xe:popupmenu>
              <xe:include key="dialog-asset-feature-include"/>
              <xe:selectcase value="=:$readonly">
                <xe:case value="false">
                  <xe:deletebutton align-y="top"/>
                </xe:case>
                <xe:defaultcase/>
              </xe:selectcase>

            </xe:group>
            <!-- child features. -->
            <xe:variable name="meta-features-rw" value="=:boolean(cs:cachelookup('feature', '@target_object_type', 'asset_feature', '@enabled', '1', '@user_modifiable', '1'))"/>
            <xe:variable name="meta-features" value="=:boolean(cs:cachelookup('feature', '@target_object_type', 'asset_feature', '@enabled', '1'))"/>
            <xe:variable name="declared-child" value="=:boolean(cs:cachelookup('feature_rel', '@parent_feature', cs:equal-values(*/@feature, '')))"/>
            <xe:variable name="asset-has-child" value="=:boolean($current/asset_feature/asset_feature)"/>
            <xe:group visible="=:($is_admin and $meta-features) or $meta-features-rw or $declared-child or $asset-has-child">
              <xe:listen-to source="@feature"/>
              <xe:group align="right">
                <xe:strut width="3em" height="0"/>
                <xe:include key="dialog-asset-child-features-include">
                  <xe:param parent_feature_key="=@feature"/>
                </xe:include>
              </xe:group>
            </xe:group>
          </xe:group>
        </xe:foreach>

      </xe:group>
    </xe:group>
  </xe:part>

  <!-- include: asset child features -->
  <xe:part id="dialog-asset-child-features-include" transactional="true">
    <xe:group>
      <xe:variable name="parentElement" value="=:*[1]"/>
      <xe:foreach source="=$param@feature_element_name">
        <xe:identify-children-by key="@feature"/>
        <!-- xe:identify-children-by key="@value_key"/>
        <xe:identify-children-by key="@value_string"/>
        <xe:identify-children-by key="@value_long"/>
        <xe:identify-children-by key="@value_timestamp"/-->
        <xe:sort expression="=cachelookup('feature_value','@feature','@feature','@value_key','@value_key')@name${localized-attr-suffix}"/>
        <xe:group align="down">
          <xe:group align="right">
            <xe:variable name="user_not_modifiable" value="=cachelookup('feature', '@key', '@feature')@user_modifiable=0"/>
            <xe:variable name="readonly" value="=:not($is_admin) and $user_not_modifiable"/>
            <xe:popupmenu width="20em" source="@feature" sort="ascending" readonly="=:$readonly">
              <xe:options value-key="@key" label-key="@name" lazy-loading="true">
                <xe:generator name="filtered_cachedtables" table-name="feature"/>
                <xe:filters combine="and">
                  <!-- filter to given group -->
                  <xe:filter source="@type" match="=$param@feature_group"/>
                  <!-- OR filter: is declared child, (is admin and is metafeature), $current is a metafeature, metafeature is user modifiable -->
                  <xe:filter condition="=if (cachelookup('feature_rel', '@child_feature', '@key', '@parent_feature', $param@parent_feature_key)@parent_feature=$param@parent_feature_key or (is_admin and cachelookup('feature', '@key', '@key')@target_object_type='asset_feature') or cachelookup('feature', '@key', $current@feature)@target_object_type='asset_feature' or cachelookup('feature', '@key', '@key', '@target_object_type', 'asset_feature')@user_modifiable='1') then 1 else 0"/>
                  <!-- filter multi value -->
                  <xe:filter condition="=:feature/@ismultivalue='1' or $current/asset_feature/@feature=feature/@key or empty(for $x in feature/@key return $parentElement/asset_feature[@feature=$x])"/>
                </xe:filters>
              </xe:options>
              <xe:validate not-null="true"/>
              <!-- xe:change dest="@value_key" value="=null"/>
              <xe:change dest="@value_string" value="=null"/>
              <xe:change dest="@value_long" value="=null"/>
              <xe:change dest="@value_timestamp" value="=null"/-->
            </xe:popupmenu>
            <xe:include key="dialog-asset-feature-include"/>
            <xe:selectcase value="=:$readonly">
              <xe:case value="false">
                <xe:deletebutton align-y="top"/>
              </xe:case>
              <xe:defaultcase/>
            </xe:selectcase>
          </xe:group>
          <!-- child features -->
          <xe:group visible="=:boolean(cs:cachelookup('feature_rel', '@parent_feature', cs:equal-values(asset_feature/@feature, '')))">
            <xe:listen-to source="@feature"/>
            <xe:group align="right">
              <xe:strut width="3em" height="0"/>
              <xe:include key="dialog-asset-child-features-include">
                <xe:param parent_feature_key="=@feature"/>
              </xe:include>
            </xe:group>
          </xe:group>
        </xe:group>
      </xe:foreach>
    </xe:group>
  </xe:part>

  <!-- asset edit map dialog -->
  <xe:part id="dialog-asset-edit-map" transactional="true">
    <xe:group align="down">
      <!-- map -->
      <xe:map id="edit-map" map-control="small" zoom-level="10" map-type="road" address-out-source="tmp_map_address" address-in-source="tmp2_map_address@in" marker-label-source="@name" margin="5px" weight-y="1" weight-x="1">
        <xe:latitude source="asset_feature[feature='censhare:geo-coord']@value_double" defaultvalue="48.1539"/>
        <xe:longitude source="asset_feature[feature='censhare:geo-coord']@value_double2" defaultvalue="11.47875"/>
      </xe:map>
      <!-- map address -->
      <xe:groupbox caption="${map-address}" font-weight="bold" align="down" weight-x="1">
        <xe:group align="right">
          <xe:label label="${coordinates}" label-style="label-default" value="${latitude}"/>
          <xe:editfield width="8em" source="asset_feature[feature='censhare:geo-coord']@value_double" data-type="NUMBER"/>
          <xe:label value="°, ${longitude}"/>
          <xe:editfield width="8em" source="asset_feature[feature='censhare:geo-coord']@value_double2" data-type="NUMBER"/>
          <xe:label value="°"/>
          <xe:deletebutton>
            <xe:delete dest="asset_feature[feature='censhare:geo-coord']"/>
          </xe:deletebutton>
        </xe:group>
        <xe:group align="right">
          <xe:label label="${address}" label-style="label-default" align-y="top"/>
          <xe:html weight-x="1.0" prefwidth="200" margin="0" css-key="asset-info" expression-id="map-temp-address">
            <xe:listen-to source="tmp_map_address@formatted"/>
          </xe:html>
        </xe:group>
      </xe:groupbox>
      <xe:include key="dialog-asset-edit-postal-address-with-scrollpane">
        <xe:param show_action_buttons="true"/>
      </xe:include>
    </xe:group>
  </xe:part>

  <!-- asset edit slice tool dialog -->
  <xe:part id="dialog-asset-edit-slice-tool" transactional="true">
    <xe:group align="down">
      <xe:variable name="firstActualAssetElement" value="=:asset/asset_element[@corpus:first_child_type='actual.']"/>
      <xe:variable name="previewStorage" value="=:asset/storage_item[@key='preview' and @element_idx=$firstActualAssetElement/@idx]"/>
      <xe:selectcase value="=true">
        <xe:case value="=:exists($previewStorage)">
          <xe:foreach source="asset_feature" align="down" max-occurs="1">
            <xe:identify-children-by key="@feature"/>
            <xe:inititems>
              <xe:inititem dest="@feature" value="censhare:slice-tool.slice"/>
            </xe:inititems>
            <xe:row-filters>
              <xe:filter source="@feature" operator="=" match="censhare:slice-tool.slice"/>
            </xe:row-filters>
            <xe:label label="${slice-tool}" label-style="label-default" align-y="top"/>
            <xe:group align="down">
              <xe:slice-tool
                image-url="=:$previewStorage/@url" 
                image-width-pixel="=:$previewStorage/@width_px"
                image-height-pixel="=:$previewStorage/@height_px"
                width="=:$previewStorage/@width_px"
                height="=:$previewStorage/@height_px"
                source="xmldata.slice"
                label-expression="=:slice/@name"
                metadata-dialog-key="dialog-slice-tool-edit-slice"/>
              <xe:deletebutton/>
            </xe:group>
          </xe:foreach>
        </xe:case>
        <xe:defaultcase>
          <xe:label value="${no-preview-available}"/>
        </xe:defaultcase>
      </xe:selectcase>
    </xe:group>
  </xe:part>

   <!-- slice tool: edit slice -->
  <xe:part id="dialog-slice-tool-edit-slice" transactional="true">
    <xe:group align="down">
      <xe:editfield weight-x="1" maxwidth="500" label="${name}" label-style="label-default" source="@name">
        <xe:validate not-empty="true"/>
      </xe:editfield> 
      <!-- NOTE: To add additional attributes to slices, insert an editfield like the one below. The Attributes will be picked up automatically -->
      <!-- xe:editfield weight-x="1" maxwidth="500" label="Test" label-style="label-default" source="@test"/ -->
    </xe:group>
  </xe:part>
  
  <!-- asset edit budget and costs dialog -->
  <xe:part id="dialog-asset-edit-budget-and-costs" transactional="true">
    <xe:group align="down">
      <!-- resource -->
      <xe:expandgroup caption="${resource}" id="resource" expanded="true" save-state="true" align="down">
       <xe:group align="right">
          <xe:label label="${cost-types}" label-style="label-default" align-y="top"/>
          <xe:foreach source="asset_feature" align="down">
            <xe:inititems>
              <xe:inititem dest="@feature" value="censhare:resource-cost-type"/>
            </xe:inititems>
            <xe:row-filters>
              <xe:filter source="@feature" operator="=" match="censhare:resource-cost-type"/>
            </xe:row-filters>
            <xe:popupmenu source="@value_key" select-first="true" sort="ascending" width="30em">
              <xe:options label-key="@name" value-key="@value_key">
                <xe:generator name="cachedtables" table-name="feature_value" source="@feature" match="censhare:resource-cost-type"/>
              </xe:options>
              <xe:validate not-null="true"/>
            </xe:popupmenu>
            <xe:deletebutton/>
          </xe:foreach>
        </xe:group>
        <xe:group align="right" visible="=:exists(asset/asset_feature[@feature='censhare:resource-cost-type'])">
          <xe:listen-to source="asset_feature[feature='censhare:resource-cost-type']@value_key"/>
          <xe:label label="${costs}" label-style="label-default" align-y="top"/>
          <xe:foreach source="asset_feature" align="down">
            <xe:inititems>
              <xe:inititem dest="@feature" value="censhare:resource-cost-unit"/>
            </xe:inititems>
            <xe:row-filters>
              <xe:filter source="@feature" operator="=" match="censhare:resource-cost-unit"/>
            </xe:row-filters>
            <xe:popupmenu source="@value_key" select-first="true" sort="ascending">
              <xe:options label-key="@name" value-key="@value_key">
                <xe:generator name="cachedtables" table-name="feature_value" source="@feature" match="censhare:resource-cost-unit"/>
              </xe:options>
              <xe:validate not-null="true"/>
            </xe:popupmenu>
            <xe:editfield width="10em" source="asset_feature[feature='censhare:resource-costs']@value_double" data-type="NUMBER" label="${costs-standard}">
              <xe:validate not-null="true"/>
            </xe:editfield>
            <xe:editfield width="10em" source="asset_feature[feature='censhare:resource-costs-overtime']@value_double" data-type="NUMBER" label="${costs-overtime}">
              <xe:validate not-null="true"/>
            </xe:editfield>
            <xe:popupmenu source="asset_feature[feature='censhare:resource-costs']@value_unit" select-first="true" sort="ascending">
              <xe:options label-key="@unit" value-key="@unit">
                <xe:generator name="cachedtables" table-name="unit_set_rel" source="@unit_set" match="censhare:currency"/>
              </xe:options>
              <xe:validate not-null="true"/>
            </xe:popupmenu>
            <xe:deletebutton/>
          </xe:foreach>
        </xe:group>
      </xe:expandgroup>
      <!-- budget -->
      <xe:separator/>
      <xe:expandgroup caption="${budget}" id="costs" expanded="true" save-state="true" align="down">
        <xe:include key="dialog-asset-edit-costs-include">
          <xe:param cost-type="censhare:costs-planned"/>
        </xe:include>
      </xe:expandgroup>
      <!-- costs -->
      <xe:separator/>
      <xe:expandgroup caption="${costs}" id="costs" expanded="true" save-state="true" align="down">
        <xe:include key="dialog-asset-edit-costs-include">
          <xe:param cost-type="censhare:costs-actual"/>
        </xe:include>
      </xe:expandgroup>
    </xe:group>
  </xe:part>

  <!-- asset edit relations dialog -->
  <!--xe:part id="dialog-asset-edit-relations" transactional="true">
    <xe:group align="down">
      <xe:variable name="asset" value="=:asset"/>
      <xe:label style="label-title" value="${parent-relations}" weight-x="1"/>
      <xe:variable name="parentRelationTypes" value="=:cs:cachelookup('asset_rel_typedef')/asset_rel_typedef[@kind='0' and @is_user_editable='1' and cs:match-asset-rel-type(@key, (), $asset)]"/>
      <xe:foreach>
        <xe:generator expression="=:$parentRelationTypes"/>
        <xe:sort key="@parent_name" data-type="string"/>
        <xe:group align="down">
          <xe:variable name="assetRelType" value="=:asset_rel_typedef"/>
          <xe:label value="=:$assetRelType/@parent_name"/>
          <xe:foreach show-empty-row="true" source="parent_asset_rel">
            <xe:identify-children-by key="@parent_asset"/>
            <xe:inititems>
              <xe:inititem dest="@key" value="=:$assetRelType/@key"/>
              <xe:inititem dest="@sorting" value="=:xs:integer(if ($content/asset/parent_asset_rel[@key=$assetRelType/@key]/@sorting) then max($content/asset/parent_asset_rel[@key=$assetRelType/@key]/@sorting) else 0) + 1"/>
            </xe:inititems>
            <xe:generator expression="=:$asset/parent_asset_rel[@key=$assetRelType/@key]"/>
            <xe:group align="right">
              <xe:drag-handle align-y="top" tooltip="${change-order}"/>
              <xe:strut width="1em"/>
              <xe:auto-completion-field source="@parent_asset" search-value-source="$temp@search_group" width="46em" internal-search="false" popup-row-height="40" popup-row-width="46em" css-key="asset-info" expression-id="asset-ref-list" max-items="100">
                <xe:options label-key="@name" value-key="@id" lookup-expression="=:cs:get-asset(parent_asset_rel/@parent_asset)">
                  <xe:generator expression="=:if ($temp/temp/@search_group and string-length($temp/temp/@search_group) > 2) then cs:asset()[@censhare:text.name = string($temp/temp/@search_group)] else ()"/>
                  <xe:option label="${new-asset}">
                    <cs:command name="create-new-asset">
                      <cs:param name="asset">
                        <asset type="picture.logo." name="=:$temp/*/@search_group"/>
                      </cs:param>
                      <cs:param name="dialog-key" value="dialog-asset-check-in-new"/>
                    </cs:command>
                  </xe:option>
                </xe:options>
              </xe:auto-completion-field>
              <xe:uiaction action="asset-editattributes" asset-selection-expression="=@child_asset" align-y="top"/>
              <xe:uiaction action="asset-checkout" asset-selection-expression="=@child_asset" align-y="top"/>
              <xe:uiaction action="server-action" key="basket.add-to-basket" asset-selection-expression="=@child_asset" align-y="top"/>
              <xe:editfield width="3em" source="@sorting" align-y="top"/>
              <xe:strut width="1em"/>
              <xe:move-prev align-y="top" tooltip="${move-forward}"/>
              <xe:move-next align-y="top" tooltip="${move-backward}"/>
              <xe:deletebutton icon="remove" align-y="top" tooltip="${detach}"/>
            </xe:group>
          </xe:foreach>
        </xe:group>
      </xe:foreach>
      <xe:label style="label-title" value="${child-relations}" weight-x="1"/>
      <xe:variable name="childRelationTypes" value="=:cs:cachelookup('asset_rel_typedef')/asset_rel_typedef[@kind='0' and @is_user_editable='1' and cs:match-asset-rel-type(@key, $asset, ())]"/>
      <xe:foreach>
        <xe:generator expression="=:$childRelationTypes"/>
        <xe:sort key="@child_name" data-type="string"/>
        <xe:group align="down">
          <xe:variable name="assetRelType" value="=:asset_rel_typedef"/>
          <xe:label value="=:$assetRelType/@child_name"/>
          <xe:foreach show-empty-row="true" source="child_asset_rel">
            <xe:identify-children-by key="@child_asset"/>
            <xe:inititems>
              <xe:inititem dest="@key" value="=:$assetRelType/@key"/>
              <xe:inititem dest="@sorting" value="=:xs:integer(if ($content/asset/child_asset_rel[@key=$assetRelType/@key]/@sorting) then max($content/asset/child_asset_rel[@key=$assetRelType/@key]/@sorting) else 0) + 1"/>
            </xe:inititems>
            <xe:generator expression="=:$asset/child_asset_rel[@key=$assetRelType/@key]"/>
            <xe:group align="right">
              <xe:drag-handle align-y="top" tooltip="${change-order}"/>
              <xe:strut width="1em"/>
              <xe:auto-completion-field source="@child_asset" search-value-source="$temp@search_group" width="46em" internal-search="false" popup-row-height="40" popup-row-width="46em" css-key="asset-info" expression-id="asset-ref-list" max-items="100">
                <xe:options label-key="@name" value-key="@id" lookup-expression="=:cs:get-asset(child_asset_rel/@child_asset)">
                  <xe:generator expression="=:if ($temp/temp/@search_group and string-length($temp/temp/@search_group) > 2) then cs:asset()[@censhare:text.name = string($temp/temp/@search_group)] else ()"/>
                  <xe:option label="${new-asset}">
                    <cs:command name="create-new-asset">
                      <cs:param name="asset">
                        <asset type="picture.logo." name="=:$temp/*/@search_group"/>
                      </cs:param>
                      <cs:param name="dialog-key" value="dialog-asset-check-in-new"/>
                    </cs:command>
                  </xe:option>
                </xe:options>
              </xe:auto-completion-field>
              <xe:uiaction action="asset-editattributes" asset-selection-expression="=@child_asset" align-y="top"/>
              <xe:uiaction action="asset-checkout" asset-selection-expression="=@child_asset" align-y="top"/>
              <xe:uiaction action="server-action" key="basket.add-to-basket" asset-selection-expression="=@child_asset" align-y="top"/>
              <xe:editfield width="3em" source="@sorting" align-y="top"/>
              <xe:strut width="1em"/>
              <xe:move-prev align-y="top" tooltip="${move-forward}"/>
              <xe:move-next align-y="top" tooltip="${move-backward}"/>
              <xe:deletebutton icon="remove" align-y="top" tooltip="${detach}"/>
            </xe:group>
          </xe:foreach>
        </xe:group>
      </xe:foreach>
    </xe:group>
  </xe:part-->

  <!-- asset info dialog -->
  <xe:part id="dialog-asset-info" transactional="false">
    <xe:group align="down">
      <xe:assetpreview weight-x="1.0" prefwidth="200" height="200" storagekey="thumbnail" margin="5"/>
      <xe:include key="asset-info-include"/>
    </xe:group>
  </xe:part>

  <!-- asset info include dialog -->
  <xe:part id="asset-info-include" transactional="false">
    <xe:group align="down">
      <xe:html weight-x="1.0" weight-y="1.0" prefwidth="200" margin="0" css-key="asset-info" expression-id="asset-info"/>
    </xe:group>
  </xe:part>
  
  <!-- asset info include comparison view dialog -->
  <xe:part id="asset-comparison-view-include" transactional="false">
    <xe:group align="down">
      <xe:html weight-x="1.0" prefwidth="200" margin="0" css-key="asset-info" expression-id="comparison-view-info"/>
    </xe:group>
  </xe:part>

  <!-- asset search filter dialog -->
  <!-- add <xe:queryfilter-params max-items="10"/> to reduce number of displayed items -->
  <xe:part id="dialog-asset-search-filter" transactional="false">
    <xe:group align="down">
      <xe:feature feature-key="censhare:text.meta" mode="query" widget-type="queryfield" add-label="false" weight-x="1" sort="ascending">
        <xe:queryfield-params add-title="true" is-for-filter="true"/>
      </xe:feature>
      <xe:feature feature-key="censhare:asset.type" mode="query" widget-type="queryfilter" add-label="false" weight-x="1" sort="ascending">
      </xe:feature>
      <xe:feature feature-key="censhare:asset.wf_id" mode="query" widget-type="queryfilter" add-label="false" weight-x="1" sort="ascending">
        <!--xe:queryfilter-params max-items="10"/-->
      </xe:feature>
      <xe:feature feature-key="censhare:function.workflow-step" mode="query" widget-type="queryfilter" add-label="false" weight-x="1">
        <xe:sort key="@sorting" data-type="integer"/>
      </xe:feature>
      <xe:feature feature-key="censhare:asset.wf_target" mode="query" widget-type="queryfilter" add-label="false" weight-x="1" sort="ascending">
        <xe:option-filters>
          <xe:filter source="@isvisible" match="1"/>
        </xe:option-filters>
      </xe:feature>
      <xe:feature feature-key="censhare:function.workflow-state" mode="query" widget-type="queryfilter" add-label="false" weight-x="1" sort="ascending">
      </xe:feature>
      <xe:feature feature-key="censhare:asset.wf_worst_state_id" mode="query" widget-type="queryfilter" add-label="false" weight-x="1" sort="ascending">
      </xe:feature>
      <xe:feature feature-key="censhare:asset.domain" mode="query" widget-type="queryfilter" add-label="false" weight-x="1">
        <xe:queryfilter-params partial-load-tree="true" hide-root-popup="true"/>
         <xe:sort key="@sorting" data-type="integer"/>
         <xe:sort key="@name${localized-attr-suffix}" data-type="string"/>
      </xe:feature>
      <xe:feature feature-key="censhare:asset.domain2" mode="query" widget-type="queryfilter" add-label="false" weight-x="1">
        <xe:queryfilter-params partial-load-tree="true" hide-root-popup="true"/>
         <xe:sort key="@sorting" data-type="integer"/>
         <xe:sort key="@name${localized-attr-suffix}" data-type="string"/>
      </xe:feature>
      <xe:feature feature-key="censhare:asset.language" mode="query" widget-type="queryfilter" add-label="false" weight-x="1" sort="ascending">
      </xe:feature>
      <xe:feature feature-key="censhare:output-channel" mode="query" widget-type="queryfilter" add-label="false" weight-x="1" sort="ascending">
      </xe:feature>
      <xe:feature feature-key="censhare:storage_item.mimetype" mode="query" widget-type="queryfilter" add-label="false" weight-x="1" sort="ascending">
      </xe:feature>
      <!--
      <xe:feature feature-key="censhare:input-form" mode="query" widget-type="queryfilter" add-label="false" weight-x="1" sort="ascending">
      </xe:feature>
      -->
    </xe:group>
  </xe:part>

  <!-- dictionary dialog -->
  <xe:part id="dialog-dictionary" transactional="false">
    <xe:groupbox align="down">
      <xe:popupmenu label="${dictionary-source-language}" label-style="label-default" width="250" source="param@in-locale" sort="ascending">
        <xe:options label-key="@name" value-key="@id">
          <xe:generator name="filtered_cachedtables" table-name="language_def"/>
        </xe:options>
      </xe:popupmenu>
      <xe:popupmenu label="${dictionary-target-language}" label-style="label-default" width="250" source="param@out-locale" sort="ascending">
        <xe:options label-key="@name" value-key="@id">
          <xe:generator name="filtered_cachedtables" table-name="language_def"/>
        </xe:options>
      </xe:popupmenu>
      <xe:editfield label="${dictionary-search-term}" label-style="label-default" width="200" source="param@search-term"/>
      <xe:xe-table source="terms.term" minwidth="500" minheight="100" rows="8">
        <xe:columns>
          <xe:column type="number" key="relevance" label="${dictionary-term-score}" formula="int(100 * double(@relevance))" width="50" sortable="true"/>
          <xe:column key="source" label="${dictionary-source-language}" source="@source" width="150" sortable="true"/>
          <xe:column key="target" label="${dictionary-target-language}" source="@target" width="150" sortable="true"/>
          <xe:column key="domain" label="${dictionary-domain}" source="@domain" width="100" sortable="true"/>
        </xe:columns>
      </xe:xe-table>
    </xe:groupbox>
  </xe:part>

  <!-- dictionary e-mail dialog -->
  <xe:part id="dialog-dictionary-email" transactional="false">
    <xe:group align="down">
      <xe:editfield label="${dictionary-new-term}" label-style="label-default" weight-x="1" source="param@dictionary-term">
        <xe:validate not-empty="true"/>
      </xe:editfield>
      <xe:edittext label="${dictionary-annotation}" label-style="label-default" prefwidth="200" weight-x="1" height="100" source="param@annotation"/>
    </xe:group>
  </xe:part>

  <!-- messages: edit message dialog -->
  <xe:part id="dialog-edit-message" transactional="false">
    <xe:group align="down">
      <xe:filterwidget id="messages-table-filter" filter-directly="true" icons="false"/>
      <xe:xe-table id="messages-table" filter-widget="messages-table-filter" source="message" minheight="100" prefwidth="100" prefheight="100" weight-x="1" weight-y="0.7" double-click-action="table-double-click" readonly="true">
        <xe:columns>
          <xe:sorting>
            <xe:sort-col key="date" ascending="false"/>
          </xe:sorting>
          <xe:column key="date" label="${date}" source="@timestamp" type="date" date-format="relative-short" time-format="short" width="150" filterable="true"/>
          <xe:column key="priority" label="${priority}" source="@message_level" width="70" filterable="true"/>
          <xe:column key="sender" label="${sender}" width="150" filterable="true" formula="cachelookup('party', '@id', @source_party)@display_name"/>
          <xe:column key="title" label="${title}" width="500" source="@title" filterable="true"/>
          <xe:column key="asset" label="${asset}" width="100" source="@asset_id" filterable="true"/>
        </xe:columns>
      </xe:xe-table>
    </xe:group>
  </xe:part>

  <!-- messages: edit message dialog -->
  <xe:part id="dialog-edit-reply-message" transactional="false">
    <xe:inititems>
      <xe:inititem dest="message" value=""/>
      <xe:inititem dest="@message_level" value="1120"/>
    </xe:inititems>
    <xe:groupbox align="down">
      <xe:group align="right">
        <xe:label label="${to}" label-style="label-default" label-width="7em" align-y="top"/>
        <xe:foreach source="message" align-y="top" leave-last="true">
          <xe:group align="right">
            <xe:popupmenu weight-x="1" source="@target" id="dialog-edit-reply-message.user" sort="ascending">
              <xe:options label-key="@display_name" value-key="@id">
                <xe:generator name="filtered_cachedtables" table-name="party" source="@isvisible" match="1"/>
                <xe:filter source="@isactive" match="1"/>
              </xe:options>
              <xe:validate not-empty="true"/>
            </xe:popupmenu>
            <xe:deletebutton leave-last="true" id="dialog-edit-reply-message.deletebutton"/>
          </xe:group>
        </xe:foreach>
      </xe:group>
      <xe:editfield label="${subject}" label-style="label-default" label-width="7em" weight-x="1" source="@subject" id="subject-field"/>
      <xe:popupmenu label="${priority}" label-style="label-default" label-width="7em" source="@message_level">
        <xe:options source="$temp.message-levels.message-level" value-key="@key" label-key="@name"/>
      </xe:popupmenu>
      <xe:edittext label="${message}" label-style="label-default" label-width="7em" rows="3" weight-x="1" source="@content" weight-y="1.0"/>
    </xe:groupbox>
  </xe:part>

  <!-- asset edit stored search dialog -->
  <xe:part id="dialog-edit-search" transactional="true">
    <xe:group align="down">
      <xe:expandgroup caption="${search}" id="search" expanded="true" save-state="true" align="down">
        <xe:editfield label="${name}" label-style="label-default" width="30em" source="@name">
          <xe:validate not-empty="true"/>
        </xe:editfield>
        <xe:group align="right">
          <!-- todo: filter party for domains above and below of the domains of the logged-in user -->
          <xe:popupmenu label="${party}" label-style="label-default" width="30em" source="@party_id" sort="ascending">
            <xe:options label-key="@display_name" value-key="@id" null-entry="true">
              <xe:generator name="filtered_cachedtables" table-name="party"/>
            </xe:options>
          </xe:popupmenu>
          <xe:deletebutton source="@party_id"/>
        </xe:group>
        <xe:group align="right">
          <xe:popupmenu label="${role}" label-style="label-default" width="30em" source="@role" sort="ascending">
            <xe:options label-key="@name" value-key="@role" null-entry="true">
              <xe:generator name="cachedtables" table-name="role"/>
            </xe:options>
          </xe:popupmenu>
          <xe:deletebutton source="@role"/>
        </xe:group>
        <xe:popupmenutree label="${domain}" label-style="label-default" source="@domain" hide-root-popup="false">
          <xe:treeoptions label-key="@name" value-key="@pathid">
            <xe:generator name="filtered_cachedtables" table-name="domain"/>
             <xe:sort key="@sorting" data-type="integer"/>
             <xe:sort key="@name${localized-attr-suffix}" data-type="string"/>
          </xe:treeoptions>
        </xe:popupmenutree>
        <xe:popupmenutree label="${domain2}" label-style="label-default" source="@domain2" hide-root-popup="false" visible="=:count(cs:master-data('domain2')) gt 1">
          <xe:treeoptions label-key="@name" value-key="@pathid">
            <xe:generator name="filtered_cachedtables" table-name="domain2"/>
            <xe:sort key="@sorting" data-type="integer"/>
            <xe:sort key="@name${localized-attr-suffix}" data-type="string"/>
          </xe:treeoptions>
        </xe:popupmenutree>
      </xe:expandgroup>
      <xe:expandgroup caption="${shortcut}" id="shortcut" expanded="true" save-state="true" align="down">
        <xe:editfield label="Windows" label-style="label-default" width="30em" source="@shortcut_win" tooltip="${shortcut-tooltip-win}"/>
        <xe:editfield label="Macintosh" label-style="label-default" width="30em" source="@shortcut_mac" tooltip="${shortcut-tooltip-mac}"/>
      </xe:expandgroup>
    </xe:group>
  </xe:part>

  <!-- planning: annotation history dialog -->
  <xe:part id="dialog-planning-annotation-history" transactional="false">
    <xe:group align="down">
      <xe:group align="right">
        <xe:label width="50" value="${version}"/>
        <xe:label width="150" value="${modified-by}"/>
        <xe:label width="200" value="${annotation}"/>
      </xe:group>
      <xe:foreach new-caption="" source="element" align="down">
        <xe:label width="50" source="@asset_version"/>
        <xe:group align="down">
          <xe:label width="150" source="@modified_by_name"/>
          <xe:label width="150" source="@modified_date"/>
        </xe:group>
        <xe:edittext prefwidth="200" weight-x="1" source="@annotation"/>
      </xe:foreach>
    </xe:group>
  </xe:part>

  <!-- planning: description history dialog -->
  <xe:part id="dialog-planning-description-history" transactional="false">
    <xe:group align="down">
      <xe:group align="right">
        <xe:label width="50" value="${version}"/>
        <xe:label width="150" value="${modified-by}"/>
        <xe:label width="200" value="${description}"/>
      </xe:group>
      <xe:foreach new-caption="" source="element" align="down">
        <xe:label width="50" source="@asset_version"/>
        <xe:group align="down">
          <xe:label width="150" source="@modified_by_name"/>
          <xe:label width="150" source="@modified_date"/>
        </xe:group>
        <xe:edittext prefwidth="200" weight-x="1" source="@description"/>
      </xe:foreach>
    </xe:group>
  </xe:part>

  <!-- planning: edit annotation dialog -->
  <xe:part id="dialog-planning-edit-annotation" transactional="true">
    <xe:group align="down">
      <xe:assetpreview height="200" weight-x="1" prefwidth="200" storagekey="thumbnail"/>
      <xe:edittext label="${annotation}" prefwidth="200" weight-x="1" source="@annotation" data-type="VARCHAR(3500)"/>
    </xe:group>
  </xe:part>

  <!-- planning: edit description dialog -->
  <xe:part id="dialog-planning-edit-description" transactional="true">
    <xe:group align="down">
      <xe:assetpreview height="200" weight-x="1" prefwidth="200" storagekey="thumbnail"/>
      <xe:edittext label="${description}" prefwidth="200" weight-x="1" source="@description" data-type="VARCHAR(3500)"/>
    </xe:group>
  </xe:part>

  <!-- planning: create regional split page dialog -->
  <xe:part id="dialog-planning-create-reg-split-page" transactional="true"> 
     <xe:group align="down">
       <xe:strut width="0" height="10"/>
       <xe:group align="right">
         <xe:label source="@pageinfo" width="360" align-x="left" font-weight="bold" font-family="Helvetica"/>
       </xe:group>
       <xe:strut width="0" height="10"/>
       <xe:foreach source="newregion" align="down" readonly="false" new-button="true">
         <xe:group align="right">
           <xe:group align="right" width="400" align-x="left">
              <xe:popupmenutree source="region_feature@value_key" hide-root-popup="true" defaultvalue="root." sort="ascending" align-x="left">
                <xe:treeoptions label-key="@name" value-key="@pathid">
                  <xe:generator name="filtered_cachedtables" table-name="print_region"/>
                </xe:treeoptions>
              </xe:popupmenutree>
           </xe:group>
         </xe:group>
         <xe:deletebutton/>
       </xe:foreach>
      </xe:group>
    </xe:part>    
   
   <!-- planning: edit regional split page dialog -->
  <xe:part id="dialog-planning-edit-reg-split-page" transactional="true"> 
    <xe:group align="down">
      <xe:strut width="0" height="10"/>
      <xe:group align="right">
        <xe:label source="@pageinfo" width="360" align-x="left" font-weight="bold" font-family="Helvetica"/>
      </xe:group>
      <xe:strut width="0" height="10"/>
      <xe:group align="down">
        <xe:foreach source="region" align="down" readonly="false" new-button="false">
          <xe:group align="right">
            <xe:label source="region_feature@value_name" width="400"  align-x="left"/>
          </xe:group>
          <xe:button icon="remove">
            <xe:delete dest="."/>
            <xe:delete dest="region_feature"/>
            <xe:delete dest="asset"/>
          </xe:button>
        </xe:foreach>
      </xe:group>
      <xe:group align="down">
        <xe:foreach source="newregion" align="down" readonly="false" new-button="true">
          <xe:group align="right">
            <xe:group align="right" width="400" align-x="left">
              <xe:popupmenutree source="region_feature@value_key" hide-root-popup="true" defaultvalue="root." sort="ascending" align-x="left">
                <xe:treeoptions label-key="@name" value-key="@pathid">
                  <xe:generator name="filtered_cachedtables" table-name="print_region"/>
                </xe:treeoptions>
              </xe:popupmenutree>
           </xe:group>
         </xe:group>
         <xe:deletebutton/>
       </xe:foreach>
      </xe:group>
     </xe:group>    
   </xe:part>
   
   <!-- planning: append regional split page dialog -->
  <xe:part id="dialog-planning-append-reg-split-page" transactional="true"> 
    <xe:group align="down">
      <xe:strut width="0" height="40"/>
      <xe:group align="right">
        <xe:label source="@appendinfo" width="360" align-x="left" font-weight="bold" font-family="Helvetica"/>
      </xe:group>
      <xe:strut width="0" height="20"/>
      <xe:separator/>
      <xe:strut width="0" height="20"/>
      <xe:group align="right">
        <xe:label source="@pageinfo" width="360" align-x="left" font-weight="bold" font-family="Helvetica"/>
      </xe:group>
      <xe:strut width="0" height="10"/>
      <xe:group align="down">
        <xe:foreach source="region" align="down" readonly="false" new-button="false">
          <xe:group align="right">
            <xe:label source="region_feature@value_name" width="400"  align-x="left"/>
          </xe:group>
          <xe:button icon="remove">
            <xe:delete dest="."/>
            <xe:delete dest="region_feature"/>
            <xe:delete dest="asset"/>
          </xe:button>
        </xe:foreach>
      </xe:group>
      <xe:group align="down">
        <xe:foreach source="newregion" align="down" readonly="false" new-button="true">
          <xe:group align="right">
            <xe:group align="right" width="400" align-x="left">
              <xe:popupmenutree source="region_feature@value_key" hide-root-popup="true" defaultvalue="root." sort="ascending" align-x="left">
                <xe:treeoptions label-key="@name" value-key="@pathid">
                  <xe:generator name="filtered_cachedtables" table-name="print_region"/>
                </xe:treeoptions>
              </xe:popupmenutree>
           </xe:group>
         </xe:group>
         <xe:deletebutton/>
       </xe:foreach>
      </xe:group>
     </xe:group>    
   </xe:part>      

  <!-- asset edit schedule item dialog -->
  <xe:part id="dialog-schedule-edit-item" transactional="true">
    <xe:group align="down">
      <xe:editfield label="${name}" label-style="label-default" width="200" source="@name" data-type="VARCHAR(256)">
        <xe:validate not-empty="true"/>
      </xe:editfield>
      <xe:popupmenu label="${type}" label-style="label-default" width="200" source="@type">
        <xe:options label-key="@name" value-key="@type">
          <xe:generator name="cachedtables" table-name="schedule_step_typedef"/>
          <xe:sort key="@sorting" data-type="integer"/>
        </xe:options>
      </xe:popupmenu>
      <xe:checkbox label="${milestone}" label-style="label-default" source="@ismilestone" unchecked-value="0" checked-value="1"/>
      <xe:editfield label="${description}" label-style="label-default" width="200" source="@description" data-type="VARCHAR(3500)"/>
      <xe:group align="right">
        <xe:colorpicker label="${colour}" label-style="label-default" width="16" height="16" source="@color"/>
        <xe:deletebutton source="@color"/>
      </xe:group>
      <xe:group align="right">
        <xe:label value="${planned-date}" style="label-default"/>
        <xe:editdate label="${schedule-date}" label-width="8em" label-gap="0" width="13em" fixed-time="23:59:00" source="@target_date_end"/>
        <xe:deletebutton source="@target_date_end"/>
      </xe:group>
      <xe:selectcase source="@ismilestone" align="down">
        <xe:case value="1"/>
        <xe:defaultcase>
          <xe:group align="right">
            <xe:label value="" style="label-default"/>
            <xe:label value="" width="8em"/>
            <xe:label width="50" value="${year}"/>
            <xe:label width="50" value="${month}"/>
            <xe:label width="50" value="${day}"/>
            <xe:label width="50" value="${hour}"/>
            <xe:label width="50" value="${minute}"/>
          </xe:group>
          <xe:group align="right">
            <xe:label value="" style="label-default"/>
            <xe:label value="${duration}" width="8em"/>
            <xe:editfield width="50" source="@target_duration_year" data-type="INTEGER"/>
            <xe:editfield width="50" source="@target_duration_month" data-type="INTEGER"/>
            <xe:editfield width="50" source="@target_duration_day" data-type="INTEGER"/>
            <xe:editfield width="50" source="@target_duration_hour" data-type="INTEGER"/>
            <xe:editfield width="50" source="@target_duration_minute" data-type="INTEGER"/>
          </xe:group>
        </xe:defaultcase>
      </xe:selectcase>
      <xe:group align="right">
        <xe:label value="${expected-date}" style="label-default"/>
        <xe:editdate label="${schedule-date}" label-width="8em" label-gap="0" width="13em" fixed-time="23:59:00" source="@deadline_date_end"/>
        <xe:deletebutton source="@deadline_date_end"/>
      </xe:group>
      <xe:selectcase source="@ismilestone" align="down">
        <xe:case value="1"/>
        <xe:defaultcase>
          <xe:group align="right">
            <xe:label value="" style="label-default"/>
            <xe:label value="" width="8em"/>
            <xe:label width="50" value="${year}"/>
            <xe:label width="50" value="${month}"/>
            <xe:label width="50" value="${day}"/>
            <xe:label width="50" value="${hour}"/>
            <xe:label width="50" value="${minute}"/>
          </xe:group>
          <xe:group align="right">
            <xe:label value="" style="label-default"/>
            <xe:label value="${duration}" width="8em"/>
            <xe:editfield width="50" source="@deadline_duration_year" data-type="INTEGER"/>
            <xe:editfield width="50" source="@deadline_duration_month" data-type="INTEGER"/>
            <xe:editfield width="50" source="@deadline_duration_day" data-type="INTEGER"/>
            <xe:editfield width="50" source="@deadline_duration_hour" data-type="INTEGER"/>
            <xe:editfield width="50" source="@deadline_duration_minute" data-type="INTEGER"/>
          </xe:group>
        </xe:defaultcase>
      </xe:selectcase>
      <xe:group align="right">
        <xe:label value="${actual-date}" style="label-default"/>
        <xe:editdate label="${start}" label-width="8em" label-gap="0" width="13em" source="@actual_date_start"/>
        <xe:deletebutton source="@actual_date_start"/>
      </xe:group>
      <xe:group align="right">
        <xe:label value="" style="label-default"/>
        <xe:editdate label="${end}" label-width="8em" label-gap="0" width="13em" source="@actual_date_end"/>
        <xe:deletebutton source="@actual_date_end"/>
      </xe:group>
      <xe:label value="${workflow-mapping}"/>
      <xe:foreach new-caption="${new-workflow-mapping}" source="schedule_wf_map">
        <xe:group align="right">
          <xe:deletebutton/>
          <xe:popupmenu width="180" source="@wf_id">
            <xe:options label-key="@name" value-key="@id">
              <xe:generator name="filtered_cachedtables" table-name="workflow"/>
            </xe:options>
          </xe:popupmenu>
          <xe:popupmenu width="250" source="@wf_step">
            <xe:options label-key="@name" value-key="@wf_step">
              <xe:generator name="filtered_cachedtables" table-name="workflow_step" source="@wf_id" match-source="$current@wf_id"/>
              <xe:sort key="@sorting" data-type="integer"/>
            </xe:options>
            <xe:listen-to source="@wf_id" is-key-part="true">
              <xe:change dest="@wf_step" value="=cachelookup('workflow', '@id', '@wf_id')@def_step"/>
              <xe:change dest="@wf_target" value="=cachelookup('workflow_step', '@wf_id', '@wf_id', '@wf_step', '@wf_step')@def_party" allow-set-null="true"/>
            </xe:listen-to>
            <xe:listen-to source="@wf_step">
              <xe:change dest="@wf_target" value="=cachelookup('workflow_step', '@wf_id', '@wf_id', '@wf_step', '@wf_step')@def_party" allow-set-null="true"/>
            </xe:listen-to>
          </xe:popupmenu>
        </xe:group>
      </xe:foreach>
    </xe:group>
  </xe:part>

  <!-- translation dialog -->
  <xe:part id="dialog-translation" transactional="false">
    <xe:groupbox align="right">
      <xe:groupbox caption="${translation-styles}" align="down" align-y="top">
        <xe:foreach source="content.root.normstory" align="down" new-button="false">
          <xe:groupbox caption="${story}" align="down">
            <xe:foreach source="p" align="down" new-button="false">
              <xe:foreach source="c" align="down" new-button="false">
                <xe:group align="down">
                  <xe:group align="right">
                    <xe:label source="^@style" font-size="9"/>
                    <xe:label label="/" source="@style" font-size="9"/>
                    <xe:label label="/" source="@font-family" font-size="9"/>
                    <xe:label label="/" source="@font-size" font-size="9"/>
                  </xe:group>
                  <xe:edittext width="300" rows="5" source="text" readonly="=$param@readonly"/>
                  <xe:include key="dialog-translation-include"/>
                </xe:group>
              </xe:foreach>
            </xe:foreach>
            <xe:include key="dialog-translation-include"/>
          </xe:groupbox>
        </xe:foreach>
      </xe:groupbox>
      <xe:foreach source="original" new-button="false" align-y="top">
        <xe:groupbox caption="${difference}" align="down" align-y="top">
          <xe:textdiff source="^.version.plaintext" source-new="plaintext" width="300"/>
        </xe:groupbox>
        <xe:groupbox caption="${original}" align="down" align-y="top">
          <xe:foreach source="root.normstory" new-button="false" align="down">
            <xe:groupbox caption="${story}" align="down">
              <xe:foreach source="p" new-button="false" align="down">
                <xe:foreach source="c" align="down" new-button="false">
                  <xe:group align="down">
                    <xe:group align="right">
                      <xe:label label="" source="^@style" font-size="9"/>
                      <xe:label label="/" source="@style" font-size="9"/>
                      <xe:label label="/" source="@font-family" font-size="9"/>
                      <xe:label label="/" source="@font-size" font-size="9"/>
                    </xe:group>
                    <xe:edittext width="300" rows="5" source="text" readonly="true"/>
                  </xe:group>
                </xe:foreach>
              </xe:foreach>
            </xe:groupbox>
          </xe:foreach>
        </xe:groupbox>
      </xe:foreach>
    </xe:groupbox>
  </xe:part>

  <!-- translation table part -->
  <xe:part id="dialog-translation-include" transactional="false">
    <xe:foreach source="table" align="down" new-button="false">
      <xe:groupbox>
        <xe:foreach source="tr" new-button="false" align="down">
          <xe:groupbox>
            <xe:foreach source="td" new-button="false" align="right">
              <xe:foreach source="p" align="down" new-button="false">
                <xe:foreach source="c" align="down" new-button="false">
                  <xe:group align="down">
                    <xe:group align="right" width="300">
                      <xe:label source="^@style" font-size="9"/>
                      <xe:label label="/" source="@style" font-size="9"/>
                      <xe:label label="/" source="@font-family" font-size="9"/>
                      <xe:label label="/" source="@font-size" font-size="9"/>
                    </xe:group>
                    <xe:selectcase source="@style">
                      <xe:case value="Tabellen_Kasten">
                        <xe:popupmenu width="300" source="text" readonly="=$param@readonly">
                          <xe:options>
                            <xe:option label="${translation-standard}" value="s"/>
                            <xe:option label="${translation-optional}" value="o"/>
                            <xe:option label="${translation-not-available}" value="-"/>
                          </xe:options>
                        </xe:popupmenu>
                      </xe:case>
                      <xe:defaultcase>
                        <xe:edittext width="300" rows="5" source="text" readonly="=$param@readonly"/>
                      </xe:defaultcase>
                    </xe:selectcase>
                  </xe:group>
                </xe:foreach>
              </xe:foreach>
            </xe:foreach>
          </xe:groupbox>
        </xe:foreach>
      </xe:groupbox>
    </xe:foreach>
  </xe:part>

  <!-- javaclient only part definitions below this comment (no counterpart in webclient-dialogs-asset.xml) -->

  <!-- asset history dialog -->
  <xe:part id="dialog-asset-history" transactional="false">
    <xe:group align="down">
      <xe:editdate label="${search-period}" width="300" mode="qbe" source="time@search-time" title="${search-period}"/>
      <xe:separator/>
      <xe:filterwidget id="asset-history-table-filter" filter-directly="true" icons="false"/>
      <xe:xe-table id="asset-history-table" filter-widget="asset-history-table-filter" source="asset.log_history" minwidth="500" minheight="100" prefheight="200" weight-x="1" weight-y="3" double-click-action="table-double-click">
        <xe:columns>
          <xe:column key="date"           label="${date}" width="140" source="@timestamp" filterable="true" type="date" date-format="short" time-format="long"/>
          <xe:column key="version"        label="${version}" width="60" source="@version" filterable="true" align="right"/>
          <xe:column key="action"         label="${action}" width="200" source="@function_name" filterable="true"/>
          <xe:column key="description"    label="${information}" width="200" source="@function_description" filterable="true"/>
          <xe:column key="user"           label="${user}" width="200" filterable="true" formula=":if (log_history/@party='1') then '${system-user}' else cs:cachelookup('party', '@id', log_history/@party)/@display_name"/>
          <xe:column key="module"         label="${module}" width="140" formula="case(@module, 'Client5', '${censhare-web-client}', 'javaclient', '${censhare-client}', 'webclient', '${old-censhare-web-client}', 'javaadmin', '${censhare-admin-client}', 'javarender', '${censhare-render-client}', 'service-client', '${censhare-service-client}', @module)" filterable="true"/>
          <xe:column key="module-version" label="${module-version}" width="140" source="@module_version" filterable="true"/>
          <xe:column key="name"           label="${name}" source="@command-name" width="200" filterable="true"/>
          <xe:column key="command"        label="${command}" width="200" source="@description" filterable="true"/>
          <xe:column key="transaction"    label="${transaction}" width="200" source="@transaction_id" filterable="true"/>
        </xe:columns>
      </xe:xe-table>
    </xe:group>
  </xe:part>

  <!-- asset history detail dialog -->
  <xe:part id="assethistory-detail-dialog" transactional="false">
    <xe:group align="down">
      <xe:editfield label="${date}"           width="140" label-style="label-default"  readonly="true" source="@timestamp"/>
      <xe:editfield label="${version}"        width="60"  label-style="label-default"  readonly="true" source="@version"/>
      <xe:editfield label="${action}"         width="200" label-style="label-default"  readonly="true" source="@function_name"/>
      <xe:editfield label="${information}"    width="200" label-style="label-default"  readonly="true" source="@function_description"/>
      <xe:editfield label="${user}"           width="200" label-style="label-default"  readonly="true" value="=:if (log_history/@party='1') then '${system-user}' else cs:cachelookup('party', '@id', log_history/@party)/@display_name"/>
      <xe:editfield label="${module}"         width="140" label-style="label-default"  readonly="true" value="=case(@module, 'Client5', '${censhare-web-client}', 'javaclient', '${censhare-client}', 'webclient', '${old-censhare-web-client}', 'javaadmin', '${censhare-admin-client}', 'javarender', '${censhare-render-client}', 'service-client', '${censhare-service-client}', @module)"/>
      <xe:editfield label="${module-version}" width="140" label-style="label-default"  readonly="true" source="@module_version"/>
      <xe:editfield label="${name}"           width="200" label-style="label-default"  readonly="true" source="@command-name"/>
      <xe:editfield label="${command}"        width="200" label-style="label-default"  readonly="true" source="@description"/>
      <xe:editfield label="${transaction}"    width="200" label-style="label-default"  readonly="true" source="@transaction_id"/>
    </xe:group>
  </xe:part>

  <!-- asset check in new webcms dialog -->
  <xe:part id="dialog-asset-check-in-new-webcms" transactional="true">
    <xe:group>
      <xe:include key="dialog-asset-edit-webcms"/>
    </xe:group>
  </xe:part>

  <!-- asset check in new features dialog -->
  <xe:part id="dialog-asset-check-in-new-features" transactional="true">
    <xe:group>
      <xe:include key="dialog-asset-edit-features"/>
    </xe:group>
  </xe:part>

  <!-- asset check in new flags dialog -->
  <xe:part id="dialog-asset-check-in-new-flags" transactional="true">
    <xe:group>
      <xe:include key="dialog-asset-edit-flags"/>
    </xe:group>
  </xe:part>

  <!-- asset check in new webcms with keep open flag dialog -->
  <xe:part id="dialog-asset-check-in-new-keep-open-webcms" transactional="true">
    <xe:group align="down">
      <xe:checkbox label="${state}" label-style="label-default" caption="${keep-open}" source="@corpus:keep-open"/>
      <xe:include key="dialog-asset-edit-webcms"/>
    </xe:group>
  </xe:part>

  <!-- asset check in new features with keep open flag dialog -->
  <xe:part id="dialog-asset-check-in-new-keep-open-features" transactional="true">
    <xe:group align="down">
      <xe:checkbox label="${state}" label-style="label-default" caption="${keep-open}" source="@corpus:keep-open"/>
      <xe:include key="dialog-asset-edit-features"/>
    </xe:group>
  </xe:part>

  <!-- asset check in with keep open flag dialog -->
  <xe:part id="dialog-asset-check-in-new-keep-open-flags" transactional="true">
    <xe:group align="down">
      <xe:checkbox label="${state}" label-style="label-default" caption="${keep-open}" source="@corpus:keep-open"/>
      <xe:include key="dialog-asset-edit-flags"/>
    </xe:group>
  </xe:part>

  <!-- asset detail dialog -->
  <xe:part id="dialog-asset-detail" transactional="true">
    <xe:group>
      <xe:include key="asset-info-include"/>
      <!--xe:include key="dialog-asset-edit-include">
        <xe:param show_deadline_calculated="true"/>
      </xe:xe-include-->
    </xe:group>
  </xe:part>

  <!-- channels -->
  <xe:part id="dialog-output-features" transactional="false">
    <xe:group align="down">
      <xe:selectcase source="@multiple-values">
        <xe:case value="true">
          <xe:foreach source="channel" align="down" show-empty-row="true" new-button="false">
            <xe:identify-children-by key="@value_key"/>
            <xe:group align="right">
              <xe:popupmenutree source="@value_key" hide-root-popup="true">
                <xe:treeoptions label-key="@name" value-key="@value_key">
                  <xe:generator name="filtered_cachedtables" table-name="feature_value" source="@feature" match="censhare:output-channel"/>
                  <xe:sort key="@sorting" data-type="integer" ascending="true"/>
                  <xe:sort key="@name" data-type="string" ascending="true"/>
                </xe:treeoptions>
              </xe:popupmenutree>
              <xe:deletebutton source="$current"/>
            </xe:group>
          </xe:foreach>
        </xe:case>
        <xe:defaultcase>
          <xe:popupmenutree source="@value_key" hide-root-popup="true" defaultvalue="root.">
            <xe:treeoptions label-key="@name" value-key="@value_key">
              <xe:generator name="filtered_cachedtables" table-name="feature_value" source="@feature" match="censhare:output-channel"/>
              <xe:sort key="@sorting" data-type="integer" ascending="true"/>
              <xe:sort key="@name" data-type="string" ascending="true"/>
            </xe:treeoptions>
            <xe:validate not-null="true"/>
          </xe:popupmenutree>
        </xe:defaultcase>
      </xe:selectcase>
    </xe:group>
  </xe:part>

  <!-- asset edit address expert dialog -->
  <xe:part id="dialog-asset-edit-address-expert" transactional="true">
    <xe:selectcase source="@type">
      <xe:case value="person.">
        <!-- start person -->
        <xe:groupbox caption="${person}" font-weight="bold" align="down">
          <xe:editfield label="${asset-name}" label-style="label-default" width="200" source="@name" data-type="VARCHAR(256)">
            <xe:listen-to source="address@title">
              <xe:listen-to source="address@firstname">
                <xe:listen-to source="address@middlename">
                  <xe:listen-to source="address@lastname">
                    <xe:change dest="@name" value="=$$.address@title + if($$.address@lastname != null, if($$.address@title != null, ' ', '') + $$.address@lastname, '') + if($$.address@firstname != null, if($$.address@title != null or $$.address@lastname != null, ', ', '') + $$.address@firstname, '')" allow-set-null="true"/>
                  </xe:listen-to>
                </xe:listen-to>
              </xe:listen-to>
            </xe:listen-to>
          </xe:editfield>
          <xe:group align="right">
            <xe:groupbox caption="${information}" align="down" align-y="top">
              <xe:popupmenu label="${male-female}" label-style="label-default" width="200" source="address@gender">
                <xe:options>
                  <xe:option label="${male}" value="male"/>
                  <xe:option label="${female}" value="female"/>
                </xe:options>
              </xe:popupmenu>
              <xe:editfield label="${title}" label-style="label-default" width="200" source="address@title" data-type="VARCHAR(32)"/>
              <xe:editfield label="${first-name}" label-style="label-default" width="200" source="address@firstname" data-type="VARCHAR(64)"/>
              <xe:editfield label="${middle-name}" label-style="label-default" width="200" source="address@middlename" data-type="VARCHAR(64)"/>
              <xe:editfield label="${last-name}" label-style="label-default" width="200" source="address@lastname" data-type="VARCHAR(128)">
                <xe:validate not-empty="true"/>
              </xe:editfield>
              <xe:editfield label="${role}" label-style="label-default" width="200" source="address@role" data-type="VARCHAR(128)"/>
            </xe:groupbox>
            <xe:groupbox caption="${communication}" align="down" align-y="top">
              <xe:editfield label="${phone}" label-style="label-default" width="200" source="address@phone" data-type="VARCHAR(128)"/>
              <xe:editfield label="${private-phone}" label-style="label-default" width="200" source="address@phone_private" data-type="VARCHAR(128)"/>
              <xe:editfield label="${mobile-phone}" label-style="label-default" width="200" source="address@phone_mobile" data-type="VARCHAR(128)"/>
              <xe:editfield label="${fax}" label-style="label-default" width="200" source="address@phone_fax" data-type="VARCHAR(128)"/>
              <xe:editfield label="${e-mail}" label-style="label-default" width="200" source="address@email" data-type="VARCHAR(128)"/>
              <xe:editfield label="${private-e-mail}" label-style="label-default" width="200" source="address@email_private" data-type="VARCHAR(128)"/>
            </xe:groupbox>
          </xe:group>
          <xe:group align="right">
            <xe:groupbox caption="${private-address}" label-style="label-default" align="down" label-font-weight="bold" align-y="top">
              <xe:editfield label="${street}" label-style="label-default" width="200" source="address@street_private" data-type="VARCHAR(128)"/>
              <xe:editfield label="${region}" label-style="label-default" width="200" source="address@region_private" data-type="VARCHAR(32)"/>
              <xe:editfield label="${p-o-box}" label-style="label-default" width="200" source="address@po_box_private" data-type="VARCHAR(128)"/>
              <xe:group align="right">
                <xe:editfield label="${post-code-city}" label-style="label-default" width="56" source="address@zip_private" data-type="VARCHAR(16)"/>
                <xe:editfield width="120" source="address@city_private" data-type="VARCHAR(128)"/>
              </xe:group>
              <xe:popupmenu label="${country}" label-style="label-default" width="200" source="address@country_private">
                <xe:options label-key="@country" value-key="@countrycode" filter-duplicates="true">
                  <xe:generator name="cachedtables" table-name="java_locale"/>
                  <xe:filter source="@countrycode" operator="not-empty"/>
                  <xe:sort key="@country" ascending="true"/>
                </xe:options>
              </xe:popupmenu>
            </xe:groupbox>
            <xe:groupbox caption="${address}" label-style="label-default" align="down" label-font-weight="bold" align-y="top">
              <xe:editfield label="${street}" label-style="label-default" width="200" source="address@street" data-type="VARCHAR(128)"/>
              <xe:editfield label="${region}" label-style="label-default" width="200" source="address@region" data-type="VARCHAR(32)"/>
              <xe:editfield label="${p-o-box}" label-style="label-default" width="200" source="address@po_box" data-type="VARCHAR(128)"/>
              <xe:group align="right">
                <xe:editfield label="${post-code-city}" label-style="label-default" width="56" source="address@zip" data-type="VARCHAR(16)"/>
                <xe:editfield width="120" source="address@city" data-type="VARCHAR(128)"/>
              </xe:group>
              <xe:popupmenu label="${country}" label-style="label-default" width="200" source="address@country">
                <xe:options label-key="@country" value-key="@countrycode" filter-duplicates="true">
                  <xe:generator name="cachedtables" table-name="java_locale"/>
                  <xe:filter source="@countrycode" operator="not-empty"/>
                  <xe:sort key="@country" ascending="true"/>
                </xe:options>
              </xe:popupmenu>
            </xe:groupbox>
          </xe:group>
          <xe:edittext label="${annotation}" prefwidth="200" weight-x="1" rows="5" source="@annotation" label-align="top" data-type="VARCHAR(3500)"/>
        </xe:groupbox>
        <!-- end person -->
      </xe:case>
      <xe:case value="address.">
        <!-- start address -->
        <xe:groupbox caption="${address}" font-weight="bold" align="down">
          <xe:editfield label="${asset-name}" label-style="label-default" width="200" source="@name" data-type="VARCHAR(256)">
            <xe:listen-to source="address@organisation">
              <xe:change dest="@name" value="=$$.address@organisation" allow-set-null="true"/>
            </xe:listen-to>
          </xe:editfield>
          <xe:group align="right">
            <xe:groupbox caption="${address}" label-style="label-default" align="down" label-font-weight="bold" align-y="top">
              <xe:editfield label="${company}" label-style="label-default" width="200" source="address@organisation" data-type="VARCHAR(128)">
                <xe:validate not-empty="true"/>
              </xe:editfield>
              <xe:editfield label="${street}" label-style="label-default" width="200" source="address@street" data-type="VARCHAR(128)"/>
              <xe:editfield label="${region}" label-style="label-default" width="200" source="address@region" data-type="VARCHAR(32)"/>
              <xe:editfield label="${p-o-box}" label-style="label-default" width="200" source="address@po_box" data-type="VARCHAR(128)"/>
              <xe:group align="right">
                <xe:editfield label="${post-code-city}" label-style="label-default" width="56" source="address@zip" data-type="VARCHAR(16)"/>
                <xe:editfield width="120" source="address@city" data-type="VARCHAR(128)"/>
              </xe:group>
              <xe:popupmenu label="${country}" label-style="label-default" width="200" source="address@country">
                <xe:options label-key="@country" value-key="@countrycode" filter-duplicates="true">
                  <xe:generator name="cachedtables" table-name="java_locale"/>
                  <xe:filter source="@countrycode" operator="not-empty"/>
                  <xe:sort key="@country" ascending="true"/>
                </xe:options>
              </xe:popupmenu>
            </xe:groupbox>
            <xe:groupbox caption="${communication}" align="down" align-y="top">
              <xe:editfield label="${phone}" label-style="label-default" width="200" source="address@phone" data-type="VARCHAR(128)"/>
              <xe:editfield label="${fax}" label-style="label-default" width="200" source="address@phone_fax" data-type="VARCHAR(128)"/>
              <xe:editfield label="${e-mail}" label-style="label-default" width="200" source="address@email" data-type="VARCHAR(128)"/>
              <xe:editfield label="${homepage}" label-style="label-default" width="200" source="address@homepage" data-type="VARCHAR(128)"/>
              <xe:strut width="0" height="55"/>
            </xe:groupbox>
          </xe:group>
          <xe:edittext label="${annotation}" prefwidth="200" weight-x="1" rows="5" source="@annotation" label-align="top" data-type="VARCHAR(3500)"/>
          <xe:strut width="0" height="5"/>
          <!--xe:label label="${addresses}"/>
          <xe:xe-table source="child-assets.address-child-assets.asset" minwidth="500" minheight="100" prefheight="200" weight-x="1" weight-y="3" double-click-action="asset-checkout">
            <xe:columns>
              <xe:column label="${street}" source="address@street" width="150" sortable="true"/>
              <xe:column label="${region}" source="address@region" width="120" sortable="true"/>
              <xe:column label="${p-o-box}" source="address@po_box" width="140" sortable="true"/>
              <xe:column label="${post-code-city}" source="address@zip" width="140" sortable="true"/>
              <xe:column label="${country}" source="address@country" width="140" sortable="true"/>
            </xe:columns>
          </xe:xe-table-->
          <xe:label label="${persons}"/>
          <xe:xe-table source="child-assets.person-child-assets.asset" minwidth="500" minheight="100" prefheight="200" weight-x="1" weight-y="3" double-click-action="asset-checkout">
            <xe:columns>
              <xe:column key="last-name" label="${last-name}" source="address@lastname" width="150" sortable="true"/>
              <xe:column key="first-name" label="${first-name}" source="address@firstname" width="120" sortable="true"/>
              <xe:column key="phone" label="${phone}" source="address@phone" width="140" sortable="true"/>
              <xe:column key="mobile-phone" label="${mobile-phone}" source="address@phone_mobile" width="140" sortable="true"/>
              <xe:column key="fax" label="${fax}" source="address@phone_fax" width="140" sortable="true"/>
              <xe:column key="email" label="${e-mail}" source="address@email" width="160" sortable="true"/>
            </xe:columns>
          </xe:xe-table>
        </xe:groupbox>
        <!-- end address -->
      </xe:case>
    </xe:selectcase>
  </xe:part>

  <!-- asset edit schedule filter dialog -->
  <xe:part id="dialog-schedule-filter" transactional="false">
    <xe:group align="down">
      <xe:foreach new-caption="${new-schedule-type}" source="schedule_step">
        <xe:popupmenu label="${type}" label-style="label-default" width="200" source="@type">
          <xe:options label-key="@name" value-key="@type">
            <xe:generator name="cachedtables" table-name="schedule_step_typedef"/>
            <xe:sort key="@sorting" data-type="integer"/>
          </xe:options>
        </xe:popupmenu>
        <xe:deletebutton/>
      </xe:foreach>
    </xe:group>
  </xe:part>

  <!-- planning: edit asset element dialog -->
  <xe:part id="dialog-planning-add-asset-elements" transactional="true">
    <xe:param is-add-elements="true"/>
    <xe:group align="down">
      <xe:include key="dialog-planning-edit-asset-element"/>
    </xe:group>
  </xe:part>
  
  <!-- planning: edit asset element dialog -->
  <xe:part id="dialog-planning-edit-asset-element" transactional="true">
    <xe:param is-add-elements="false"/>
    <xe:group align="down">
      <!-- preview -->
      <xe:group visible="=:exists(cs:get-asset(asset_element[1]/@asset_id)/storage_item[@key='preview' or @key='text-preview'])" align="down">
        <xe:expandgroup caption="${preview}" id="preview" expanded="true" save-state="true">
          <xe:assetpreview height="200" width="30em" storagekey="thumbnail"/>
        </xe:expandgroup>
        <xe:separator/>
      </xe:group>
      <!--  number of new elements (when adding pages) -->
      <xe:group margin-left="10" margin-top="5" margin-bottom="5" enabled="=:$param/*/@is-add-elements = 'true'">
        <xe:editfield label="${number-of-pages-elements}" label-style="label-default" width="8em" source="$temp@number-of-elements"
            data-type="INTEGER" autofocus="true" defaultvalue="2">
          <xe:validate min-value="1" not-empty="true"/>
        </xe:editfield>      
      </xe:group>
      <!-- meta data -->
      <xe:expandgroup caption="${meta-data}" id="meta-data" expanded="true" save-state="true" readonly="=$param@readonly" align="down">
        <xe:group align="right">
          <xe:popupmenu label="${format}" label-style="label-default" width="30em" source="@asset_format">
            <xe:options label-key="@name" value-key="@id">
              <xe:generator name="filtered_cachedtables" table-name="asset_format"/>
            </xe:options>
            <xe:change dest="@width_mm" defaultvalue="0" value="=cachelookup('asset_format', '@id', '@asset_format')@paper_width_mm"/>
            <xe:change dest="@height_mm" defaultvalue="0" value="=cachelookup('asset_format', '@id', '@asset_format')@paper_height_mm"/>
          </xe:popupmenu>
          <xe:deletebutton source="@asset_format"/>
        </xe:group>
        <xe:editfield label="${name}" label-style="label-default" width="30em" source="@name" data-type="VARCHAR(256)"/>
        <xe:editfield label="${width-column}" label-style="label-default" width="30em" source="@width_col" data-type="NUMBER"/>
        <xe:group align="right">
          <xe:editfield label="${width}" label-style="label-default" width="10em" source="@width_mm" data-type="NUMBER">
            <xe:validate not-empty="true"/>
          </xe:editfield>
          <xe:label value="${mm}"/>
        </xe:group>
        <xe:group align="right">
          <xe:editfield label="${height}" label-style="label-default" width="10em" source="@height_mm" data-type="NUMBER">
            <xe:validate not-empty="true"/>
          </xe:editfield>
          <xe:label value="${mm}"/>
        </xe:group>
        <xe:group align="right">
          <xe:editfield label="${area-fraction}" label-style="label-default" width="10em" source="@page_percentage" data-type="NUMBER"/>
          <xe:label value="=:concat('%', for $format in asset_element/@asset_format return for $value in cs:master-data('asset_format')[@id=$format]/@page_percentage return concat(' (${format}:', cs:format-number($value, '0.0'), '%)'))">
            <xe:listen-to source="@asset_format"/>
          </xe:label>
        </xe:group>
        <xe:editfield label="${category}" label-style="label-default" width="30em" source="@category" data-type="VARCHAR(256)"/>
        <xe:group align="right">
          <xe:popupmenutree label="${domain}" label-style="label-default" source="@domain" hide-root-popup="false">
            <xe:treeoptions label-key="@name" value-key="@pathid">
              <xe:generator name="filtered_cachedtables" table-name="domain"/>
               <xe:sort key="@sorting" data-type="integer"/>
               <xe:sort key="@name${localized-attr-suffix}" data-type="string"/>
            </xe:treeoptions>
          </xe:popupmenutree>
          <xe:deletebutton source="@domain"/>
        </xe:group>
        <xe:group align="right" visible="=:count(cs:master-data('domain2')) gt 1">
          <xe:popupmenutree label="${domain2}" label-style="label-default" source="@domain2" hide-root-popup="false">
            <xe:treeoptions label-key="@name" value-key="@pathid">
              <xe:generator name="filtered_cachedtables" table-name="domain2"/>
               <xe:sort key="@sorting" data-type="integer"/>
               <xe:sort key="@name${localized-attr-suffix}" data-type="string"/>
            </xe:treeoptions>
          </xe:popupmenutree>
          <xe:deletebutton source="@domain2"/>
        </xe:group>
        <xe:group align="right">
          <xe:popupmenu label="${colour1}" label-style="label-default" width="30em" source="@color_id1">
            <xe:options label-key="@name" value-key="@id">
              <xe:generator name="cachedtables" table-name="color"/>
            </xe:options>
          </xe:popupmenu>
          <xe:deletebutton source="@color_id1"/>
        </xe:group>
        <xe:group align="right">
          <xe:popupmenu label="${colour2}" label-style="label-default" width="30em" source="@color_id2">
            <xe:options label-key="@name" value-key="@id">
              <xe:generator name="cachedtables" table-name="color"/>
            </xe:options>
          </xe:popupmenu>
          <xe:deletebutton source="@color_id2"/>
        </xe:group>
        <xe:group align="right">
          <xe:popupmenu label="${colour3}" label-style="label-default" width="30em" source="@color_id3">
            <xe:options label-key="@name" value-key="@id">
              <xe:generator name="cachedtables" table-name="color"/>
            </xe:options>
          </xe:popupmenu>
          <xe:deletebutton source="@color_id3"/>
        </xe:group>
        <xe:checkbox label="${locked}" label-style="label-default" caption="${geometry-locked}" width="30em" source="@is_geometry_locked" unchecked-value="0" checked-value="1"/>
        <xe:checkbox label="" label-style="label-default" caption="${sequence-locked}" width="30em" source="@is_sequence_locked" unchecked-value="0" checked-value="1"/>
        <xe:checkbox label="" label-style="label-default" caption="${delete-locked}" width="30em" source="@deletion" unchecked-value="0" checked-value="2"/>
        <xe:group align="right">
          <xe:popupmenutree label="${channel}" label-style="label-default" source="@output_channel" hide-root-popup="true">
            <xe:treeoptions label-key="@name" value-key="@value_key">
              <xe:generator name="filtered_cachedtables" table-name="feature_value" source="@feature" match="censhare:output-channel"/>
              <xe:sort key="@sorting" data-type="integer" ascending="true"/>
            </xe:treeoptions>
          </xe:popupmenutree>
          <xe:deletebutton source="@domain"/>
        </xe:group>
      </xe:expandgroup>
      <xe:separator/>
      <!-- features -->
      <xe:expandgroup caption="${features}" id="features" expanded="true" save-state="true" readonly="=$param@readonly" align="down">
        <xe:include key="dialog-asset-features-of-groups-include">
          <xe:param feature_group="censhare:asset-feature" feature_element_name="asset_element_feature"/>
        </xe:include>
      </xe:expandgroup>
    </xe:group>
  </xe:part>

  <!-- planning: edit asset element relation dialog -->
  <xe:part id="dialog-planning-edit-asset-element-relation" transactional="true">
    <xe:group align="down">
      <!-- meta data -->
      <xe:expandgroup caption="${meta-data}" id="meta-data" expanded="true" save-state="true" readonly="=$param@readonly" align="down">
        <xe:label label="${parent-asset-id}" label-style="label-default" weight-x="1" source="@parent_asset"/>
        <xe:label label="${child-asset-id}" label-style="label-default" weight-x="1" source="@child_asset"/>
        <xe:label label="${type}" label-style="label-default" value="=cachelookup('asset_rel_typedef', '@key', @key)@name">
          <xe:listen-to source="@key"/>
        </xe:label>
        <xe:selectcase source="@key" align="down">
          <xe:case value="target.">
            <xe:group align="right">
              <xe:editfield label="${x-offset}" label-style="label-default" width="10em" source="@xoffsmm"/>
              <xe:label value="${mm}"/>
            </xe:group>
            <xe:group align="right">
              <xe:editfield label="${y-offset}" label-style="label-default" width="10em" source="@yoffsmm"/>
              <xe:label value="${mm}"/>
            </xe:group>
            <xe:checkbox label="${delete-locked}" label-style="label-default" width="30em" unchecked-value="0" checked-value="2" source="@deletion"/>
            <xe:checkbox label="${cancellation}" label-style="label-default" width="30em" unchecked-value="0" checked-value="1" source="@iscancellation"/>
            <xe:checkbox label="${deletion}" label-style="label-default" caption="${delete-after-geometry-update}" unchecked-value="0" checked-value="1" source="@delete_after_geo_update"/>
            <xe:popupmenutree label="${domain}" label-style="label-default" source="@domain" hide-root-popup="false">
              <xe:treeoptions label-key="@name" value-key="@pathid">
                <xe:generator name="filtered_cachedtables" table-name="domain"/>
                 <xe:sort key="@sorting" data-type="integer"/>
                 <xe:sort key="@name${localized-attr-suffix}" data-type="string"/>
              </xe:treeoptions>
            </xe:popupmenutree>
            <xe:popupmenutree label="${domain2}" label-style="label-default" source="@domain2" hide-root-popup="false" visible="=:count(cs:master-data('domain2')) gt 1">
              <xe:treeoptions label-key="@name" value-key="@pathid">
                <xe:generator name="filtered_cachedtables" table-name="domain2"/>
                 <xe:sort key="@sorting" data-type="integer"/>
                 <xe:sort key="@name${localized-attr-suffix}" data-type="string"/>
              </xe:treeoptions>
            </xe:popupmenutree>
            <xe:edittext label="${annotation}" label-align="left-top" label-style="label-default" prefwidth="30em" maxwidth="600" weight-x="1" scrollpane="false" rows="1" weight-y="1" source="@annotation" data-type="VARCHAR(3500)"/>
            <xe:checkbox label="${locked}" label-style="label-default" caption="${move-locked}" width="30em" source="@islocked" unchecked-value="0" checked-value="1"/>
            <xe:popupmenu label="${priority}" label-style="label-default" width="30em" source="@priority">
              <xe:options>
                <xe:option label="${none}" value="0"/>
                <xe:option label="${possible}" value="1"/>
                <xe:option label="${mandatory}" value="2"/>
              </xe:options>
            </xe:popupmenu>
            <xe:popupmenu label="${even-odd}" label-style="label-default" width="30em" source="@pos_side">
              <xe:options>
                <xe:option label="${none}" value="0"/>
                <xe:option label="${left}" value="1"/>
                <xe:option label="${right}" value="2"/>
              </xe:options>
            </xe:popupmenu>
            <xe:popupmenu label="${horizontal}" label-style="label-default" width="30em" source="@pos_horizontal">
              <xe:options>
                <xe:option label="${none}" value=""/>
                <xe:option label="${inside}" value="0.0"/>
                <xe:option label="${centered}" value="0.5"/>
                <xe:option label="${outside}" value="1.0"/>
              </xe:options>
            </xe:popupmenu>
            <xe:popupmenu label="${vertical}" label-style="label-default" width="30em" source="@pos_vertical">
              <xe:options>
                <xe:option label="${none}" value=""/>
                <xe:option label="${top}" value="0.0"/>
                <xe:option label="${centered}" value="0.5"/>
                <xe:option label="${bottom}" value="1.0"/>
              </xe:options>
            </xe:popupmenu>
            <xe:group align="right">
              <xe:popupmenutree label="${channel}" label-style="label-default" source="@output_channel" hide-root-popup="true">
                <xe:treeoptions label-key="@name" value-key="@value_key">
                  <xe:generator name="filtered_cachedtables" table-name="feature_value" source="@feature" match="censhare:output-channel"/>
                  <xe:sort key="@sorting" data-type="integer" ascending="true"/>
                </xe:treeoptions>
              </xe:popupmenutree>
              <xe:deletebutton source="@domain"/>
            </xe:group>
          </xe:case>
        </xe:selectcase>
      </xe:expandgroup>
      <xe:separator/>
      <!-- features -->
      <xe:expandgroup caption="${features}" id="features" expanded="true" save-state="true" readonly="=$param@readonly" align="down">
        <xe:include key="dialog-asset-features-of-groups-include">
          <xe:param feature_group="censhare:asset-feature" feature_element_name="asset_element_rel_feature"/>
        </xe:include>
      </xe:expandgroup>
    </xe:group>
  </xe:part>

  <!-- asset problem dialog -->
  <xe:part id="dialog-asset-problem" transactional="false">
    <xe:group align="down">
      <xe:strut height="2em"/>
      <xe:label value="${problem-text}"/>
      <xe:strut height="2em"/>
      <xe:edittext prefwidth="200" weight-x="1" weight-y="1" source="problems.message"/>
      <xe:strut height="2em"/>
      <xe:label value="${problem-continue}"/>
      <xe:strut height="2em"/>
    </xe:group>
  </xe:part>

  <!-- user/groups: new group dialog -->
  <xe:part id="dialog-user-admin-new-group" transactional="false">
    <xe:inititems>
      <xe:inititem dest="@isgroup" value="1"/>
      <xe:inititem dest="@isactive" value="1"/>
      <xe:inititem dest="@main_domain" value="root."/>
      <xe:inititem dest="@main_domain2" value="root."/>
    </xe:inititems>
    <xe:group align="down">
      <!-- The name field's only purpose seems to ensure that the not nullable databasefield party.name has some value?
           Hence the value of display_name is copied and the field is not displayed -->
      <xe:editfield label="${name}" label-style="label-default" width="200" source="@name" visible="false">
        <xe:listen-to source="@display_name">
          <xe:change dest="@name" overwrite="true" value="=@display_name"/>
        </xe:listen-to>
      </xe:editfield>
      <xe:editfield label="${display-name}" label-style="label-default" width="200" source="@display_name">
        <xe:validate not-empty="true"/>
      </xe:editfield>
      <xe:popupmenutree label="${default-domain}" label-style="label-default" source="@main_domain" hide-root-popup="false">
        <xe:treeoptions label-key="@name${localized-attr-suffix}" value-key="@pathid">
          <xe:generator name="cachedtables" table-name="domain"/>
           <xe:sort key="@sorting" data-type="integer"/>
           <xe:sort key="@name${localized-attr-suffix}" data-type="string"/>
        </xe:treeoptions>
        <xe:validate not-null="true"/>
      </xe:popupmenutree>
      <xe:popupmenutree label="${default-domain2}" label-style="label-default" source="@main_domain2" hide-root-popup="false">
        <xe:treeoptions label-key="@name${localized-attr-suffix}" value-key="@pathid">
          <xe:generator name="cachedtables" table-name="domain2"/>
           <xe:sort key="@sorting" data-type="integer"/>
           <xe:sort key="@name${localized-attr-suffix}" data-type="string"/>
        </xe:treeoptions>
        <xe:validate not-null="true"/>
      </xe:popupmenutree>
    </xe:group>
  </xe:part>

  <!-- asset edit info dialog -->
  <xe:part id="dialog-asset-edit-info" transactional="false">
    <xe:groupbox caption="${annotation}" font-weight="bold" align="down">
      <xe:edittext width="400" source="@annotation" data-type="VARCHAR(3500)"/>
    </xe:groupbox>
  </xe:part>

  <!-- asset edit stored filter dialog -->
  <xe:part id="dialog-edit-filter" transactional="true">
    <xe:group align="down">
      <xe:expandgroup caption="${filter}" id="filter" expanded="true" save-state="true" align="down">
        <xe:editfield label="${name}" label-style="label-default" width="30em" source="@name" data-type="VARCHAR(256)">
          <xe:validate not-empty="true"/>
        </xe:editfield>
        <xe:group align="right">
          <xe:popupmenu label="${party}" label-style="label-default" width="30em" source="@party_id" sort="ascending">
            <xe:options label-key="@display_name" value-key="@id" null-entry="true">
              <xe:generator name="filtered_cachedtables" table-name="party"/>
            </xe:options>
          </xe:popupmenu>
          <xe:deletebutton source="@party_id"/>
        </xe:group>
        <xe:group align="right">
          <xe:popupmenu label="${role}" label-style="label-default" width="30em" source="@role" sort="ascending">
            <xe:options label-key="@name" value-key="@role" null-entry="true">
              <xe:generator name="cachedtables" table-name="role"/>
            </xe:options>
          </xe:popupmenu>
          <xe:deletebutton source="@role"/>
        </xe:group>
        <xe:popupmenutree label="${domain}" label-style="label-default" source="@domain" hide-root-popup="false">
          <xe:treeoptions label-key="@name${localized-attr-suffix}" value-key="@pathid">
            <xe:generator name="filtered_cachedtables" table-name="domain"/>
            <xe:sort key="@sorting" data-type="integer"/>
            <xe:sort key="@name${localized-attr-suffix}" data-type="string"/>
          </xe:treeoptions>
        </xe:popupmenutree>
        <xe:popupmenutree label="${domain2}" label-style="label-default" source="@domain2" hide-root-popup="false" visible="=:count(cs:master-data('domain2')) gt 1">
          <xe:treeoptions label-key="@name${localized-attr-suffix}" value-key="@pathid">
            <xe:generator name="filtered_cachedtables" table-name="domain2"/>
            <xe:sort key="@sorting" data-type="integer"/>
            <xe:sort key="@name${localized-attr-suffix}" data-type="string"/>
          </xe:treeoptions>
        </xe:popupmenutree>
      </xe:expandgroup>
      <xe:expandgroup caption="${shortcut}" id="shortcut" expanded="true" save-state="true" align="down">
        <xe:editfield label="Windows" label-style="label-default" width="30em" source="@shortcut_win" tooltip="${shortcut-tooltip-win}"/>
        <xe:editfield label="Macintosh" label-style="label-default" width="30em" source="@shortcut_mac" tooltip="${shortcut-tooltip-mac}"/>
      </xe:expandgroup>
    </xe:group>
  </xe:part>

  <!-- quick view: notes input dialog -->
  <xe:part id="quick-view-input" transactional="false">
    <xe:group align="down">
      <xe:foreach source="element" align="down" readonly="true" new-button="false">
        <xe:group align="down">
          <xe:label source="@display"/>
          <xe:edittext weight-x="1.0" source="@content" rows="5"/>
        </xe:group>
      </xe:foreach>
      <xe:group align="down" visible="=$temp@attachfield">
        <xe:listen-to source="$temp@attachfield"/>
        <xe:label source="@display"/>
        <xe:edittext id="attachfield" weight-x="1.0" source="@content" rows="5"/>
      </xe:group>
    </xe:group>
  </xe:part>

  <!-- asset info for info dock dialog -->
  <xe:part id="query-preview-info" transactional="false">
    <xe:group align="down" weight-y="1.0">
      <xe:include key="asset-info-include"/>
    </xe:group>
  </xe:part>
  
  <!-- asset info for comparison view -->
  <xe:part id="comparison-view-info" transactional="false" scrollpane="false">
    <xe:group align="down" weight-y="1.0">
      <xe:include key="asset-comparison-view-include"/>
    </xe:group>
  </xe:part>

  <!-- asset admin info -->
  <xe:part id="admin-info" transactional="false">
    <xe:group align="down" weight-y="1.0">
      <xe:html weight-x="1.0" weight-y="1.0" prefwidth="200" margin="0" css-key="asset-info" expression-id="asset-admin-info"/>
    </xe:group>
  </xe:part>

  <!-- asset preview scale -->
  <xe:part id="asset-preview-scale" transactional="false" scrollpane="false">
    <xe:group align="down">
      <xe:popupmenu source="$temp@scale" defaultvalue="1.0">
        <xe:options>
          <xe:option label="25%" value="0.25"/>
          <xe:option label="50%" value="0.5"/>
          <xe:option label="75%" value="0.75"/>
          <xe:option label="100%" value="1.0"/>
          <xe:option label="125%" value="1.25"/>
          <xe:option label="150%" value="1.5"/>
          <xe:option label="${zoom-to-fit}" value="fit"/>
        </xe:options>
      </xe:popupmenu>
      <xe:scrollpane weight-x="1.0" weight-y="1.0" align="down">
        <xe:group>
          <xe:listen-to source="$temp@scale"/>
          <xe:html weight-x="1.0" weight-y="1.0" prefwidth="200" css-key="asset-info" expression-id="asset-preview" include-size-in-control-slot="true"/>
        </xe:group>
      </xe:scrollpane>
    </xe:group>
  </xe:part>

  <!-- asset preview/info -->
  <xe:part id="preview-info" transactional="false" scrollpane="false">
    <xe:group align="down" weight-y="1.0">
      <xe:expandgroup caption="${preview}" id="preview" expanded="true" save-state="true">
        <xe:assetpreview weight-x="1" height="175" storagekey="thumbnail"/>
      </xe:expandgroup>
      <xe:separator/>
      <xe:expandgroup caption="${info}" id="info" expanded="true" save-state="true">
        <xe:scrollpane weight-x="1.0" weight-y="1.0" align="down">
          <xe:html weight-x="1.0" weight-y="1.0" prefwidth="200" css-key="asset-info" expression-id="asset-info"/>
        </xe:scrollpane>
      </xe:expandgroup>
    </xe:group>
  </xe:part>

  <!-- asset preview/info/map -->
  <xe:part id="preview-info-map" transactional="false" scrollpane="false">
    <xe:group align="down" weight-y="1.0">
      <!-- header -->
      <xe:group align="right" margin="6" margin-bottom="4">
        <xe:include key="asset-header-include"/>
      </xe:group>
      <xe:separator/>
      <!-- preview, info, relations -->
        <!-- preview -->
        <xe:group visible="=:count(asset) = 1 and exists(asset/storage_item[@key='preview' or @key='text-preview'])" align="down">
          <xe:expandgroup caption="${preview}" id="preview" expanded="true" save-state="true">
            <!--xe:html weight-x="1.0" prefwidth="200" height="175" css-key="asset-info" expression-id="asset-preview" include-size-in-control-slot="true"/-->
            <xe:assetpreview weight-x="1" height="175" storagekey="thumbnail"/>
          </xe:expandgroup>
          <xe:separator/>
        </xe:group>
        <xe:scrollpane weight-x="1.0" weight-y="1.0" align="down">
        <!-- general -->
        <xe:expandgroup caption="${general}" id="general" expanded="true" save-state="true">
          <xe:html weight-x="1.0" prefwidth="200" css-key="asset-info" expression-id="asset-general-info"/>
        </xe:expandgroup>
        <xe:separator/>
        <!-- budget and costs infos -->
        <xe:expandgroup caption="${budget-and-costs}" id="costs" expanded="false" save-state="true">
          <xe:html weight-x="1.0" prefwidth="200" css-key="asset-info" expression-id="asset-budget-and-costs-info"/>
        </xe:expandgroup>
        <xe:separator/>
        <!-- more infos -->
        <xe:expandgroup caption="${more-information}" id="specifications" expanded="false" save-state="true">
          <xe:html weight-x="1.0" prefwidth="200" css-key="asset-info" expression-id="asset-more-info"/>
        </xe:expandgroup>
        <xe:separator/>
        <!-- files -->
        <xe:expandgroup caption="${files}" id="files" expanded="false" save-state="true">
          <xe:include key="file-drag-dialog"/>
        </xe:expandgroup>
        <!--xe:separator/-->
        <!-- test for relations (only show, if one asset with parent or child relations) -->
        <!--xe:expandgroup caption="${relations}" id="relations" expanded="false" save-state="true">
          <xe:group margin-left="10">
            <xe:selectcase value="=true">
              <xe:case value="=:count(asset) = 1 and (asset/parent_asset_rel or asset/child_asset_rel)">
                <xe:variable name="headerColor" value="=:if (system-property('censhare:laf-background') = 'dark') then '#dfdfdf' else '#202020'"/>
                <xe:variable name="relationElements" value="=:doc(concat('censhare:///service/assets/asset/id/', asset/@id, '/transform;key=censhare:asset-relation'))/asset-relations/asset-relation"/>
                <xe:foreach align="down">
                  <xe:generator expression="=:$relationElements"/>
                  <xe:group align="down">
                    <xe:group align="right">
                      <xe:label font-size="9" color="=:$headerColor" value="=:concat(asset-relation/@name, ' (', count(asset-relation/asset), ')')" margin-top="4" margin-bottom="2"/>
                    </xe:group>
                    <xe:foreach align="down">
                      <xe:generator expression="=:asset-relation/asset"/>
                      <xe:image url="=:concat($system/system/@censhare-url-prefix, 'assets/asset/id/', asset/@id, '/icon/background/', system-property('censhare:laf-background'), '/file')"/>
                      <xe:label value="=:asset/@name"/>
                      <xe:uiaction action="asset-show-in-same-tab" asset-selection-expression="=@id" icon="view" align-y="top"/>
                    </xe:foreach>
                  </xe:group>
                </xe:foreach>
              </xe:case>
            </xe:selectcase>
          </xe:group>
        </xe:expandgroup>
        <xe:separator/-->
        <!-- test for actions -->
        <!--xe:expandgroup caption="${actions}" id="actions" expanded="false" save-state="true">
          <xe:group margin-left="10" align="down" visible="=:exists(asset)">
            <xe:uiaction action="server-action" key="social_network.youtube.youtube-post-20111125-1632-0" asset-selection-expression="=@id" icon="share" caption="Publish on YouTube" align-y="top"/>
            <xe:uiaction action="server-action" key="social_network.facebook.facebook-post-20111124-2004-0" asset-selection-expression="=@id" icon="share" caption="Publish on Facebook" align-y="top"/>
            <xe:uiaction action="asset-show-in-same-tab" asset-selection-expression="=@id" icon="view" caption="Show in same tab" align-y="top"/>
          </xe:group>
        </xe:expandgroup-->
      </xe:scrollpane>
      <!--xe:separator/-->
      <!-- map - disabled because of stability problems with Java 8 on Macintosh Platforms -->
      <!--xe:expandgroup caption="${map}" id="map" expanded="false" save-state="true">
        <xe:map readonly="true" map-control="small" zoom-level="10" map-type="road" margin-right="5px" margin-bottom="5px" weight-x="1" height="175"
          value="=:for $x in asset/asset_feature[@feature='censhare:geo-coord'] return (xs:double($x/@value_double), xs:double($x/@value_double2), xs:string($x/../@name))"/>
      </xe:expandgroup-->
    </xe:group>
  </xe:part>
  
  <!-- file drag dialog -->
  <xe:part id="file-drag-dialog" transactional="false" scrollpane="false">
    <xe:group margin-left="10">
      <xe:selectcase value="=true">
        <xe:case value="=:count(asset)=1">
          <xe:include expression="=:doc(concat('censhare:///service/assets/asset/id/', asset[1]/@id, '/transform;key=censhare:file-drag-dialog-part'))"/>
        </xe:case>
      </xe:selectcase>
     </xe:group>
  </xe:part>

  <!-- pdf file preview -->
  <xe:part id="pdf-file-preview" transactional="false" scrollpane="false">
    <xe:group align="down" visible="=:count(asset)=1">
      <xe:group>
        <xe:strut width="1em"/>
        <xe:image url="=:concat($system/system/@censhare-url-prefix, 'assets/asset/id/', asset/@id, '/icon/file')"/>
        <xe:label value="=:asset/@name"/>
        <xe:strut width="2em"/>
        <xe:variable name="pdf_storage_keys" value="=:distinct-values(asset/storage_item[@mimetype='application/pdf']/@key)"/>
        <xe:popupmenu label="${storage-key}" source="$temp@storage_item_key" select-first="true" sort="ascending" enabled="=:boolean(asset)">
          <xe:options label-key="@key" value-key="@key" option-label-expression="=:cs:cachelookup('storage_keydef', '@key', storage_item/@key)/@name">
            <xe:generator expression="=:for $x in $pdf_storage_keys return asset/storage_item[@mimetype='application/pdf' and @key=$x][1]"/>
          </xe:options>
          <xe:change dest="$temp@storage_item_page" value="1"/>
        </xe:popupmenu>
        <xe:group visible="=:count(asset/storage_item[@key=$temp/temp/@storage_item_key and @mimetype='application/pdf']) gt 1">
          <xe:label value="${page}"/>
          <xe:button icon="previous" enabled="=:xs:integer($temp/temp/@storage_item_page) gt 0" tooltip="Previous page">
            <xe:listen-to source="$temp@storage_item_key"/>
            <xe:listen-to source="$temp@storage_item_page"/>
            <xe:change dest="$temp@storage_item_page" value="=:max((xs:integer($temp/temp/@storage_item_page) - 1, 1))"/>
          </xe:button>
          <xe:label value="=:concat($temp/temp/@storage_item_page, ' ${of-(lowercase)} ', count(asset/storage_item[@key=$temp/temp/@storage_item_key and @mimetype='application/pdf']))">
            <xe:listen-to source="$temp@storage_item_page"/>
          </xe:label>
          <xe:button icon="next" enabled="=:xs:integer($temp/temp/@storage_item_page) lt count(asset/storage_item[@key=$temp/temp/@storage_item_key and @mimetype='application/pdf'])" tooltip="Previous page">
            <xe:listen-to source="$temp@storage_item_key"/>
            <xe:listen-to source="$temp@storage_item_page"/>
            <xe:change dest="$temp@storage_item_page" value="=:min((xs:integer($temp/temp/@storage_item_page) + 1, count(asset/storage_item[@key=$temp/temp/@storage_item_key and @mimetype='application/pdf'])))"/>
          </xe:button>
        </xe:group>
      </xe:group>
      <xe:label visible="false" value="=:concat($system/system/@censhare-url-prefix, 'assets/asset/id/', asset/@id, if ($temp/temp/@storage_item_key='master') then concat('/storage/master/file/', tokenize(asset/storage_item[@key='master'][1]/@relpath,'/')[last()]) else concat('/element/actual/page/', xs:integer($temp/temp/@storage_item_page) - 1, '/storage/', $temp/temp/@storage_item_key, '/file/page-', $temp/temp/@storage_item_page, '.pdf'))">
        <xe:listen-to source="@id"/>
        <xe:listen-to source="$temp@storage_item_key"/>
        <xe:listen-to source="$temp@storage_item_page"/>
      </xe:label>
      <xe:webbrowser weight-x="1.0" weight-y="1.0" prefwidth="1" prefheight="1" margin="0" enabled="=:boolean(asset)" url="=:concat($system/system/@censhare-url-prefix, 'assets/asset/id/', asset/@id, if (not(exists(asset/storage_item[@key=$temp/temp/@storage_item_key and element_idx gt 0]))) then concat('/storage/', $temp/temp/@storage_item_key , '/file/', tokenize(asset/storage_item[@key='master'][1]/@relpath,'/')[last()], '.pdf') else concat('/element/actual/page/', xs:integer($temp/temp/@storage_item_page) - 1, '/storage/', $temp/temp/@storage_item_key, '/file/page-', $temp/temp/@storage_item_page, '.pdf'))">
        <xe:listen-to source="@id"/>
        <xe:listen-to source="$temp@storage_item_key"/>
        <xe:listen-to source="$temp@storage_item_page"/>
      </xe:webbrowser>
    </xe:group>
  </xe:part>

  <!-- asset-version-changes -->
  <xe:part id="asset-version-changes" transactional="false">
    <xe:group align="down">
      <xe:html weight-x="1.0" weight-y="1.0" prefwidth="200" margin="0" css-key="asset-info" expression-id="asset-version-changes"/>
    </xe:group>
  </xe:part>

  <!-- html-widget-test -->
  <xe:part id="html-widget-test" transactional="false">
    <xe:group align="down">
      <xe:html weight-x="1.0" weight-y="1.0" prefwidth="200" margin="0" css-key="asset-info" url="=:concat($system/system/@censhare-url-prefix, 'assets/asset/id/', asset/@id, '/transform;key=transform:test-parameter;format=html;mode=html-widget;date=', current-date(), '_', current-time())"/>
    </xe:group>
  </xe:part>

  <!-- window-asset-info -->
  <xe:part id="window-asset-info" transactional="false" scrollpane="false">
    <xe:group align="down">
      <xe:group>
        <xe:strut width="6"/>
        <!--xe:image url="=:concat($system/system/@censhare-url-prefix, 'assets/asset/id/', asset/@id, '/icon/file')" enabled="=:boolean(asset)"/>
        <xe:label value="=:asset/@name"/>
        <xe:strut width="2em"/-->
        <xe:popupmenu label="${type}" source="$temp@report-key" select-first="true" sort="ascending" visible="=:count(cs:master-data('resource_asset')[xmldata/usages/usage[@value='censhare:preview']]) gt 1">
          <xe:options value-key="@key" label-key="@name">
            <xe:generator name="cachedtables" table-name="resource_asset"/>
            <xe:filter condition="=:exists(resource_asset/xmldata/usages/usage[@value='censhare:preview'])"/>
          </xe:options>
        </xe:popupmenu>
        <xe:variable name="mainContentAssets" value="=:for $x in asset/child_asset_rel[@key='user.main-content.'] return cs:get-asset($x/@child_asset)"/>
        <xe:variable name="mainContentVariantAssets" value="=:for $x in $mainContentAssets/child_asset_rel[@key=('variant.', 'variant.0.', 'variant.1.')] return cs:get-asset($x/@child_asset)"/>
        <xe:variable name="languageKeys" value="=:distinct-values(($mainContentAssets/@language, $mainContentVariantAssets/@language))"/>
        <xe:variable name="languages" value="=:for $x in $languageKeys return cs:master-data('language_def')[@id=$x]"/>
        <xe:popupmenu label="${language}" source="$temp@language" visible="=:count($languageKeys) gt 0" sort="ascending" select-first="true">
          <xe:options value-key="@id" label-key="@name">
            <xe:generator expression="=:$languages"/>
          </xe:options>
        </xe:popupmenu>
        <xe:popupmenu label="${device}" source="$temp@device" defaultvalue="none" visible="=:count(cs:master-data('resource_asset')[xmldata/usages/usage[@value='censhare:device-display-frame']]) gt 0" sort="ascending">
          <xe:options value-key="@key" label-key="@name">
            <xe:generator name="cachedtables" table-name="resource_asset"/>
            <xe:filter condition="=:exists(resource_asset/xmldata/usages/usage[@value='censhare:device-display-frame'])"/>
            <xe:option label="${none}" value="none"/>
          </xe:options>
        </xe:popupmenu>
        <xe:popupmenu label="${scale}" source="$temp@scale" defaultvalue="1.0" visible="=:$temp/temp/@device != 'none'">
          <xe:listen-to source="$temp@device"/>
          <xe:options value-key="@key" label-key="@name">
            <xe:option label="50%" value="0.5"/>
            <xe:option label="75%" value="0.75"/>
            <xe:option label="100%" value="1.0"/>
          </xe:options>
        </xe:popupmenu>
        <xe:strut weight-x="1"/>
        <xe:uiaction action="refresh"/>
      </xe:group>
      <xe:webbrowser weight-x="1.0" weight-y="1.0" prefwidth="1" prefheight="1" margin="0" enabled="=:exists(asset)" url="=:concat($system/system/@browser-url-prefix, 'assets/asset/id/', asset/@id, '/version/', asset/@version, '/transform;key=', $temp/temp/@report-key, ';format=html;language=', $temp/temp/@language, ';device=', $temp/temp/@device, ';scale=', $temp/temp/@scale)">
        <xe:listen-to source="$temp@report-key"/>
        <xe:listen-to source="$temp@language"/>
        <xe:listen-to source="$temp@device"/>
        <xe:listen-to source="$temp@scale"/>
      </xe:webbrowser>
    </xe:group>
  </xe:part>

  <!-- xslfo-pdf-preview -->
  <xe:part id="xslfo-pdf-preview" transactional="false" scrollpane="false">
    <xe:group align="down">
      <xe:group>
        <xe:strut width="6"/>
        <xe:popupmenu label="${type}" source="$temp@report-key" select-first="true" sort="ascending" visible="=:count(cs:master-data('resource_asset')[xmldata/usages/usage[@value='censhare:xsl-fo-pdf-preview']]) gt 1">
          <xe:options value-key="@key" label-key="@name">
            <xe:generator name="cachedtables" table-name="resource_asset"/>
            <xe:filter condition="=:exists(resource_asset/xmldata/usages/usage[@value='censhare:xsl-fo-pdf-preview'])"/>
          </xe:options>
        </xe:popupmenu>
        <xe:variable name="mainContentAssets" value="=:for $x in asset/child_asset_rel[@key='user.main-content.'] return cs:get-asset($x/@child_asset)"/>
        <xe:variable name="mainContentVariantAssets" value="=:for $x in $mainContentAssets/child_asset_rel[@key=('variant.', 'variant.0.', 'variant.1.')] return cs:get-asset($x/@child_asset)"/>
        <xe:variable name="languageKeys" value="=:distinct-values(($mainContentAssets/@language, $mainContentVariantAssets/@language))"/>
        <xe:variable name="languages" value="=:for $x in $languageKeys return cs:master-data('language_def')[@id=$x]"/>
        <xe:popupmenu label="${language}" source="$temp@language" visible="=:count($languageKeys) gt 0" sort="ascending" select-first="true">
          <xe:options value-key="@id" label-key="@name">
            <xe:generator expression="=:$languages"/>
          </xe:options>
        </xe:popupmenu>
        <xe:strut weight-x="1"/>
        <xe:uiaction action="refresh"/>
      </xe:group>
      <xe:webbrowser weight-x="1.0" weight-y="1.0" prefwidth="1" prefheight="1" margin="0" enabled="=:exists(asset)" url="=:concat($system/system/@browser-url-prefix, 'assets/asset/id/', asset/@id, '/version/', asset/@version, '/transform;key=', $temp/temp/@report-key, ';language=', $temp/temp/@language)">
        <xe:listen-to source="$temp@report-key"/>
        <xe:listen-to source="$temp@language"/>
      </xe:webbrowser>
    </xe:group>
  </xe:part>

  <!-- planning-statistics -->
  <xe:part id="planning-statistics" transactional="false" scrollpane="false">
    <xe:group align="down" weight-y="1.0">
      <xe:html weight-x="1.0" weight-y="1.0" prefwidth="200" margin="0" css-key="asset-info" expression-id="planning-statistics"/>
    </xe:group>
  </xe:part>

  <!-- print-preview -->
  <xe:part id="print-preview" transactional="false" scrollpane="false">
    <xe:group align="down">
      <xe:group>
        <xe:strut width="6"/>
        <!-- display layouts in a popup menu -->
        <!-- - given asset is placed -->
        <!-- - child assets of given asset are placed via article placement (child_collection_id in parent_element_rel is given asset) -->
        <!-- - given asset id is placed as content in content in another content asset that is placed in a layout -->
        <!-- - template layouts -->
        <xe:variable name="asset" value="=:asset[1]"/>
        <xe:variable name="assets" value="=:(doc(concat('censhare:///service/assets/asset/id/', $asset/@id, '/transform;key=censhare:search-layout-for-print-preview'))/assets//asset)"/>
        <xe:popupmenu label="${template}" source="$temp@layout_id" sort="ascending">
          <xe:options value-key="@id" label-key="@name">
            <xe:generator expression="=:$assets"/>
          </xe:options>
        </xe:popupmenu>
        <xe:variable name="isTemplateLayout" value="=:exists(cs:get-asset($temp/temp/@layout_id)/asset_feature[@feature=&apos;censhare:resource-usage&apos; and @value_key=&apos;censhare:print-preview-template&apos;])">
          <xe:listen-to source="$temp@layout_id"/>
        </xe:variable>
        <xe:uiaction visible="=:$isTemplateLayout" asset-selection-expression="=:($temp/temp/@layout_id, asset/@id)" caption="${create-new-layout-from-preview}" action="server-action" key="renderer.create-layout-from-print-preview">
          <xe:listen-to source="$temp@layout_id"/>
        </xe:uiaction>
        <xe:strut weight-x="1"/>
        <xe:uiaction action="refresh"/>
      </xe:group>
      <xe:label visible="false" value="=:concat('censhare:///service/assets/asset/id/', $temp/temp/@layout_id, '/transform;key=censhare:create-pdf-of-article-with-indesign-server;format=pdf;placeAssetID=', asset/@id, ';placeAssetVersion=', asset/@version, ';time=', current-dateTime(),'.pdf')">
        <xe:listen-to source="$temp@layout_id"/>
      </xe:label>
      <!-- version displaying PDF document with the standard PDF Plug-In of the web browser (works not on 64 bit Windows platforms) -->
      <!-- win64-pdf-warning: a warning text when running on Windows with Java 64-bit (no PDF plugin in browser) -->
      <xe:webbrowser win64-pdf-warning="true" weight-x="1.0" weight-y="1.0" prefwidth="1" prefheight="1" margin="0" enabled="=:boolean(asset)" url="=:if ($temp/temp/@layout_id) then concat('censhare:///service/assets/asset/id/', $temp/temp/@layout_id, '/transform;key=censhare:create-pdf-of-article-with-indesign-server;format=pdf;placeAssetID=', asset/@id, ';placeAssetVersion=', asset/@version, ';time=', current-dateTime(),'.pdf') else ''">
        <xe:listen-to source="$temp@layout_id"/>
      </xe:webbrowser>
      <!-- version displaying PDF document with PDF.js (works also on 64 bit Windows platforms) -->
      <!--xe:variable name="browserUrlPrefix" value="=:system-property('censhare:browser-url-prefix')"/>
      <xe:webbrowser weight-x="1.0" weight-y="1.0" prefwidth="1" prefheight="1" margin="0" url="=:concat($browserUrlPrefix, 'assets/asset;censhare:resource-key=censhare:pdf.js/storage/master/file;container=zip/web/viewer.html?file=', if ($temp/temp/@layout_id) then encode-for-uri(concat($browserUrlPrefix, 'assets/asset/id/', $temp/temp/@layout_id, '/transform;key=censhare:create-pdf-of-article-with-indesign-server;format=pdf;placeAssetID=', asset/@id, ';placeAssetVersion=', asset/@version, ';time=', current-dateTime(),'.pdf')) else '')">
        <xe:listen-to source="$temp@layout_id"/>
      </xe:webbrowser-->
    </xe:group>
  </xe:part>

  <!-- report -->
  <xe:part id="report" transactional="false" scrollpane="false">
    <xe:group align="down" visible="=:count(asset)=1">
      <xe:group>
        <xe:strut width="1em"/>
        <xe:image url="=:concat($system/system/@censhare-url-prefix, 'assets/asset/id/', asset/@id, '/icon/file')"/>
        <xe:label value="=:asset/@name"/>
        <xe:strut width="2em"/>
        <xe:popupmenu label="${report}" source="$temp@report-key" select-first="true" sort="ascending">
          <xe:options value-key="@key" label-key="@name">
            <xe:generator name="cachedtables" table-name="resource_asset"/>
            <xe:filter condition="=:exists(resource_asset/xmldata/usages/usage[@value='censhare:report-transformation'])"/>
          </xe:options>
        </xe:popupmenu>
      </xe:group>
      <xe:webbrowser weight-x="1.0" weight-y="1.0" prefwidth="1" prefheight="1" margin="0" enabled="=:boolean(asset)" url="=:concat($system/system/@browser-url-prefix, 'assets/asset/id/', asset/@id, '/transform;key=', $temp/temp/@report-key, ';format=html')">
        <xe:listen-to source="$temp@report-key"/>
      </xe:webbrowser>
    </xe:group>
  </xe:part>

  <!-- print-preview-catalog -->
  <xe:part id="print-preview-catalog" transactional="false" scrollpane="false">
    <xe:group>
      <xe:selectcase value="=true">
        <!-- no asset selected while xmleditor.init -->
        <xe:case value="=:empty(asset)">
          <xe:label style="label-info" value="${no-asset-selected}"/>
        </xe:case>
        <xe:defaultcase>
          <xe:group align="down">
              <xe:variable name="used_regions" value="=:distinct-values(//asset_element_feature[@feature='censhare:print-region']/@value_string)"/> 
              <xe:popupmenu label="${region}" source="$temp@region" visible="=:exists($used_regions)" width="30em" select-first="true">
                <xe:options label-key="@name" value-key="@pathid">
                  <xe:generator name="cachedtables" table-name="print_region"/>
                  <xe:filter condition="=:print_region/@pathid=($used_regions)"/>
                </xe:options>
              </xe:popupmenu>
            <xe:webbrowser weight-x="1.0" weight-y="1.0" prefwidth="1" prefheight="1" margin="0" url="=:concat($system/system/@browser-url-prefix, 'assets/asset/id/', asset/@id, '/transform;key=transform:print-preview-catalog;format=html;region=', $temp/temp/@region)">
              <xe:listen-to source="$temp@region"/>
            </xe:webbrowser>
          </xe:group>
        </xe:defaultcase>
      </xe:selectcase>
    </xe:group>
  </xe:part>

  <!-- marmind -->
  <xe:part id="marmind" transactional="false" scrollpane="false">
    <xe:group align="down">
      <xe:webbrowser weight-x="1.0" weight-y="1.0" prefwidth="1" prefheight="1" margin="0" url="http://www.marmind.com"/>
    </xe:group>
  </xe:part>

  <!-- user info -->
  <xe:part id="user-info" scrollpane="false" transactional="false">
    <xe:group align="right" margin="6">
      <xe:image width="54" height="54" url="=:concat($system/system/@censhare-url-prefix, 'assets/asset/id/', $system/system/party/@party_asset_id, '/storage/thumbnail/file')" visible="=:boolean($system/system/party/@party_asset_id)"/>
      <xe:group align="down" margin-left="20" align-y="top">
        <xe:label font-weight="bold" font-size="16" value="=:$system/system/party/@display_name"/>
      </xe:group>
    </xe:group>
  </xe:part>

  <!-- my tasks list -->
  <xe:part id="my-tasks-list" transactional="false">
    <xe:group align="down">
      <xe:scrollpane weight-x="1.0" weight-y="1.0" align="down" track-viewport-width="true">
        <xe:variable name="myTasks" value="=:cs:asset()[@censhare:function.my-tasks='1']/cs:order-by()[@censhare:asset.deadline_actual, @censhare:asset.name]"/>
        <!-- exceeded deadline -->
        <xe:variable name="exceededDeadlines" value="=:$myTasks[xs:dateTime(@deadline_actual)&lt;current-dateTime()]"/>
        <xe:group align="down" visible="=:exists($exceededDeadlines)">
          <xe:listen-to source="$temp@last-refresh"/>
          <xe:label style="label-title" margin-top="0" value="${exceeded-deadline}" weight-x="1"/>
          <xe:foreach max-occurs="50" align="down">
            <xe:listen-to source="$temp@last-refresh"/>
            <xe:generator expression="=:$exceededDeadlines"/>
            <xe:sort key="@deadline_actual" data-type="string"/>
            <xe:group align="down">
              <xe:group align="right">
                <xe:assetref weight-x="1.0" height="48" source="@id" css-key="asset-info" expression-id="asset-ref-list-deadline"/>
                <xe:uiaction action="window-asset-info" asset-selection-expression="=@id" align-y="top"/>
                <xe:uiaction action="asset-editattributes" asset-selection-expression="=@id" align-y="top"/>
                <xe:uiaction action="asset-checkout-edit-icon" asset-selection-expression="=@id" align-y="top"/>
              </xe:group>
            </xe:group>
          </xe:foreach>
          <xe:strut height="10"/>
        </xe:group>
        <!-- deadline today -->
        <xe:variable name="todayDeadlines" value="=:$myTasks[xs:dateTime(@deadline_actual) > current-dateTime() and xs:dateTime(@deadline_actual) &lt; xs:dateTime(current-date()+xs:duration('P1D'))]"/>
        <xe:group align="down" visible="=:exists($todayDeadlines)">
          <xe:listen-to source="$temp@last-refresh"/>
          <xe:label style="label-title" margin-top="0" value="${deadline-today}" weight-x="1"/>
          <xe:foreach max-occurs="50" align="down">
            <xe:listen-to source="$temp@last-refresh"/>
            <xe:generator expression="=:$todayDeadlines"/>
            <xe:sort key="@deadline_actual" data-type="string"/>
            <xe:group align="down">
              <xe:group align="right">
                <xe:assetref weight-x="1.0" height="48" source="@id" css-key="asset-info" expression-id="asset-ref-list-deadline"/>
                <xe:uiaction action="window-asset-info" asset-selection-expression="=@id" align-y="top"/>
                <xe:uiaction action="asset-editattributes" asset-selection-expression="=@id" align-y="top"/>
                <xe:uiaction action="asset-checkout-edit-icon" asset-selection-expression="=@id" align-y="top"/>
              </xe:group>
            </xe:group>
          </xe:foreach>
          <xe:strut height="10"/>
        </xe:group>
        <!-- deadline tomorrow -->
        <xe:variable name="tomorrowDeadlines" value="=:$myTasks[xs:dateTime(@deadline_actual) > current-dateTime()+xs:duration('P1D') and xs:dateTime(@deadline_actual) &lt; xs:dateTime(current-date()+xs:duration('P2D'))]"/>
        <xe:group align="down" visible="=:exists($tomorrowDeadlines)">
          <xe:listen-to source="$temp@last-refresh"/>
          <xe:label style="label-title" margin-top="0" value="${deadline-tomorrow}" weight-x="1"/>
          <xe:foreach max-occurs="50" align="down">
            <xe:listen-to source="$temp@last-refresh"/>
            <xe:generator expression="=:$tomorrowDeadlines"/>
            <xe:sort key="@deadline_actual" data-type="string"/>
            <xe:group align="down">
              <xe:group align="right">
                <xe:assetref weight-x="1.0" height="48" source="@id" css-key="asset-info" expression-id="asset-ref-list-deadline"/>
                <xe:uiaction action="window-asset-info" asset-selection-expression="=@id" align-y="top"/>
                <xe:uiaction action="asset-editattributes" asset-selection-expression="=@id" align-y="top"/>
                <xe:uiaction action="asset-checkout-edit-icon" asset-selection-expression="=@id" align-y="top"/>
              </xe:group>
            </xe:group>
          </xe:foreach>
          <xe:strut height="10"/>
        </xe:group>
        <!-- deadline tomorrow and later -->
        <xe:variable name="laterDeadlines" value="=:$myTasks[xs:dateTime(@deadline_actual) > xs:dateTime(current-date()+xs:duration('P2D'))]"/>
        <xe:group align="down" visible="=:exists($laterDeadlines)">
          <xe:listen-to source="$temp@last-refresh"/>
          <xe:label style="label-title" margin-top="0" value="${later-deadline}" weight-x="1"/>
          <xe:foreach max-occurs="50" align="down">
            <xe:listen-to source="$temp@last-refresh"/>
            <xe:generator expression="=:$laterDeadlines"/>
            <xe:sort key="@deadline_actual" data-type="string"/>
            <xe:group align="down">
              <xe:group align="right">
                <xe:assetref weight-x="1.0" height="48" source="@id" css-key="asset-info" expression-id="asset-ref-list-deadline"/>
                <xe:uiaction action="window-asset-info" asset-selection-expression="=@id" align-y="top"/>
                <xe:uiaction action="asset-editattributes" asset-selection-expression="=@id" align-y="top"/>
                <xe:uiaction action="asset-checkout-edit-icon" asset-selection-expression="=@id" align-y="top"/>
              </xe:group>
            </xe:group>
          </xe:foreach>
          <xe:strut height="10"/>
        </xe:group>
        <!-- without deadline -->
        <xe:variable name="withoutDeadlines" value="=:$myTasks[not(@deadline_actual)]"/>
        <xe:group align="down" visible="=:boolean($withoutDeadlines)">
          <xe:listen-to source="$temp@last-refresh"/>
          <xe:label style="label-title" margin-top="0" value="${without-deadline}" weight-x="1"/>
          <xe:foreach max-occurs="50" align="down">
            <xe:listen-to source="$temp@last-refresh"/>
            <xe:generator expression="=:$withoutDeadlines"/>
            <xe:sort key="@name" data-type="string"/>
            <xe:group align="down">
              <xe:group align="right">
                <xe:assetref weight-x="1.0" height="48" source="@id" css-key="asset-info" expression-id="asset-ref-list-deadline"/>
                <xe:uiaction action="window-asset-info" asset-selection-expression="=@id" align-y="top"/>
                <xe:uiaction action="asset-editattributes" asset-selection-expression="=@id" align-y="top"/>
                <xe:uiaction action="asset-checkout-edit-icon" asset-selection-expression="=@id" align-y="top"/>
              </xe:group>
            </xe:group>
          </xe:foreach>
          <xe:strut height="10"/>
        </xe:group>
      </xe:scrollpane>
      <xe:button caption="${refresh}" tooltip="${refresh}">
        <xe:change dest="$temp@last-refresh" value="=:current-dateTime()"/>
      </xe:button>
    </xe:group>
  </xe:part>

  <!-- my documents list -->
  <xe:part id="my-documents-list" transactional="false">
    <xe:group>
      <xe:scrollpane weight-x="1.0" weight-y="1.0" align="down" track-viewport-width="true">
        <xe:foreach max-occurs="50" align="down">
          <!-- search for assets changed by me in the last 30 days, sorted by modification date -->
          <xe:generator expression="=:cs:asset()[@censhare:asset.modified_by=$system/system/party/@id and @censhare:asset.modified_date > current-dateTime() - xs:dayTimeDuration('P30D')]/cs:order-by()[-@censhare:asset.modified_date]"/>
          <xe:group align="down">
            <xe:group align="right">
              <xe:assetref weight-x="1.0" height="40" source="@id" css-key="asset-info" expression-id="asset-ref-list"/>
              <xe:uiaction action="window-asset-info" asset-selection-expression="=@id" align-y="top"/>
              <xe:uiaction action="asset-editattributes" asset-selection-expression="=@id" align-y="top"/>
              <xe:uiaction action="asset-checkout-edit-icon" asset-selection-expression="=@id" align-y="top"/>
            </xe:group>
          </xe:group>
        </xe:foreach>
      </xe:scrollpane>
    </xe:group>
  </xe:part>

  <!-- my state list -->
  <xe:part id="my-state-list" transactional="false">
    <xe:group>
      <xe:scrollpane weight-x="1.0" weight-y="1.0" align="down" track-viewport-width="true">
        <xe:foreach max-occurs="50" align="down">
          <!-- search for all issues changed in the last 30 days, sorted by modification date -->
          <xe:generator expression="=:cs:asset()[@censhare:asset.type='issue.' and @censhare:asset.modified_date > current-dateTime() - xs:dayTimeDuration('P30D')]/cs:order-by()[-@censhare:asset.modified_date]"/>
          <!-- search for all observed issues, sorted by name -->
          <!--xe:generator expression="=:cs:asset()[@censhare:asset.type='issue.' and @censhare:user-flag='censhare:observed']/cs:order-by()[-@censhare:asset.name]"/-->
          <xe:group align="down">
            <xe:group align="right">
              <xe:assetref weight-x="1.0" height="160" source="@id" css-key="asset-info" expression-id="asset-ref-list-state"/>
              <xe:uiaction action="window-asset-info" asset-selection-expression="=@id" align-y="top"/>
              <xe:uiaction action="asset-editattributes" asset-selection-expression="=@id" align-y="top"/>
              <xe:uiaction action="asset-checkout-edit-icon" asset-selection-expression="=@id" align-y="top"/>
            </xe:group>
          </xe:group>
        </xe:foreach>
      </xe:scrollpane>
    </xe:group>
  </xe:part>

  <!-- birthday list -->
  <xe:part id="birthday-list" transactional="false">
    <xe:group>
      <xe:scrollpane weight-x="1.0" weight-y="1.0" align="down" track-viewport-width="true">
        <xe:foreach max-occurs="50" align="down">
          <!-- search for birthday of the next month -->
          <xe:generator expression="=:cs:asset()[@censhare:address.birthday-month-day > xs:gMonthDay(concat('--', month-from-date(current-date()), '-', day-from-date(current-date()))) and @censhare:address.birthday-month-day&lt;xs:gMonthDay(concat('--', month-from-date(current-date()), '-', day-from-date(current-date())))+xs:duration('P1M')]/cs:order-by()[@censhare:address.birthday-month-day]"/>
          <xe:group align="down">
            <xe:group align="right">
              <xe:assetref weight-x="1.0" height="40" source="@id" css-key="asset-info" expression-id="asset-ref-list-birthday"/>
              <xe:uiaction action="window-asset-info" asset-selection-expression="=@id" align-y="top"/>
              <xe:uiaction action="asset-editattributes" asset-selection-expression="=@id" align-y="top"/>
              <xe:uiaction action="asset-checkout-edit-icon" asset-selection-expression="=@id" align-y="top"/>
            </xe:group>
          </xe:group>
        </xe:foreach>
      </xe:scrollpane>
    </xe:group>
  </xe:part>

  <!-- basket list -->
  <xe:part id="basket-list" transactional="false">
    <xe:group>
      <xe:scrollpane weight-x="1.0" weight-y="1.0" align="down" track-viewport-width="true">
        <xe:foreach max-occurs="50" align="down">
          <xe:generator expression="=:cs:asset()[@censhare:asset.type='order.shoppingbasket.' and @censhare:owner=xs:integer($system/system/party/@id)]/cs:child-rel()[@key='user.']"/>
          <xe:sort key="@name" data-type="string"/>
          <xe:listen-to source="$temp@last-refresh"/>
          <xe:group align="down">
            <xe:group align="right">
              <xe:assetref weight-x="1.0" height="40" source="@id" css-key="asset-info" expression-id="asset-ref-list"/>
              <xe:uiaction action="server-action" key="basket.remove-from-basket" asset-selection-expression="=@id" align-y="top">
                <!--xe:change dest="$temp@last-refresh" value="=:current-dateTime()"/-->
              </xe:uiaction>
              <xe:uiaction action="window-asset-info" asset-selection-expression="=@id" align-y="top"/>
              <xe:uiaction action="asset-editattributes" asset-selection-expression="=@id" align-y="top"/>
              <xe:uiaction action="asset-checkout-edit-icon" asset-selection-expression="=@id" align-y="top"/>
            </xe:group>
          </xe:group>
        </xe:foreach>
      </xe:scrollpane>
    </xe:group>
  </xe:part>

  <!-- wish-list list -->
  <xe:part id="wish-list-list" transactional="false">
    <xe:group>
      <xe:scrollpane weight-x="1.0" weight-y="1.0" align="down" track-viewport-width="true">
        <xe:foreach max-occurs="50" align="down">
          <xe:generator expression="=:cs:asset()[@censhare:asset.type='order.wish-list.' and @censhare:owner=xs:integer($system/system/party/@id)]/cs:child-rel()[@key='user.']"/>
          <xe:sort key="@name" data-type="string"/>
          <xe:group align="down">
            <xe:group align="right">
              <xe:assetref weight-x="1.0" height="40" source="@id" css-key="asset-info" expression-id="asset-ref-list"/>
              <xe:uiaction action="server-action" key="basket.remove-from-wish-list" asset-selection-expression="=@id" align-y="top"/>
              <xe:uiaction action="window-asset-info" asset-selection-expression="=@id" align-y="top"/>
              <xe:uiaction action="asset-editattributes" asset-selection-expression="=@id" align-y="top"/>
              <xe:uiaction action="asset-checkout-edit-icon" asset-selection-expression="=@id" align-y="top"/>
            </xe:group>
          </xe:group>
        </xe:foreach>
      </xe:scrollpane>
    </xe:group>
  </xe:part>

  <!-- basket and wish list -->
  <xe:part id="basket-and-wish-list" transactional="false">
    <xe:group align="down">
      <xe:scrollpane weight-x="1.0" weight-y="1.0" align="down" track-viewport-width="true">
        <xe:variable name="basketAssets" value="=:cs:asset()[@censhare:asset.type='order.shoppingbasket.' and @censhare:owner=xs:integer($system/system/party/@id)]/cs:child-rel()[@key='user.']"/>
        <xe:label style="label-title" margin-top="0" value="${basket}" weight-x="1"/>
        <xe:group align="right">
          <xe:label value="=:if (count($basketAssets) > 1) then concat(count($basketAssets), ' ${assets}') else if (count($basketAssets) = 1) then '1 ${asset}' else '${no-assets}'"/>
          <xe:strut weight-x="1.0"/>
          <xe:uiaction action="server-action" key="basket.export-basket" asset-selection-expression="=@id" align-y="top"/>
          <xe:uiaction action="server-action" key="basket.email-basket" asset-selection-expression="=@id" align-y="top"/>
        </xe:group>
        <xe:separator/>
        <xe:foreach max-occurs="50" align="down">
          <xe:generator expression="=:$basketAssets"/>
          <xe:sort key="@name" data-type="string"/>
          <xe:listen-to source="$temp@last-refresh"/>
          <xe:group align="down">
            <xe:group align="right">
              <xe:assetref weight-x="1.0" height="40" source="@id" css-key="asset-info" expression-id="asset-ref-list"/>
              <xe:uiaction action="window-asset-info" asset-selection-expression="=@id" align-y="top"/>
              <xe:uiaction action="server-action" key="basket.remove-from-basket" asset-selection-expression="=@id" align-y="top">
                <!--xe:change dest="$temp@last-refresh" value="=:current-dateTime()"/-->
              </xe:uiaction>
              <xe:uiaction action="server-action" key="basket.move-to-wish-list" asset-selection-expression="=@id" align-y="top">
                <!--xe:change dest="$temp@last-refresh" value="=:current-dateTime()"/-->
              </xe:uiaction>
            </xe:group>
          </xe:group>
        </xe:foreach>
        <xe:strut height="10"/>
        <xe:variable name="wishListAssets" value="=:cs:asset()[@censhare:asset.type='order.wish-list.' and @censhare:owner=xs:integer($system/system/party/@id)]/cs:child-rel()[@key='user.']"/>
        <xe:label style="label-title" margin-top="0" value="${wish-list}" weight-x="1"/>
        <xe:label value="=:if (count($wishListAssets) > 1) then concat(count($wishListAssets), ' ${assets}') else if (count($wishListAssets) = 1) then '1 ${asset}' else '${no-assets}'"/>
        <xe:separator/>
        <xe:foreach max-occurs="50" align="down">
          <xe:generator expression="=:$wishListAssets"/>
          <xe:sort key="@name" data-type="string"/>
          <xe:listen-to source="$temp@last-refresh"/>
          <xe:group align="down">
            <xe:group align="right">
              <xe:assetref weight-x="1.0" height="40" source="@id" css-key="asset-info" expression-id="asset-ref-list"/>
              <xe:uiaction action="window-asset-info" asset-selection-expression="=@id" align-y="top"/>
              <xe:uiaction action="server-action" key="basket.remove-from-wish-list" asset-selection-expression="=@id" align-y="top">
                <!--xe:change dest="$temp@last-refresh" value="=:current-dateTime()"/-->
              </xe:uiaction>
              <xe:uiaction action="server-action" key="basket.move-to-basket" asset-selection-expression="=@id" align-y="top">
                <!--xe:change dest="$temp@last-refresh" value="=:current-dateTime()"/-->
              </xe:uiaction>
            </xe:group>
          </xe:group>
        </xe:foreach>
      </xe:scrollpane>
      <xe:button caption="${refresh}" tooltip="${refresh}">
        <xe:change dest="$temp@last-refresh" value="=:current-dateTime()"/>
      </xe:button>
    </xe:group>
  </xe:part>

  <!-- translation: edit dialog -->
  <xe:part id="translation-list-edit-window" transactional="true">
    <xe:inititems>
      <xe:inititem dest="@domain" value="root."/>
      <xe:inititem dest="@domain2" value="root."/>
    </xe:inititems>
    <xe:group align="down">
      <xe:group align="down">
        <xe:strut height="10"/>
        <xe:editfield label="${id}" label-style="label-default" width="250" source="@segment_id" data-type="INTEGER" readonly="true" enabled="=$translationeditoptions@display_id"> </xe:editfield>
        <xe:edittext label="${content}" label-style="label-default" prefwidth="250" maxwidth="600" weight-y="1" weight-x="1" source="@segment" data-type="VARCHAR(3500)">
          <xe:validate not-empty="true"/>
        </xe:edittext>
        <xe:popupmenu label="${language}" label-style="label-default" width="250" source="@locale" sort="ascending">
          <xe:options label-key="@name" value-key="@tm_locale">
            <xe:generator name="filtered_cachedtables" table-name="language_def"/>
          </xe:options>
          <xe:validate not-empty="true"/>
        </xe:popupmenu>
        <xe:edittext label="${description}" label-style="label-default" prefwidth="250" maxwidth="600" weight-x="1" source="@description" data-type="VARCHAR(256)"/>
        <xe:popupmenutree label="${domain}" label-style="label-default" source="@domain" hide-root-popup="false">
          <xe:treeoptions label-key="@name" value-key="@pathid">
            <xe:generator name="cachedtables" table-name="domain"/>
             <xe:sort key="@sorting" data-type="integer"/>
             <xe:sort key="@name${localized-attr-suffix}" data-type="string"/>
          </xe:treeoptions>
          <xe:validate not-empty="true"/>
        </xe:popupmenutree>
        <xe:popupmenutree label="${domain2}" label-style="label-default" source="@domain2" hide-root-popup="false" visible="=:count(cs:master-data('domain2')) gt 1">
          <xe:treeoptions label-key="@name" value-key="@pathid">
            <xe:generator name="cachedtables" table-name="domain2"/>
             <xe:sort key="@sorting" data-type="integer"/>
             <xe:sort key="@name${localized-attr-suffix}" data-type="string"/>
          </xe:treeoptions>
          <xe:validate not-empty="true"/>
        </xe:popupmenutree>
        <xe:editfield label="${external-id}" label-style="label-default" width="250" source="@id_extern"/>
        <xe:strut height="10"/>
        <xe:separator/>
        <xe:strut height="10"/>
        <xe:editdate label="${modified-at}" width="250" label-style="label-default" source="@modified_date" readonly="true"/>
        <xe:editfield label="${modified-by}" width="250" label-style="label-default" readonly="true" value="=cachelookup('party', '@id', @modified_by)@display_name">
          <xe:listen-to source="@modified_by"/>
        </xe:editfield>
        <xe:strut height="10"/>
      </xe:group>
    </xe:group>
  </xe:part>

  <!-- translation: new edit/create dialog -->
  <xe:part id="dialog-edit-translationmemory-entry" transactional="true">
    <xe:inititems>
      <xe:inititem dest="@domain" value="root."/>
      <xe:inititem dest="@domain2" value="root."/>
    </xe:inititems>
    <xe:group align="down">
      <xe:group align="down">
        <xe:include key="dialog-edit-translationmemory-top_part"/>
        <xe:popupmenu label="${language}" label-style="label-default" width="250" source="@locale" readonly="=@addnew==null" sort="ascending">
          <xe:options source="$locales.locale" value-key="@key" label-key="@description"/>
          <xe:validate not-empty="true"/>
        </xe:popupmenu>
        <xe:include key="dialog-edit-translationmemory_general_part"/>
      </xe:group>
    </xe:group>
  </xe:part>

  <!-- terminology: new edit/create dialog -->
  <xe:part id="dialog-edit-terminologymemory-entry" transactional="true">
    <xe:inititems>
      <xe:inititem dest="@domain" value="root."/>
      <xe:inititem dest="@domain2" value="root."/>
    </xe:inititems>
    <xe:group align="down">
      <xe:group align="down">
        <xe:include key="dialog-edit-terminilogymemory-top_part"/>
        <xe:popupmenu label="${language}" label-style="label-default" width="250" source="@locale" readonly="=@addnew==null" sort="ascending">
          <xe:options source="$locales.locale" value-key="@key" label-key="@description"/>
          <xe:validate not-empty="true"/>
        </xe:popupmenu>
        <xe:include key="dialog-edit-translationmemory_general_part"/>
      </xe:group>
    </xe:group>
  </xe:part>

  <!-- translation memory: edit dialog -->
  <xe:part id="dialog-edit-translationmemory_general_part" transactional="true">
    <xe:group align="down">
      <xe:edittext label="${description}" label-style="label-default" prefwidth="250" maxwidth="600" weight-x="1" source="@description" data-type="VARCHAR(256)"/>
      <xe:popupmenutree label="${domain}" label-style="label-default" source="@domain" hide-root-popup="false">
        <xe:treeoptions label-key="@name" value-key="@pathid">
          <xe:generator name="cachedtables" table-name="domain"/>
           <xe:sort key="@sorting" data-type="integer"/>
           <xe:sort key="@name${localized-attr-suffix}" data-type="string"/>
        </xe:treeoptions>
        <xe:validate not-empty="true"/>
      </xe:popupmenutree>
      <xe:popupmenutree label="${domain2}" label-style="label-default" source="@domain2" hide-root-popup="false" visible="=:count(cs:master-data('domain2')) gt 1">
        <xe:treeoptions label-key="@name" value-key="@pathid">
          <xe:generator name="cachedtables" table-name="domain2"/>
           <xe:sort key="@sorting" data-type="integer"/>
           <xe:sort key="@name${localized-attr-suffix}" data-type="string"/>
        </xe:treeoptions>
        <xe:validate not-empty="true"/>
      </xe:popupmenutree>
      <xe:editfield label="${external-id}" label-style="label-default" width="250" source="@id_extern"/>
      <xe:group align="down" enabled="=@addnew==null">
        <xe:strut height="10"/>
        <xe:separator/>
        <xe:strut height="10"/>
        <xe:editdate label="${modified-at}" width="250" label-style="label-default" source="@modified_date" readonly="true"/>
        <xe:editfield label="${modified-by}" width="250" label-style="label-default" readonly="true" value="=cachelookup('party', '@id', @modified_by)@display_name">
          <xe:listen-to source="@modified_by"/>
        </xe:editfield>
        <xe:strut height="10"/>
      </xe:group>
    </xe:group>
  </xe:part>

  <!-- terminology memory: edit dialog -->
  <xe:part id="dialog-edit-terminilogymemory-top_part" transactional="true">
    <xe:group align="down">
      <xe:strut height="10"/>
      <xe:editfield label="${id}" label-style="label-default" width="250" source="@term_id" data-type="INTEGER" readonly="true" enabled="=@term_id!=null"> </xe:editfield>
       <xe:edittext label="${original}" label-style="label-default" prefwidth="200" maxwidth="600" weight-y="1" weight-x="1" readonly="true" source="@original_text" data-type="VARCHAR(3500)" enabled="=@original_text!=null">
         <xe:validate not-empty="true"/>
       </xe:edittext>
       <xe:edittext label="${content}" label-style="label-default" prefwidth="250" maxwidth="600" weight-y="1" weight-x="1" source="@term" data-type="VARCHAR(3500)">
         <xe:validate not-empty="true"/>
       </xe:edittext>
    </xe:group>
  </xe:part>

  <!-- terminology memory: edit dialog -->
  <xe:part id="dialog-edit-translationmemory-top_part" transactional="true">
    <xe:group align="down">
      <xe:strut height="10"/>
      <xe:editfield label="${id}" label-style="label-default" width="250" source="@segment_id" data-type="INTEGER" readonly="true" enabled="=@segment_id!=null"> </xe:editfield>
      <xe:translationmemorysegmenteditor label="${original}" label-style="label-default" prefheight="300" prefwidth="200" maxwidth="600"  weight-x="1" readonly="true" source="@original_text" data-type="VARCHAR(3500)" enabled="=@original_text!=null">
        <xe:validate not-empty="true"/>
      </xe:translationmemorysegmenteditor>
      <xe:translationmemorysegmenteditor label="${content}" label-style="label-default" prefheight="300" prefwidth="250" maxwidth="600"  weight-x="1" source="@segment" data-type="VARCHAR(3500)">
        <xe:validate not-empty="true"/>
      </xe:translationmemorysegmenteditor>
    </xe:group>
  </xe:part>

  <!-- terminology: edit dialog -->
  <xe:part id="terminology-list-edit-window" transactional="true">
    <xe:inititems>
      <xe:inititem dest="@domain" value="root."/>
      <xe:inititem dest="@domain2" value="root."/>
    </xe:inititems>
    <xe:group align="down">
      <xe:group align="down">
        <xe:strut height="10"/>
        <xe:editfield label="${id}" label-style="label-default" width="250" source="@term_id" data-type="INTEGER" readonly="true" enabled="=$translationeditoptions@display_id"> </xe:editfield>
        <xe:edittext label="${content}" label-style="label-default" prefwidth="250" maxwidth="800" weight-y="1" weight-x="1" source="@term" data-type="VARCHAR(3500)">
          <xe:validate not-empty="true"/>
        </xe:edittext>
        <xe:popupmenu label="${language}" label-style="label-default" width="250" source="@locale" sort="ascending">
          <xe:options label-key="@name" value-key="@tm_locale">
            <xe:generator name="filtered_cachedtables" table-name="language_def"/>
            <xe:filter source="@tm_locale" operator="not-empty"/>
          </xe:options>
          <xe:validate not-empty="true"/>
        </xe:popupmenu>
        <xe:edittext label="${description}" label-style="label-default" prefwidth="250" maxwidth="600" weight-x="1" source="@description" data-type="VARCHAR(256)"/>
        <xe:popupmenutree label="${domain}" label-style="label-default" source="@domain" hide-root-popup="false">
          <xe:treeoptions label-key="@name" value-key="@pathid">
            <xe:generator name="cachedtables" table-name="domain"/>
            <xe:sort key="@sorting" data-type="integer"/>
            <xe:sort key="@name" data-type="string"/>
          </xe:treeoptions>
          <xe:validate not-empty="true"/>
        </xe:popupmenutree>
        <xe:popupmenutree label="${domain2}" label-style="label-default" source="@domain2" hide-root-popup="false" visible="=:count(cs:master-data('domain2')) gt 1">
          <xe:treeoptions label-key="@name" value-key="@pathid">
            <xe:generator name="cachedtables" table-name="domain2"/>
            <xe:sort key="@sorting" data-type="integer"/>
            <xe:sort key="@name" data-type="string"/>
          </xe:treeoptions>
          <xe:validate not-empty="true"/>
        </xe:popupmenutree>
        <xe:editfield label="${external-id}" label-style="label-default" width="250" source="@id_extern"/>
        <xe:strut height="10"/>
      </xe:group>
    </xe:group>
  </xe:part>

  <!-- layout: create new layout group dialog -->
  <xe:part id="dialog-create-new-group" transactional="false">
    <xe:group align="down" padding-left="5" padding-right="5" padding-top="10" padding-bottom="10">
      <xe:include key="dialog-edit-group-box-attributes-include">
        <xe:param new_group="true" edit_name="true"/>
      </xe:include>
    </xe:group>
  </xe:part>

  <!-- layout: add boxes to layout group dialog -->
  <xe:part id="dialog-add-boxes-to-group" transactional="false">
    <xe:group align="down" padding-left="5" padding-right="5" padding-top="10" padding-bottom="10">
      <xe:include key="dialog-edit-group-box-attributes-include">
        <xe:param new_group="false" edit_name="false"/>
      </xe:include>
    </xe:group>
  </xe:part>

  <!-- layout: edit layout group dialog -->
  <xe:part id="dialog-edit-group-box-attributes" transactional="false">
    <xe:group align="down" padding-left="5" padding-right="5" padding-top="10" padding-bottom="10">
      <xe:include key="dialog-edit-group-box-attributes-include">
        <xe:param new_group="false" edit_name="true"/>
      </xe:include>
    </xe:group>
  </xe:part>

  <!-- layout: layout group include -->
  <xe:part id="dialog-edit-group-box-attributes-include" transactional="false">
    <xe:param content-mimetype="=:cs:equal-values(groupslug/@content-mimetype, groupslug[1]/@content-mimetype, null)"/>
    <xe:group align="down">
      <xe:expandgroup caption="${group}" id="group" expanded="true" save-state="true" align="down">
        <xe:editfield label="${id}" label-style="label-default" width="30em" source="@group-id" readonly="true" visible="=$param@new_group='false'">
          <xe:validate not-empty="true"/>
        </xe:editfield>
        <xe:editfield label="${name}" label-style="label-default" width="30em" source="@group-name" readonly="=$param@edit_name='false'">
          <xe:validate not-empty="true"/>
        </xe:editfield>
        <xe:popupmenu label="${placement-method}" label-style="label-default" width="30em" source="@placement-method" defaultvalue="=if $param@new_group='true' then 'configuration-assets' else 'collection'">
          <xe:options>
            <xe:option label="${results-of-transformation-assets}" value="transformation"/>
            <xe:option label="${configuration-assets}" value="configuration-assets"/>
            <xe:option label="${assigned-assets-of-collections}" value="collection"/>
          </xe:options>
        </xe:popupmenu>
        <xe:selectcase source="@placement-method" align="down">
          <xe:case value="configuration-assets">
            <xe:popupmenu label="${configuration-asset}" label-style="label-default" width="30em" source="@group-configuration-asset" sort="ascending">
              <xe:options value-key="@key" label-key="@name">
                <xe:generator name="filtered_cachedtables" table-name="resource_asset"/>
                <xe:filter condition="=:exists(resource_asset[starts-with(@type, 'module.layout-group.')])"/>
              </xe:options>
              <xe:validate not-null="true"/>
            </xe:popupmenu>
          </xe:case>
        </xe:selectcase>
      </xe:expandgroup>
      <xe:separator/>
      <xe:expandgroup caption="${box}" id="placement" expanded="true" save-state="true" align="down">
        <xe:editfield label="${name}" label-style="label-default" width="30em" source="@box-name" readonly="=$param@edit_name='false'"/>
        <xe:selectcase source="@placement-method" align="down">
          <xe:case value="collection">
            <xe:group>
              <xe:popupmenu label="${placement-category}" label-style="label-default" width="30em" source="@category">
                <xe:options value-key="@value_key" label-key="@name">
                  <xe:generator name="filtered_cachedtables" table-name="feature_value" source="@feature" match="censhare:placement-category"/>
                  <xe:sort key="@sorting" data-type="integer"/>
                </xe:options>
              </xe:popupmenu>
              <xe:deletebutton source="@category"/>
            </xe:group>
            <xe:group>
              <xe:editfield label="${priority}" label-style="label-default" width="5em" source="@priority" data-type="INTEGER">
                <xe:delete dest="@task"/>
                <xe:delete dest="@search-transformation-key"/>
                <xe:delete dest="@configuration-asset"/>
                <xe:delete dest="@layout-group-configuration-asset"/>
                <xe:delete dest="@index"/>
              </xe:editfield>
              <xe:deletebutton source="@priority"/>
              <xe:label value="${higher-number-means-higher-priority}"/>
            </xe:group>
            <xe:group visible="=:exists($param/param/@content-mimetype)">
              <xe:popupmenu label="${content-transformation}" label-style="label-default" width="30em" source="@transformation-key" sort="ascending">
                <xe:options value-key="@key" label-key="@name">
                  <xe:generator name="filtered_cachedtables" table-name="resource_asset"/>
                  <xe:filter condition="=:exists(resource_asset/xmldata/usages/usage[@value='censhare:indesign-content-transformation'])"/>
                  <xe:filter condition="=:exists(resource_asset/xmldata/target-formats/format[@mimetype=$param/param/@content-mimetype])"/>
                </xe:options>
              </xe:popupmenu>
              <xe:deletebutton source="@transformation-key"/>
            </xe:group>
            <xe:editfield label="${sorting}" label-style="label-default" width="5em" source="@sorting" data-type="INTEGER" defaultvalue="1"/>
            <xe:checkbox label="${geometry-changes}" caption="${allow}" label-style="label-default" source="@geometry-lock" checked-value="false" unchecked-value="true" defaultvalue="true"/>
            <xe:checkbox label="${content-changes}" caption="${allow}" label-style="label-default" source="@content-lock" checked-value="false" unchecked-value="true" defaultvalue="false"/>
          </xe:case>
          <xe:case value="transformation">
            <xe:group>
              <xe:popupmenu label="${placement-category}" label-style="label-default" width="30em" source="@category">
                <xe:options value-key="@value_key" label-key="@name">
                  <xe:generator name="filtered_cachedtables" table-name="feature_value" source="@feature" match="censhare:placement-category"/>
                  <xe:sort key="@sorting" data-type="integer"/>
                </xe:options>
              </xe:popupmenu>
              <xe:deletebutton source="@category"/>
            </xe:group>
            <xe:popupmenu label="${asset-search}" label-style="label-default" width="30em" source="@search-transformation-key" sort="ascending">
              <xe:options value-key="@key" label-key="@name">
                <xe:generator name="filtered_cachedtables" table-name="resource_asset"/>
                <xe:filter condition="=:exists(resource_asset/xmldata/usages/usage[@value='censhare:indesign-layout-group-box-asset-search'])"/>
              </xe:options>
              <xe:validate not-null="true"/>
              <xe:delete dest="@task"/>
              <xe:delete dest="@configuration-asset"/>
              <xe:delete dest="@layout-group-configuration-asset"/>
              <xe:delete dest="@priority"/>
            </xe:popupmenu>
            <xe:editfield label="${index}" label-style="label-default" width="5em" source="@index" data-type="INTEGER" defaultvalue="1"/>
            <xe:group visible="=:exists($param/param/@content-mimetype)">
              <xe:popupmenu label="${content-transformation}" label-style="label-default" width="30em" source="@transformation-key" sort="ascending">
                <xe:options value-key="@key" label-key="@name">
                  <xe:generator name="filtered_cachedtables" table-name="resource_asset"/>
                  <xe:filter condition="=:exists(resource_asset/xmldata/usages/usage[@value='censhare:indesign-content-transformation'])"/>
                  <xe:filter condition="=:exists(resource_asset/xmldata/target-formats/format[@mimetype=$param/param/@content-mimetype])"/>
                </xe:options>
              </xe:popupmenu>
              <xe:deletebutton source="@transformation-key"/>
            </xe:group>
            <xe:editfield label="${sorting}" label-style="label-default" width="5em" source="@sorting" data-type="INTEGER" defaultvalue="1"/>
            <xe:checkbox label="${geometry-changes}" caption="${allow}" label-style="label-default" source="@geometry-lock" checked-value="false" unchecked-value="true" defaultvalue="true"/>
            <xe:checkbox label="${content-changes}" caption="${allow}" label-style="label-default" source="@content-lock" checked-value="false" unchecked-value="true" defaultvalue="false"/>
          </xe:case>
          <xe:case value="configuration-assets">
            <xe:popupmenu label="${configuration-asset}" label-style="label-default" width="30em" source="@configuration-asset" sort="ascending">
              <xe:options value-key="@key" label-key="@name">
                <xe:generator name="filtered_cachedtables" table-name="resource_asset"/>
                <xe:filter condition="=:exists(resource_asset[starts-with(@type, 'module.layout-box.')])"/>
              </xe:options>
              <!--xe:validate not-null="true"/-->
              <xe:delete dest="@task"/>
              <xe:delete dest="@search-transformation-key"/>
              <xe:delete dest="@transformation-key"/>
              <xe:delete dest="@priority"/>
              <xe:delete dest="@category"/>
            </xe:popupmenu>
            <xe:editfield label="${index}" label-style="label-default" width="5em" source="@index" data-type="INTEGER" defaultvalue="1"/>
            <xe:editfield label="${sorting}" label-style="label-default" width="5em" source="@sorting" data-type="INTEGER" defaultvalue="1"/>
          </xe:case>
        </xe:selectcase>
      </xe:expandgroup>
      <xe:separator/>
      <xe:include key="dialog-dynamic-layout"/>
    </xe:group>
  </xe:part>
  
  <!-- layout: dynamic layout: overview dialog -->
  <xe:part id="dialog-dynamic-layout-overview" transactional="false">
    <xe:group align-y="top" align="down">
      <xe:expandgroup caption="${named-constants}" id="expand-group-dynamic-layout-named-constants" expanded="true" save-state="true" align="down">
        <xe:foreach source="constraints.named-constant" new-button="false">
          <xe:button icon="edit" action="action-dynamic-layout-edit-named-constant" source=""/>
          <xe:deletebutton/>
          <xe:label value="=:$current/named-constant/@label"/>
        </xe:foreach>
        <xe:button icon="add" action="action-dynamic-layout-new-named-constant" source=""/>
      </xe:expandgroup>
      <xe:separator/>
      <xe:expandgroup caption="${constraints}" id="expand-group-dynamic-layout-constraints" expanded="true" save-state="true" align="down">
        <xe:foreach source="constraints.constraint" new-button="false">
          <xe:inititems>
            <xe:inititem dest="@operator" value="eq"/>
            <xe:inititem dest="@enabled" value="true"/>
          </xe:inititems>
          <xe:checkbox source="@enabled" defaultvalue="true"/>
          <xe:button icon="edit" action="action-dynamic-layout-edit-constraint" source=""/>
          <xe:deletebutton/>
          <xe:label value="=:$current/constraint/@label"/>
        </xe:foreach>
        <xe:button icon="add" action="action-dynamic-layout-new-constraint" source=""/>
      </xe:expandgroup>
      <xe:group align="down" enabled="=:$system/system/@is-admin-mode='true' and $page-groups/page-groups/@selected-boxes-count=1">
        <xe:separator/>
        <xe:expandgroup caption="${xml}" id="expand-group-dynamic-layout-xml" expanded="true" save-state="true" align="down">
          <xe:button caption="${edit-dynamic-layout-xml-directly}" action="action-dynamic-layout-edit-xml"/>
        </xe:expandgroup>
      </xe:group>
    </xe:group>
  </xe:part>
  
  <!-- layout: layout group include: dynamic layout (divided into different parts ) -->
  <xe:part id="dialog-dynamic-layout" transactional="false">
    <xe:expandgroup caption="${dynamic-layout}" id="expandgroup-dynamic-layout" expanded="false" save-state="true" align="down">
      <xe:include key="dialog-dynamic-layout-named-constants"/>
      <xe:include key="dialog-dynamic-layout-constraints"/>
      <xe:group align="down" enabled="=:$system/system/@is-admin-mode='true' and $page-groups/page-groups/@selected-boxes-count=1">
        <xe:separator/>
        <xe:button caption="${edit-dynamic-layout-xml-directly}" action="action-dynamic-layout-edit-xml"/>
      </xe:group>
    </xe:expandgroup>
  </xe:part>
  <xe:part id="dialog-dynamic-layout-named-constants" transactional="false">
    <xe:group>
      <xe:label label="${named-constants}" label-style="label-default" align-y="top"/>
      <xe:group align="down">
        <xe:foreach source="constraints.named-constant">
          <xe:group align="down">
            <xe:include key="dialog-dynamic-layout-named-constant"/>
            <xe:deletebutton/>
            <xe:separator/>
          </xe:group>
        </xe:foreach>
      </xe:group>
    </xe:group>
  </xe:part>
  <xe:part id="dialog-dynamic-layout-named-constant" transactional="false">
    <xe:group align="right">
      <xe:group align-y="top" align="down">
        <xe:include key="dialog-dynamic-layout-named-constants-named-constant-name"/>
        <xe:include key="dialog-dynamic-layout-variables"/>
        <xe:include key="dialog-dynamic-layout-constants"/>
      </xe:group>
    </xe:group>
  </xe:part>
  <xe:part id="dialog-dynamic-layout-named-constants-named-constant-name" transactional="false">
    <xe:group align="right">
      <xe:label label="${name}" label-width="10em"/>
      <xe:editfield source="@name" width="30em">
        <xe:validate not-empty="true"/>
      </xe:editfield>
    </xe:group>
  </xe:part>
  <xe:part id="dialog-dynamic-layout-constraints" transactional="false">
    <xe:group>
      <xe:label label="${constraints}" label-style="label-default" align-y="top"/>
      <xe:group align="down">
        <xe:foreach source="constraints.constraint">
          <xe:inititems>
            <xe:inititem dest="@operator" value="eq"/>
            <xe:inititem dest="@enabled" value="true"/>
          </xe:inititems>
          <xe:group align="down">
            <xe:include key="dialog-dynamic-layout-constraint"/>
            <xe:deletebutton/>
            <xe:separator/>
          </xe:group>
        </xe:foreach>
      </xe:group>
    </xe:group>
  </xe:part>
  <xe:part id="dialog-dynamic-layout-constraint" transactional="false">
    <xe:group align="down">
      <xe:group>
        <xe:label label="${general}" label-width="10em" align-y="top"/>
        <xe:group align="down">
          <xe:checkbox source="@enabled" caption="${enabled}" defaultvalue="true"/>
          <xe:include key="dialog-dynamic-layout-constraints-constraint-def"/>
        </xe:group>
      </xe:group>
      <xe:include key="dialog-dynamic-layout-constraints-constraint-offset"/>
      <xe:include key="dialog-dynamic-layout-variables"/>
      <xe:include key="dialog-dynamic-layout-constants"/>
    </xe:group>
  </xe:part>
  <xe:part id="dialog-dynamic-layout-constraints-constraint-def" transactional="false">
    <xe:group align="down">
      <xe:group align="right">
        <xe:label value="${priority}" width="10em"/>
        <xe:label value="${attribute}" width="13em"/>
        <xe:label value="${operator}" width="14em"/>
      </xe:group>
      <xe:group align="right">
        <xe:popupmenu width="10em" source="@strength" defaultvalue="required">
          <xe:options>
            <xe:option label="${weak}" value="weak"/>
            <xe:option label="${medium}" value="medium"/>
            <xe:option label="${strong}" value="strong"/>
            <xe:option label="${required}" value="required"/>
          </xe:options>
        </xe:popupmenu>
        <xe:include key="dialog-dynamic-layout-attribute"/>
        <xe:popupmenu source="@operator" width="14em">
          <xe:options>
            <xe:option label="${equal}" value="eq"/>
            <xe:option label="${greater-or-equal}" value="ge"/>
            <xe:option label="${less-or-equal}" value="le"/>
          </xe:options>
          <xe:validate not-empty="true"/>
        </xe:popupmenu>
      </xe:group>
    </xe:group>
  </xe:part>
  <xe:part transactional="false" id="dialog-dynamic-layout-attribute">
    <xe:group>
      <xe:popupmenu width="13em" source="@attribute">
        <xe:options>
          <xe:option label="${left}" value="left"/>
          <xe:option label="${right}" value="right"/>
          <xe:option label="${top}" value="top"/>
          <xe:option label="${bottom}" value="bottom"/>
          <xe:option label="${width}" value="width"/>
          <xe:option label="${height}" value="height"/>
          <xe:option label="${center-x}" value="centerX"/>
          <xe:option label="${center-y}" value="centerY"/>
          <xe:option label="${content-width}" value="intrinsicWidth"/>
          <xe:option label="${content-height}" value="intrinsicHeight"/>
          <xe:option label="${has-placements}" value="hasPlacement"/>
        </xe:options>
        <xe:validate condition="=:boolean($current//@attribute)"/>
      </xe:popupmenu>
    </xe:group>
  </xe:part>
  <xe:part transactional="false" id="dialog-dynamic-layout-constraints-constraint-offset">
    <xe:group>
      <xe:label label="${dependency}" label-width="10em" align-y="top"/>
      <xe:group align="down">
        <xe:foreach source="offset" max-occurs="1">
          <xe:group align="down">
            <xe:checkbox source="@is-absolute" caption="${absolute}" defaultvalue="true">
              <xe:delete dest="@group" condition="=:offset/@is-absolute='true'"/>
              <xe:delete dest="@item" condition="=:offset/@is-absolute='true'"/>
              <xe:delete dest="@attribute" condition="=:offset/@is-absolute='true'"/>
            </xe:checkbox>
            <xe:group align="right">
              <xe:label value="${factor}" width="9em"/>
              <xe:selectcase value="=true">
                <xe:listen-to source="@is-absolute"/>
                <xe:case value="=:offset/@is-absolute='false'">
                  <xe:label value="${group}" width="15em"/>
                  <xe:label value="${item}" width="15em"/>
                  <xe:label value="${attribute}" width="10em"/>
                </xe:case>
              </xe:selectcase>
            </xe:group>
            <xe:include key="dialog-dynamic-layout-variable-or-offset">
              <xe:param is-variable="false"/>
            </xe:include>
          </xe:group>
          <xe:deletebutton/>
        </xe:foreach>
      </xe:group>
    </xe:group>
  </xe:part>
  <xe:part transactional="false" id="dialog-dynamic-layout-variables">
    <xe:group>
      <xe:label label="${variables}" label-width="10em" align-y="top"/>
      <xe:group align="down">
        <xe:group>
          <xe:label value="${factor}" width="9em"/>
          <xe:label value="${group}" width="15em"/>
          <xe:label value="${item}" width="15em"/>
          <xe:label value="${attribute}" width="10em"/>
        </xe:group>
        <xe:foreach source="variable">
          <xe:include key="dialog-dynamic-layout-variable-or-offset">
            <xe:param is-variable="true"/>
          </xe:include>
          <xe:deletebutton/>
        </xe:foreach>
       </xe:group>
    </xe:group>
  </xe:part>
  <xe:part transactional="false" id="dialog-dynamic-layout-variable-or-offset">
    <xe:group align="down">
      <xe:group>
        <xe:editfield source="@coefficient" width="9em" cuetext="${factor-cuetext}"/>
        <xe:selectcase value="=true">
          <xe:listen-to source="@is-absolute"/>
          <xe:case value="=:offset/@is-absolute='false' or $param/param/@is-variable='true'">
            <xe:popupmenu source="@group" width="15em">
              <xe:options source="$page-groups.group" value-key="@name" label-key="@name" null-entry="true"/>
              <xe:delete dest="@item" condition="=:boolean($current//@group) or not($current//@item='page')"/>
            </xe:popupmenu>
            <xe:popupmenu source="@item" width="15em">
              <xe:options value-key="@name" label-key="@name" null-entry="true">
                <xe:generator expression="=:$page-groups/page-groups/group[@name=(if ($current//@group) then $current//@group else (if ($groupslug) then $groupslug/groupslug/@group-name else $content/groupslug/@group-name))]/box"/>
                <xe:option label="${page}" value="page"/>
              </xe:options>
              <xe:delete dest="@group" condition="=:$current//@item='page'"/>
              <xe:listen-to source="@group"/>
            </xe:popupmenu>
            <xe:include key="dialog-dynamic-layout-attribute"/>
          </xe:case>
        </xe:selectcase>
      </xe:group>
    </xe:group>
  </xe:part>
  <xe:part transactional="false" id="dialog-dynamic-layout-constants">
    <xe:group>
      <xe:label label="${constants}" label-width="10em" align-y="top"/>
      <xe:group align="down">
        <xe:group align="right">
          <xe:label value="${factor}" width="9em"/>
          <xe:label value="${value}" width="9em"/>
          <xe:label value="${unit}" width="10em"/>
        </xe:group>
        <xe:foreach source="constant">
          <xe:group align-y="top" align="down">
            <xe:group align="right">
              <xe:editfield source="@coefficient" width="9em" cuetext="${factor-cuetext}"/>
              <xe:editfield source="@value" width="9em">
                <xe:validate not-empty="true"/>
              </xe:editfield>
              <xe:include key="dialog-dynamic-layout-unit"/>
            </xe:group>
          </xe:group>
          <xe:deletebutton/>
        </xe:foreach>
       </xe:group>
    </xe:group>
  </xe:part>
  <xe:part transactional="false" id="dialog-dynamic-layout-unit">
    <xe:group>
      <xe:popupmenu width="10em" source="@unit">
        <xe:options option-label-expression="=cachelookup('unit', '@key', @unit)@name" value-key="@unit">
          <xe:generator name="filtered_cachedtables" table-name="unit_set_rel" source="@unit_set" match="censhare:typography-length"/>
        </xe:options>
      </xe:popupmenu>
    </xe:group>
  </xe:part>
  
  <!-- Dialog to change the size/format of an InDesign document -->
  <xe:part id="dialog-layout-change-page-size" transactional="false">
    <xe:inititems>
      <xe:inititem dest="@unit" value="mm"/>
    </xe:inititems>
    <xe:group align="down">
      <xe:strut height="20"/>
      <xe:group align="right">
        <xe:editfield label="Size" label-style="label-default" label-width="8em" width="5em" source="@width" data-type="NUMBER">
          <xe:validate not-empty="true" condition="=:*/number(@width) > 0"/>
        </xe:editfield>
        <xe:label value="x"/>
        <xe:editfield width="5em" source="@height" data-type="NUMBER">
          <xe:validate not-empty="true" condition="=:*/number(@height) > 0"/>
        </xe:editfield>
        <xe:include key="dialog-dynamic-layout-unit"/>
      </xe:group>
      <xe:group align="right">
        <xe:popupmenu label="${format}" label-style="label-default" label-width="8em" source="@format">
          <xe:options label-key="@name" value-key="@id">
            <xe:generator name="filtered_cachedtables" table-name="asset_format"/>
          </xe:options>
          <xe:change dest="@width" defaultvalue="0" value="=cachelookup('asset_format', '@id', '@format')@paper_width_mm"/>
          <xe:change dest="@height" defaultvalue="0" value="=cachelookup('asset_format', '@id', '@format')@paper_height_mm"/>
          <xe:change dest="@unit" value="mm"/>
        </xe:popupmenu>
        <xe:deletebutton source="@format"/>
      </xe:group>
    </xe:group>
  </xe:part>
  
  <!-- Dialog for the Dynamic Layout component in the InDesign palette -->
  <xe:part id="dynamic-layout-component-dialog" transactional="false">
    <xe:group align="down">
      <xe:selectcase value="=true">
        <xe:case value="=:exists(groupslug/@placement-method)">
          <xe:include key="dialog-dynamic-layout-overview"/>
        </xe:case>
      </xe:selectcase>
    </xe:group>  
  </xe:part>
  
  <!-- layout: dynamic layout: edit dialog -->
  <xe:part id="dialog-dynamic-layout-edit" transactional="false">
    <xe:group align-y="top" align="down">
      <xe:selectcase value="=true">
        <!-- constraint -->
        <xe:case value="=:exists(constraint)">
          <xe:include key="dialog-dynamic-layout-constraint"/>
        </xe:case>
        <!-- named constant -->
        <xe:defaultcase>
          <xe:include key="dialog-dynamic-layout-named-constant"/>          
        </xe:defaultcase>
      </xe:selectcase>
    </xe:group>
  </xe:part>
  
  <!-- translate4 differ dialog -->
  <xe:part id="translate4-differ-window" transactional="false">
    <xe:group align="right">
      <xe:strut width="5"/>
      <xe:group align="down">
        <xe:group align="down" height="24">
          <xe:popupmenu source="@selectedVersion" id="version-popup" label="${difference-tab-version}">
            <xe:options source="versions.version" value-key="@ver" label-key="@ver"/> 
          </xe:popupmenu>
        </xe:group>
        <xe:textdiff source="preview1" source-new="preview2" is-html="true" diff-all-words="true" readonly="true" weight-x="1" prefwidth="10" weight-y="1" minwidth="100" minheight="100"/>
      </xe:group>
      <xe:strut width="5"/>
    </xe:group>
  </xe:part>

  <!-- asset text differ dialog -->
  <xe:part id="asset-text-differ-window" transactional="false">
    <xe:group align="right">
      <xe:strut width="5"/>
      <xe:group align="down">
        <xe:strut height="5"/>
        <xe:group align="down" height="60">
          <xe:html label-wordwrap="true">
            <xe:html-value>
              <![CDATA[
                = '<html>' +
                '<b>' + $temp.'left-asset'@name + '</b><br>ID: ' + $temp.'left-asset'@id + ', Version: ' + $temp.'left-asset'@version
                + '</html>'
              ]]>
            </xe:html-value>
          </xe:html>
          <xe:strut weight-y="1"/>
          <xe:popupmenu source="@selected-left" id="popup-left" label="Element">
            <xe:options source="preview1-storages.option" label-key="@label" value-key="@id"/>
          </xe:popupmenu>
        </xe:group>
        <xe:edittext source="preview1" is-html="true" prefwidth="10" readonly="true" weight-x="1" weight-y="1" minwidth="100" minheight="100" scrollpane="false"/>
      </xe:group>
      <xe:group align="down">
        <xe:strut height="5"/>
        <xe:group align="down" height="60">
          <xe:strut weight-y="1"/>
          <xe:label label="${difference}"/>
        </xe:group>
        <xe:textdiff source="preview1" source-new="preview2" is-html="true" diff-all-words="true" readonly="true" weight-x="1" prefwidth="10" weight-y="1" minwidth="100" minheight="100"/>
      </xe:group>
      <xe:group align="down">
        <xe:strut height="5"/>
        <xe:group align="down" height="60">
          <xe:html label-wordwrap="true">
            <xe:html-value>
              <![CDATA[
            = '<html>' +
            '<b>' + $temp.'right-asset'@name + '</b><br>ID: ' + $temp.'right-asset'@id + ', Version: ' + $temp.'right-asset'@version
            + '</html>'
            ]]>
            </xe:html-value>
          </xe:html>
          <xe:strut weight-y="1"/>
          <xe:popupmenu source="@selected-right" id="popup-right" label="Element">
            <xe:options source="preview2-storages.option" label-key="@label" value-key="@id"/>
          </xe:popupmenu>
        </xe:group>
        <xe:edittext source="preview2" is-html="true" readonly="true" weight-x="1" prefwidth="10" weight-y="1" minwidth="100" minheight="100"  scrollpane="false"/>
      </xe:group>
      <xe:strut width="5"/>
    </xe:group>
  </xe:part>

  <!-- asset messages: table dialog -->
  <xe:part id="asset-message-window" transactional="false">
    <xe:group align="down">
      <xe:filterwidget id="asset-messages-table-filter" filter-directly="true" icons="false"/>
      <xe:xe-table id="asset-messages-table" filter-widget="asset-messages-table-filter" source="message" minwidth="500" minheight="50" prefheight="50" weight-x="1" weight-y="1" double-click-action="table-double-click">
        <xe:columns>
          <xe:sorting>
            <xe:sort-col key="date" ascending="true"/>
          </xe:sorting>
          <xe:column key="date" label="${date}" source="@timestamp" type="date" date-format="relative-short" time-format="short" width="150" filterable="true"/>
          <xe:column key="module" label="${module}" width="100" source="@module" filterable="true"/>
          <xe:column key="command" label="${command}" width="200" source="@command" filterable="true"/>
          <xe:column key="transactionId" label="${transaction-id}" width="300" source="@transaction_id" filterable="true"/>
          <xe:column key="sender" label="${sender}" width="100" filterable="true" formula=":cs:cachelookup('party', '@id', @source_party)/@display_name"/>
          <xe:column key="title" label="${title}" width="500" source="@title" filterable="true"/>
        </xe:columns>
      </xe:xe-table>
    </xe:group>
  </xe:part>

  <!-- asset message detail dialog -->
  <xe:part id="asset-message-detail-window" transactional="false">
    <xe:group align="down">
      <xe:label label="${module}" label-style="label-default" label-width="7em" value="=@module"/>
      <xe:label label="${command}" label-style="label-default" label-width="7em" value="=@command"/>
      <xe:edittext label="${transaction-id}" label-style="label-default" label-width="9em" source="@transaction_id" prefwidth="200" weight-x="1" rows="2" readonly="true"/>
      <xe:edittext label="${title}" label-style="label-default" label-width="7em" source="@title" prefwidth="100" weight-x="1" rows="2" readonly="true"/>
      <xe:edittext label="${message}" label-style="label-default" label-width="7em" source="@message" prefwidth="100" weight-x="1" rows="8" readonly="true"/>
    </xe:group>
  </xe:part>

  <!-- messages: detail dialog -->
  <xe:part id="messages-detail-window" transactional="false">
    <xe:group align="down">
      <xe:label style="label-title" value="${general}" weight-x="1"/>
      <xe:group align="down" style="group-indent-left-right">
        <xe:label label="${sender}" label-width="10em" width="150" value="=cachelookup('party', '@id', @source_party)@display_name">
          <xe:listen-to source="@source_party"/>
        </xe:label>
        <xe:label label="${recipient}" label-width="10em" source="@readable_target_party_list"/>
        <xe:label label="${date}" label-width="10em" width="150" source="@timestamp_formatted"/>
      </xe:group>
      <xe:group style="group-indent-left-right" align="down">
        <xe:label label="${subject}" label-width="10em" source="@title_formatted" prefwidth="100" weight-x="1"/>
      </xe:group>
      <xe:label style="label-title" value="${message}" weight-x="1"/>
      <xe:group style="group-indent-left-right" align="down">
        <xe:edittext source="@message" prefwidth="100" weight-x="1" weight-y="1" rows="8" readonly="true"/>
      </xe:group>
    </xe:group>
  </xe:part>

  <!--
    planning: new elements dialog 
    
    Note: Not used anymore by clients >= 4.8.0, but stays here for backward compatibility to older clients.
  -->
  <xe:part id="dialog-planning-new-elements" transactional="false">
    <xe:group align="down">
      <xe:editfield label="${how-many-pages-elements}" label-width="15em" source="@num" width="5em" defaultvalue="2"/>
    </xe:group>
  </xe:part>

  <!-- planning: edit paging dialog -->
  <xe:part id="dialog-planning-edit-paging" transactional="true">
    <xe:group align="down">
      <xe:popupmenu label="${change}" label-style="label-default" defaultvalue="1" source="@is_paging_start">
        <xe:options>
          <xe:option label="${none}" value="0"/>
          <xe:option label="${start-pagination}" value="1"/>
          <xe:option label="${end-pagination}" value="2"/>
        </xe:options>
      </xe:popupmenu>
      <xe:group align="down" visible="=:*/@is_paging_start=1">
        <xe:listen-to source="@is_paging_start"/>
        <xe:editfield label="${page-number}" label-style="label-default" source="@paging" width="60" data-type="INTEGER">
          <xe:validate not-empty="true" min-value="1"/>
        </xe:editfield>
        <xe:editfield label="${prefix}" label-style="label-default" source="@paging_prefix" width="60">
          <xe:validate regex=".{0,16}"/>
        </xe:editfield>
        <xe:popupmenu label="${format}" label-style="label-default" source="@paging_format">
          <xe:options>
            <xe:option label="${page-number-format-numeric}" value="numeric"/>
            <xe:option label="${page-number-format-numeric-01}" value="numeric_01"/>
            <xe:option label="${page-number-format-numeric-001}" value="numeric_001"/>
            <xe:option label="${page-number-format-numeric-0001}" value="numeric_0001"/>            
            <xe:option label="${page-number-format-letters-upper}" value="letters_upper"/>
            <xe:option label="${page-number-format-roman-upper}" value="roman_upper"/>
            <xe:option label="${page-number-format-letters-lower}" value="letters_lower"/>
            <xe:option label="${page-number-format-roman-lower}" value="roman_lower"/>
          </xe:options>
        </xe:popupmenu>
      </xe:group>
    </xe:group>
  </xe:part>

  <!-- planning: add insertion dialog -->
  <xe:part id="dialog-planning-add-insertion" transactional="true">
    <xe:group align="down">
      <xe:editfield label="${insert}" label-style="label-default" source="@insert_before"/>
    </xe:group>
  </xe:part>

  <!-- planning: add sticker dialog -->
  <xe:part id="dialog-planning-add-sticker" transactional="true">
    <xe:group align="down">
      <xe:editfield label="${sticker}" label-style="label-default" source="@sticker"/>
    </xe:group>
  </xe:part>

  <!-- planning: add sheet marker dialog -->
  <xe:part id="dialog-planning-add-sheet-marker" transactional="true">
    <xe:group align="down">
      <xe:editfield label="${sheet-marker}" label-style="label-default" source="@split_before"/>
    </xe:group>
  </xe:part>

  <!-- planning: edit sheet dialog -->
  <xe:part id="dialog-planning-edit-sheet" transactional="true">
    <xe:group align="down">
      <xe:label label="${sorting}" label-style="label-default" source="@sorting"/>
      <xe:editfield label="${number-of-pages}" label-style="label-default" width="5em" source="@pages">
        <xe:validate not-empty="true"/>
      </xe:editfield>
      <xe:group align="right">
        <xe:editfield label="" label-style="label-default" width="5em" source="@first_half_pages"/>
        <xe:label value="${number-of-first-half-pages}"/>
      </xe:group>
      <xe:editfield label="${name}" label-style="label-default" width="30em" source="@name">
        <xe:validate not-empty="true"/>
      </xe:editfield>
      <xe:editfield label="${description}" label-style="label-default" width="30em" source="@description"/>
      <xe:group align="right">
        <xe:colorpicker label="${colour}" label-style="label-default" width="16" height="16" source="@color"/>
        <xe:deletebutton source="@color"/>
      </xe:group>
      <xe:checkbox label="${separate-line}" label-style="label-default" source="@separate_line" unchecked-value="0" checked-value="1"/>
      <xe:group align="right">
        <xe:auto-completion-field label="${schedule-asset}" label-style="label-default" cuetext="${enter-search-term}" source="@schedule_asset_id" search-value-source="$temp@search_group" width="30em" internal-search="false" popup-row-height="40" popup-row-width="46em" css-key="asset-info" expression-id="asset-ref-list" max-items="100">
          <xe:options label-key="@name" value-key="@id" lookup-expression="=:cs:get-asset(sheet/@schedule_asset_id)">
            <xe:generator expression="=:if ($temp/temp/@search_group and string-length($temp/temp/@search_group) > 2) then cs:asset()[@censhare:text.name = string($temp/temp/@search_group) and @censhare:asset.type='schedule.'] else ()"/>
          </xe:options>
        </xe:auto-completion-field>
        <xe:deletebutton source="@schedule_asset_id"/>
        <xe:label value="=:if (sheet/@schedule_asset_id) then concat('${id}: ', sheet/@schedule_asset_id) else ''">
          <xe:listen-to source="@schedule_asset_id"/>
        </xe:label>
      </xe:group>
      <!-- alternate version as editfield -->
      <!--xe:editfield label="${schedule-asset-id}" label-style="label-default" width="30em" source="@schedule_asset_id"/-->
      <xe:group align="right">
        <xe:editdate label="${deadline}" label-style="label-default" width="30em" source="@deadline"/>
        <xe:deletebutton source="@deadline"/>
      </xe:group>
    </xe:group>
  </xe:part>

  <!-- planning: asset edit info dialog -->
  <xe:part id="dialog-planning-asset-edit-info" transactional="false">
    <xe:group align="down"> </xe:group>
  </xe:part>

  <!-- asset new search dialog -->
  <xe:part id="dialog-new-search" transactional="true">
    <xe:groupbox caption="${save-as}" font-weight="bold" align="down">
      <xe:editfield label="${name}" weight-x="1" minwidth="200" source="@name">
        <xe:validate not-empty="true"/>
      </xe:editfield>
    </xe:groupbox>
  </xe:part>

  <!-- quick search dialog -->
  <xe:part id="funnel-quick-search" transactional="false">
    <xe:group>
      <xe:feature feature-key="censhare:text.meta" label="" label-gap="0" mode="query" width="180px"/>
    </xe:group>
  </xe:part>

  <!-- Apple Event test window -->
  <xe:part id="apple-event-test" transactional="false">
    <xe:group align="down">
      <xe:strut height="8"/>
      <xe:group>
        <xe:editfield label="Event class" source="send@event-class" width="10em" margin-right="10"/>
        <xe:editfield label="Event ID" source="send@event-id" width="10em" margin-right="10"/>
        <xe:editfield label="PSN/Creator" source="send@psn-creator" width="10em" margin-right="10"/>
        <xe:editfield label="Timeout (sec)" source="send@timeout-sec" data-type="INTEGER" width="4em" margin-right="10" defaultvalue="10"/>
        <xe:checkbox caption="UTF-16" source="@utf-16" defaultvalue="true"/>
        <xe:strut weight-x="1"/>
        <xe:button id="sendButton" caption="Send" action="send"/>
      </xe:group>
      <xe:strut height="8"/>
      <xe:groupbox caption="Parameter" align="down" weight-x="1">
        <xe:foreach source="send.param">
          <xe:editfield label="Key" label-align="left-top" source="@key" width="10em" align-y="top"/>
          <xe:edittext label="Value" label-align="left-top" source="@value" rows="1" scrollpane="false" maxheight="200" weight-x="1" align-y="top"/>
          <xe:deletebutton/>
        </xe:foreach>
      </xe:groupbox>
      <xe:checkbox caption="Expect result" source="send@expect-result" defaultvalue="false" margin-top="5"/>
      <xe:group>
        <xe:edittext source="send.result" weight-x="1" weight-y="1" scrollpane="true"/>
        <xe:deletebutton source="send.result"/>
      </xe:group>
      <xe:groupbox caption="Event handlers" align="down" weight-x="1">
        <xe:foreach source="handlers.handler" row-align="down">
          <xe:group>
            <xe:editfield label="Event class" source="@event-class" width="10em" margin-right="10" label-width="93" label-text-align="right"/>
            <xe:editfield label="Event ID" source="@event-id" width="10em" margin-right="10"/>
            <xe:checkbox caption="Return result" source="@return-result" defaultvalue="false" enabled="false"/>
            <xe:deletebutton/>
          </xe:group>
          <xe:edittext label="Result" label-align="left-top" label-width="93" rows="3" source="result" weight-x="1" maxheight="200" label-text-align="right"
            scrollpane="false" visible="=:handler/@return-result = 'true'">
            <xe:listen-to source="@return-result"/>
          </xe:edittext>
        </xe:foreach>
        <xe:button caption="Install / Update" action="installEventHandlers"/>
      </xe:groupbox>
      <xe:strut height="8"/>
      <xe:label value="Incomming Apple Events:"/>
      <xe:group>
        <xe:edittext source="incomming-events" weight-x="1" weight-y="1" scrollpane="true" maxheight="250"/>
        <xe:deletebutton source="incomming-events"/>
      </xe:group>
    </xe:group>
  </xe:part>
  
  <!-- article editor preview -->
  <xe:part id="article-editor-preview" transactional="false" scrollpane="false">
    <xe:group align="down">
      <xe:group>
        <xe:popupmenu source="$temp@scale" defaultvalue="fit">
          <xe:options>
            <xe:option label="25%" value="0.25"/>
            <xe:option label="50%" value="0.5"/>
            <xe:option label="75%" value="0.75"/>
            <xe:option label="100%" value="1.0"/>
            <xe:option label="125%" value="1.25"/>
            <xe:option label="150%" value="1.5"/>
            <xe:option label="${zoom-to-fit}" value="fit"/>
          </xe:options>
        </xe:popupmenu>
        <xe:button caption="Refresh">
          <xe:change dest="$temp@refresh" value="=:if ($temp/temp/@refresh) then xs:integer($temp/temp/@refresh) + 1 else 0"/>  
        </xe:button>
        <xe:button caption="&quot;Light&quot; Refresh">
          <xe:change dest="$temp@refresh2" value="=:if ($temp/temp/@refresh2) then xs:integer($temp/temp/@refresh2) + 1 else 0"/>  
        </xe:button>
      </xe:group>
      <!--
      <xe:webbrowser weight-x="1.0" weight-y="1.0" prefwidth="1" prefheight="1" margin="0" url="=:concat(system-property('censhare:browser-url-prefix'), 'assets/asset/id/', '662899', '/transform;key=transform:asset-preview;scale=', $temp/temp/@scale)">
        <xe:listen-to source="$temp@scale"/>
      </xe:webbrowser>
      -->
      <xe:group align="down">
        <xe:listen-to source="$temp@refresh"/>
        <xe:listen-to source="$temp@scale"/>
        <xe:scrollpane weight-x="1.0" weight-y="1.0" align="down">
          <xe:html weight-x="1.0" weight-y="1.0" prefwidth="200" css-key="asset-info"
              url="=:concat(system-property('censhare:browser-url-prefix'), 'assets/asset/id/', '662899', '/transform;key=transform:asset-preview;scale=', $temp/temp/@scale, ';width=', $control/control/@width, ';height=', $control/control/@height)" include-size-in-control-slot="true">
            <xe:listen-to source="$temp@refresh2"/>
          </xe:html>
        </xe:scrollpane>
      </xe:group>
    </xe:group>
  </xe:part>
  
</cmd>
